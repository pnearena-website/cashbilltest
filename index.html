<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNE Arena - Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4a6cf7;
            --primary-dark: #2c3e8f;
            --secondary: #f5f7fa;
            --text: #333;
            --border: #eaeaea;
            --success: #2e7d32;
            --warning: #ff8f00;
            --danger: #c62828;
            --admin: #e53935;
            --white: #ffffff;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--secondary);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--border);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Login Page */
        .login-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #4a6cf7, #2c3e8f);
        }

        .login-card {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-logo {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .login-title {
            font-size: 24px;
            margin-bottom: 30px;
            color: var(--text);
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 16px;
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-danger {
            background-color: var(--admin);
            color: var(--white);
        }

        .btn-danger:hover {
            background-color: #c62828;
        }

        .btn-success {
            background-color: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background-color: #1b5e20;
        }

        .btn-block {
            width: 100%;
        }

        .alert {
            padding: 12px 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: left;
        }

        .alert-danger {
            background-color: #ffebee;
            color: var(--danger);
            border-left: 4px solid var(--danger);
        }

        /* Main App Layout */
        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            display: none;
        }

        /* Top Navigation */
        .top-nav {
            background-color: var(--white);
            box-shadow: var(--shadow);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .nav-toggle {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--text);
            cursor: pointer;
        }

        .nav-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
        }

        .user-role {
            font-size: 14px;
            color: #666;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--white);
            box-shadow: var(--shadow);
            position: fixed;
            top: 70px;
            left: 0;
            bottom: 0;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 50;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: var(--text);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background-color: var(--secondary);
        }

        .menu-item.active {
            background-color: rgba(74, 108, 247, 0.1);
            border-left-color: var(--primary);
            color: var(--primary);
        }

        .menu-item i {
            margin-right: 12px;
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        .menu-item.admin-only {
            color: var(--admin);
        }

        .menu-item.admin-only:hover {
            background-color: rgba(229, 57, 53, 0.1);
        }

        .menu-item.admin-only.active {
            border-left-color: var(--admin);
            color: var(--admin);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            margin-left: 250px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .content-header {
            margin-bottom: 20px;
        }

        .content-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .content-subtitle {
            color: #666;
            font-size: 16px;
        }

        .card {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
        }

        /* Dashboard Styles */
        .dashboard-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
        }

        .info-icon {
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .info-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 24px;
            font-weight: 600;
        }

        .punch-section {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .punch-btn {
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            min-width: 150px;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            background-color: var(--secondary);
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .data-table tr:hover {
            background-color: rgba(74, 108, 247, 0.05);
        }

        /* Form Styles */
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-col {
            flex: 1;
            min-width: 250px;
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background-color: #e8f5e9;
            color: var(--success);
        }

        .status-inactive {
            background-color: #ffebee;
            color: var(--danger);
        }

        /* Schedule Table Styles */
        .schedule-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .week-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .week-btn {
            background-color: var(--white);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .week-btn:hover {
            background-color: var(--secondary);
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
        }

        .schedule-table th,
        .schedule-table td {
            padding: 12px;
            border: 1px solid var(--border);
            text-align: center;
        }

        .schedule-table th {
            background-color: var(--primary);
            color: var(--white);
        }

        .schedule-table .employee-info {
            text-align: left;
        }

        .schedule-table .day-header {
            background-color: var(--secondary);
        }

        .schedule-cell {
            min-width: 100px;
        }

        .schedule-status {
            padding: 6px;
            border-radius: 4px;
            font-size: 14px;
        }

        .schedule-working {
            background-color: #e8f5e9;
            color: var(--success);
        }

        .schedule-off {
            background-color: #ffebee;
            color: var(--danger);
        }

        .schedule-leave {
            background-color: #fff8e1;
            color: var(--warning);
        }

        .no-schedule {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                max-width: 300px;
            }

            .main-content {
                margin-left: 0;
            }

            .main-content.expanded {
                margin-left: 0;
            }

            .dashboard-info {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
            }

            .schedule-controls {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
        }

        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 400px;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-icon {
            font-size: 24px;
        }

        .notification-success .notification-icon {
            color: var(--success);
        }

        .notification-error .notification-icon {
            color: var(--danger);
        }

        .notification-message {
            flex: 1;
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-card">
            <div class="login-logo">PNE ARENA</div>
            <h2 class="login-title">Login to Your Account</h2>
            
            <div id="loginAlert" class="alert alert-danger" style="display: none;"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="userId">User ID</label>
                    <input type="text" class="form-input" id="userId" placeholder="Enter your User ID" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">Password</label>
                    <input type="password" class="form-input" id="password" placeholder="Enter your password" required>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </form>
            
            <div style="margin-top: 30px; text-align: left; font-size: 14px;">
                <p style="margin-bottom: 10px;"><strong>Default Password:</strong> 0000</p>
                <p><strong>Crew IDs:</strong></p>
                <ul style="padding-left: 20px;">
                    <li>0001 – Danial Danish – Head IT (Admin) – HQ</li>
                    <li>0002 – Aida – Director/Business Manager – HQ</li>
                    <li>0003 – Putri Erinna – Business Development Manager – HQ</li>
                    <li>0004 – Putri Farah – Business Marketing Manager – HQ</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Top Navigation -->
        <nav class="top-nav">
            <div class="nav-left">
                <button class="nav-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="nav-logo">PNE ARENA</div>
            </div>
            
            <div class="nav-user">
                <div class="user-info">
                    <div class="user-name" id="userName">User Name</div>
                    <div class="user-role" id="userRole">User Role</div>
                </div>
                <button class="btn btn-danger" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </nav>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-menu">
                <a href="#" class="menu-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
                <a href="#" class="menu-item" data-page="cashbill">
                    <i class="fas fa-file-invoice-dollar"></i> Cashbill
                </a>
                <a href="#" class="menu-item" data-page="logbook">
                    <i class="fas fa-book"></i> Logbook
                </a>
                <a href="#" class="menu-item" data-page="quotation">
                    <i class="fas fa-file-contract"></i> Quotation
                </a>
                <a href="#" class="menu-item" data-page="schedule">
                    <i class="fas fa-calendar-alt"></i> Schedule Timetable
                </a>
                <a href="#" class="menu-item" data-page="orders">
                    <i class="fas fa-shopping-cart"></i> Online Orders
                </a>
                <a href="#" class="menu-item admin-only" data-page="crew">
                    <i class="fas fa-users"></i> Crew Management
                </a>
                <a href="#" class="menu-item" data-page="stock">
                    <i class="fas fa-boxes"></i> Stock Management
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page">
                <div class="content-header">
                    <h1 class="content-title">Dashboard</h1>
                    <p class="content-subtitle">Welcome back! Here's what's happening today.</p>
                </div>

                <div class="dashboard-info">
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="info-label">Today's Date</div>
                        <div class="info-value" id="currentDate">--</div>
                    </div>
                    
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="info-label">Current Time</div>
                        <div class="info-value" id="currentTime">--:--:--</div>
                    </div>
                    
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-store"></i>
                        </div>
                        <div class="info-label">Outlet</div>
                        <div class="info-value" id="userOutlet">--</div>
                    </div>
                    
                    <div class="info-card">
                        <div class="info-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="info-label">Current Schedule</div>
                        <div class="info-value" id="currentSchedule">--</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Time Tracking</h2>
                    </div>
                    
                    <div id="scheduleMessage" class="no-schedule" style="display: none;">
                        No schedule found for you today.
                    </div>
                    
                    <div id="punchSection" class="punch-section">
                        <button class="btn btn-success punch-btn" id="punchInBtn">
                            <i class="fas fa-sign-in-alt"></i> Punch In
                        </button>
                        <button class="btn btn-danger punch-btn" id="punchOutBtn" disabled>
                            <i class="fas fa-sign-out-alt"></i> Punch Out
                        </button>
                        <button class="btn btn-warning punch-btn" id="breakBtn" disabled>
                            <i class="fas fa-pause"></i> Break
                        </button>
                        <button class="btn btn-primary punch-btn" id="resumeBtn" style="display: none;">
                            <i class="fas fa-play"></i> Resume
                        </button>
                    </div>
                </div>
            </div>

            <!-- Cashbill Page -->
            <div id="cashbillPage" class="page" style="display: none;">
                <div class="content-header">
                    <h1 class="content-title">Cashbill Management</h1>
                    <p class="content-subtitle">Create and manage cashbills</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Cashbills</h2>
                        <button class="btn btn-primary" id="createCashbillBtn">
                            <i class="fas fa-plus"></i> Create Cashbill
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Invoice No</th>
                                    <th>Date</th>
                                    <th>Customer Name</th>
                                    <th>Phone No</th>
                                    <th>Total Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="cashbillTableBody">
                                <tr>
                                    <td colspan="7" class="no-schedule">No cashbills found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Logbook Page -->
            <div id="logbookPage" class="page" style="display: none;">
                <div class="content-header">
                    <h1 class="content-title">Logbook</h1>
                    <p class="content-subtitle">Record and view daily activities</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Log Entries</h2>
                        <button class="btn btn-primary" id="createLogBtn">
                            <i class="fas fa-plus"></i> Create Log Entry
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Crew Involved</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="logbookTableBody">
                                <tr>
                                    <td colspan="5" class="no-schedule">No log entries found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Quotation Page -->
            <div id="quotationPage" class="page" style="display: none;">
                <div class="content-header">
                    <h1 class="content-title">Quotation Management</h1>
                    <p class="content-subtitle">Create and manage quotations</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Quotations</h2>
                        <button class="btn btn-primary" id="createQuotationBtn">
                            <i class="fas fa-plus"></i> Create Quotation
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Quote No</th>
                                    <th>Date</th>
                                    <th>Client Name</th>
                                    <th>Services</th>
                                    <th>Total Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="quotationTableBody">
                                <tr>
                                    <td colspan="7" class="no-schedule">No quotations found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Schedule Page -->
            <div id="schedulePage" class="page" style="display: none;">
                <div class="content-header">
                    <h1 class="content-title">Schedule Timetable</h1>
                    <p class="content-subtitle">View and manage weekly schedules</p>
                </div>

                <div class="card">
                    <div class="schedule-controls">
                        <div class="week-nav">
                            <button class="week-btn" id="prevWeekBtn">
                                <i class="fas fa-chevron-left"></i> Previous Week
                            </button>
                            <span id="currentWeek">--</span>
                            <button class="week-btn" id="nextWeekBtn">
                                Next Week <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        
                        <div id="scheduleAdminControls" style="display: none;">
                            <button class="btn btn-danger" id="createScheduleBtn">
                                <i class="fas fa-plus"></i> Create Schedule
                            </button>
                            <button class="btn btn-success" id="saveScheduleBtn" style="display: none;">
                                <i class="fas fa-save"></i> Save Schedule
                            </button>
                        </div>
                    </div>
                    
                    <div id="scheduleTableContainer">
                        <div class="no-schedule" id="noScheduleMessage">
                            This week schedule is not yet available
                        </div>
                    </div>
                </div>
            </div>

            <!-- Online Orders Page -->
            <div id="ordersPage" class="page" style="display: none;">
                <div class="content-header">
                    <h1 class="content-title">Online Orders</h1>
                    <p class="content-subtitle">Manage online orders</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Orders</h2>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Items</th>
                                    <th>Total</th>
                                    <th>Outlet</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <tr>
                                    <td colspan="8" class="no-schedule">No orders found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Crew Management Page -->
            <div id="crewPage" class="page" style="display: none;">
                <div class="content-header">
                    <h1 class="content-title">Crew Management</h1>
                    <p class="content-subtitle">Manage crew members (Admin Only)</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Crew Members</h2>
                        <button class="btn btn-danger" id="addCrewBtn">
                            <i class="fas fa-plus"></i> Add Crew
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Role</th>
                                    <th>Outlet</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="crewTableBody">
                                <tr>
                                    <td colspan="6" class="no-schedule">No crew members found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Stock Management Page -->
            <div id="stockPage" class="page" style="display: none;">
                <div class="content-header">
                    <h1 class="content-title">Stock Management</h1>
                    <p class="content-subtitle">Manage inventory and stock</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Stock Items</h2>
                        <button class="btn btn-danger admin-only" id="addStockBtn" style="display: none;">
                            <i class="fas fa-plus"></i> Add Stock
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Item Code</th>
                                    <th>Name</th>
                                    <th>Description</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Outlet</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="stockTableBody">
                                <tr>
                                    <td colspan="7" class="no-schedule">No stock items found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Cashbill Modal -->
    <div class="modal" id="cashbillModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="cashbillModalTitle">Create Cashbill</h3>
                <button class="modal-close" id="closeCashbillModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="cashbillForm">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="customerName">Customer Name</label>
                                <input type="text" class="form-input" id="customerName" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="customerPhone">Phone No</label>
                                <input type="tel" class="form-input" id="customerPhone" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="cashbillDate">Date</label>
                                <input type="date" class="form-input" id="cashbillDate" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="invoiceNo">Invoice No</label>
                                <input type="text" class="form-input" id="invoiceNo" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Items</label>
                        <div id="cashbillItems">
                            <div class="form-row cashbill-item">
                                <div class="form-col">
                                    <div class="form-group">
                                        <select class="form-input item-select" required>
                                            <option value="">Select Item</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <input type="number" class="form-input item-quantity" placeholder="Quantity" min="1" value="1" required>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <input type="number" class="form-input item-price" placeholder="Price" step="0.01" readonly>
                                    </div>
                                </div>
                                <div class="form-col" style="display: flex; align-items: end;">
                                    <button type="button" class="btn btn-danger remove-item" style="display: none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" id="addItemBtn">
                            <i class="fas fa-plus"></i> Add Item
                        </button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="totalAmount">Total Amount</label>
                                <input type="number" class="form-input" id="totalAmount" step="0.01" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" id="priceAdjustmentGroup" style="display: none;">
                        <label class="form-label" for="priceAdjustment">Price Adjustment (Admin Only)</label>
                        <input type="number" class="form-input" id="priceAdjustment" step="0.01" placeholder="Enter adjustment amount">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="draftCashbillBtn">Draft</button>
                <button type="button" class="btn btn-primary" id="commitCashbillBtn">Commit</button>
                <button type="button" class="btn btn-success" id="printCashbillBtn" style="display: none;">Print</button>
            </div>
        </div>
    </div>

    <!-- Logbook Modal -->
    <div class="modal" id="logbookModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="logbookModalTitle">Create Log Entry</h3>
                <button class="modal-close" id="closeLogbookModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="logbookForm">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="logDate">Date</label>
                                <input type="date" class="form-input" id="logDate" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="logDescription">Description</label>
                        <textarea class="form-input" id="logDescription" rows="4" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="logCrew">Crew Involved</label>
                        <select class="form-input" id="logCrew" multiple>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="draftLogBtn">Draft</button>
                <button type="button" class="btn btn-primary" id="commitLogBtn">Commit</button>
            </div>
        </div>
    </div>

    <!-- Quotation Modal -->
    <div class="modal" id="quotationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="quotationModalTitle">Create Quotation</h3>
                <button class="modal-close" id="closeQuotationModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="quotationForm">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="clientName">Client Name</label>
                                <input type="text" class="form-input" id="clientName" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="clientEmail">Email</label>
                                <input type="email" class="form-input" id="clientEmail">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="clientPhone">Phone</label>
                                <input type="tel" class="form-input" id="clientPhone">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="quoteDate">Date</label>
                                <input type="date" class="form-input" id="quoteDate" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Services</label>
                        <div id="quotationServices">
                            <div class="form-row quotation-service">
                                <div class="form-col">
                                    <div class="form-group">
                                        <input type="text" class="form-input service-name" placeholder="Service Name" required>
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <input type="number" class="form-input service-price" placeholder="Price" step="0.01" required>
                                    </div>
                                </div>
                                <div class="form-col" style="display: flex; align-items: end;">
                                    <button type="button" class="btn btn-danger remove-service" style="display: none;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" id="addServiceBtn">
                            <i class="fas fa-plus"></i> Add Service
                        </button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="quoteTotal">Total Amount</label>
                                <input type="number" class="form-input" id="quoteTotal" step="0.01" readonly>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="saveQuoteBtn">Save</button>
                <button type="button" class="btn btn-primary" id="downloadQuoteBtn">Download PDF</button>
                <button type="button" class="btn btn-success" id="emailQuoteBtn">Send Email</button>
            </div>
        </div>
    </div>

    <!-- Crew Modal -->
    <div class="modal" id="crewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="crewModalTitle">Add Crew Member</h3>
                <button class="modal-close" id="closeCrewModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="crewForm">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="crewId">ID</label>
                                <input type="text" class="form-input" id="crewId" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="crewName">Name</label>
                                <input type="text" class="form-input" id="crewName" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="crewRole">Role</label>
                                <select class="form-input" id="crewRole" required>
                                    <option value="">Select Role</option>
                                    <option value="Admin">Admin</option>
                                    <option value="Manager">Manager</option>
                                    <option value="Staff">Staff</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="crewOutlet">Outlet</label>
                                <select class="form-input" id="crewOutlet" required>
                                    <option value="">Select Outlet</option>
                                    <option value="HQ">HQ</option>
                                    <option value="BLM">BLM</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="cancelCrewBtn">Cancel</button>
                <button type="button" class="btn btn-danger" id="saveCrewBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Stock Modal -->
    <div class="modal" id="stockModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="stockModalTitle">Add Stock Item</h3>
                <button class="modal-close" id="closeStockModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="stockForm">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="itemCode">Item Code</label>
                                <input type="text" class="form-input" id="itemCode" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="itemName">Name</label>
                                <input type="text" class="form-input" id="itemName" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="itemDescription">Description</label>
                        <textarea class="form-input" id="itemDescription" rows="2"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="itemPrice">Price</label>
                                <input type="number" class="form-input" id="itemPrice" step="0.01" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="itemQuantity">Quantity</label>
                                <input type="number" class="form-input" id="itemQuantity" min="0" required>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label" for="itemOutlet">Outlet</label>
                                <select class="form-input" id="itemOutlet" required>
                                    <option value="">Select Outlet</option>
                                    <option value="HQ">HQ</option>
                                    <option value="BLM">BLM</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="cancelStockBtn">Cancel</button>
                <button type="button" class="btn btn-danger" id="saveStockBtn">Save</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="notification-message" id="notificationMessage">
            Notification message
        </div>
        <button class="notification-close" id="notificationClose">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <script>
        // App State
        const app = {
            user: null,
            currentPage: 'dashboard',
            sidebarVisible: true,
            cashbills: [],
            logEntries: [],
            quotations: [],
            orders: [],
            crewMembers: [],
            stockItems: [],
            schedules: {},
            currentWeek: null,
            punchStatus: 'out', // 'in', 'out', 'break'
            scheduleEditMode: false
        };

        // DOM Elements
        const elements = {
            loginPage: document.getElementById('loginPage'),
            appContainer: document.getElementById('appContainer'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            loginForm: document.getElementById('loginForm'),
            loginAlert: document.getElementById('loginAlert'),
            sidebar: document.getElementById('sidebar'),
            sidebarToggle: document.getElementById('sidebarToggle'),
            mainContent: document.getElementById('mainContent'),
            userName: document.getElementById('userName'),
            userRole: document.getElementById('userRole'),
            userOutlet: document.getElementById('userOutlet'),
            logoutBtn: document.getElementById('logoutBtn'),
            notification: document.getElementById('notification'),
            notificationMessage: document.getElementById('notificationMessage'),
            notificationClose: document.getElementById('notificationClose'),
            currentDate: document.getElementById('currentDate'),
            currentTime: document.getElementById('currentTime'),
            currentSchedule: document.getElementById('currentSchedule'),
            scheduleMessage: document.getElementById('scheduleMessage'),
            punchSection: document.getElementById('punchSection'),
            punchInBtn: document.getElementById('punchInBtn'),
            punchOutBtn: document.getElementById('punchOutBtn'),
            breakBtn: document.getElementById('breakBtn'),
            resumeBtn: document.getElementById('resumeBtn'),
            cashbillModal: document.getElementById('cashbillModal'),
            cashbillForm: document.getElementById('cashbillForm'),
            logbookModal: document.getElementById('logbookModal'),
            logbookForm: document.getElementById('logbookForm'),
            quotationModal: document.getElementById('quotationModal'),
            quotationForm: document.getElementById('quotationForm'),
            crewModal: document.getElementById('crewModal'),
            crewForm: document.getElementById('crewForm'),
            stockModal: document.getElementById('stockModal'),
            stockForm: document.getElementById('stockForm')
        };

        // Initialize App
        function initApp() {
            // Check if user is logged in
            const savedUser = localStorage.getItem('pneUser');
            if (savedUser) {
                app.user = JSON.parse(savedUser);
                showApp();
            } else {
                showLogin();
            }

            // Load data from localStorage
            loadData();

            // Set up event listeners
            setupEventListeners();

            // Update date and time
            updateDateTime();
            setInterval(updateDateTime, 1000);
        }

        // Show login page
        function showLogin() {
            elements.loginPage.style.display = 'flex';
            elements.appContainer.style.display = 'none';
        }

        // Show app
        function showApp() {
            elements.loginPage.style.display = 'none';
            elements.appContainer.style.display = 'flex';
            
            // Update user info
            elements.userName.textContent = app.user.name;
            elements.userRole.textContent = app.user.role;
            elements.userOutlet.textContent = app.user.outlet;
            
            // Show/hide admin features
            updateAdminFeatures();
            
            // Load current page
            navigateTo(app.currentPage || 'dashboard');
            
            // Check today's schedule
            checkTodaySchedule();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Login form
            elements.loginForm.addEventListener('submit', handleLogin);
            
            // Sidebar toggle
            elements.sidebarToggle.addEventListener('click', toggleSidebar);
            
            // Logout
            elements.logoutBtn.addEventListener('click', handleLogout);
            
            // Menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = item.getAttribute('data-page');
                    navigateTo(page);
                });
            });
            
            // Dashboard punch buttons
            elements.punchInBtn.addEventListener('click', () => handlePunch('in'));
            elements.punchOutBtn.addEventListener('click', () => handlePunch('out'));
            elements.breakBtn.addEventListener('click', () => handlePunch('break'));
            elements.resumeBtn.addEventListener('click', () => handlePunch('resume'));
            
            // Cashbill
            document.getElementById('createCashbillBtn').addEventListener('click', openCashbillModal);
            document.getElementById('closeCashbillModal').addEventListener('click', closeCashbillModal);
            document.getElementById('addItemBtn').addEventListener('click', addCashbillItem);
            document.getElementById('draftCashbillBtn').addEventListener('click', () => saveCashbill('draft'));
            document.getElementById('commitCashbillBtn').addEventListener('click', () => saveCashbill('commit'));
            document.getElementById('printCashbillBtn').addEventListener('click', printCashbill);
            
            // Logbook
            document.getElementById('createLogBtn').addEventListener('click', openLogbookModal);
            document.getElementById('closeLogbookModal').addEventListener('click', closeLogbookModal);
            document.getElementById('draftLogBtn').addEventListener('click', () => saveLogEntry('draft'));
            document.getElementById('commitLogBtn').addEventListener('click', () => saveLogEntry('commit'));
            
            // Quotation
            document.getElementById('createQuotationBtn').addEventListener('click', openQuotationModal);
            document.getElementById('closeQuotationModal').addEventListener('click', closeQuotationModal);
            document.getElementById('addServiceBtn').addEventListener('click', addQuotationService);
            document.getElementById('saveQuoteBtn').addEventListener('click', saveQuotation);
            document.getElementById('downloadQuoteBtn').addEventListener('click', downloadQuotation);
            document.getElementById('emailQuoteBtn').addEventListener('click', emailQuotation);
            
            // Schedule
            document.getElementById('prevWeekBtn').addEventListener('click', () => changeWeek(-1));
            document.getElementById('nextWeekBtn').addEventListener('click', () => changeWeek(1));
            document.getElementById('createScheduleBtn').addEventListener('click', createSchedule);
            document.getElementById('saveScheduleBtn').addEventListener('click', saveSchedule);
            
            // Crew Management
            document.getElementById('addCrewBtn').addEventListener('click', openCrewModal);
            document.getElementById('closeCrewModal').addEventListener('click', closeCrewModal);
            document.getElementById('cancelCrewBtn').addEventListener('click', closeCrewModal);
            document.getElementById('saveCrewBtn').addEventListener('click', saveCrew);
            
            // Stock Management
            document.getElementById('addStockBtn').addEventListener('click', openStockModal);
            document.getElementById('closeStockModal').addEventListener('click', closeStockModal);
            document.getElementById('cancelStockBtn').addEventListener('click', closeStockModal);
            document.getElementById('saveStockBtn').addEventListener('click', saveStock);
            
            // Notification close
            elements.notificationClose.addEventListener('click', hideNotification);
            
            // Dynamic event listeners for remove buttons
            document.addEventListener('click', (e) => {
                if (e.target.closest('.remove-item')) {
                    removeCashbillItem(e.target.closest('.cashbill-item'));
                } else if (e.target.closest('.remove-service')) {
                    removeQuotationService(e.target.closest('.quotation-service'));
                }
            });
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const userId = document.getElementById('userId').value;
            const password = document.getElementById('password').value;
            
            // Default password is 0000
            if (password !== '0000') {
                showLoginAlert('Invalid password');
                return;
            }
            
            // Get user data
            const user = getUserById(userId);
            if (!user) {
                showLoginAlert('User ID not found');
                return;
            }
            
            // Save user to app state and localStorage
            app.user = user;
            localStorage.setItem('pneUser', JSON.stringify(user));
            
            // Show app
            showApp();
            showNotification('Login successful', 'success');
        }

        // Get user by ID
        function getUserById(id) {
            const users = [
                { id: '0001', name: 'Danial Danish', role: 'Head IT (Admin)', outlet: 'HQ', isAdmin: true },
                { id: '0002', name: 'Aida', role: 'Director/Business Manager', outlet: 'HQ', isAdmin: false },
                { id: '0003', name: 'Putri Erinna', role: 'Business Development Manager', outlet: 'HQ', isAdmin: false },
                { id: '0004', name: 'Putri Farah', role: 'Business Marketing Manager', outlet: 'HQ', isAdmin: false }
            ];
            
            return users.find(user => user.id === id);
        }

        // Handle logout
        function handleLogout() {
            localStorage.removeItem('pneUser');
            app.user = null;
            showLogin();
            showNotification('Logged out successfully', 'success');
        }

        // Toggle sidebar
        function toggleSidebar() {
            app.sidebarVisible = !app.sidebarVisible;
            
            if (app.sidebarVisible) {
                elements.sidebar.classList.remove('hidden');
                elements.mainContent.classList.remove('expanded');
            } else {
                elements.sidebar.classList.add('hidden');
                elements.mainContent.classList.add('expanded');
            }
        }

        // Navigate to page
        function navigateTo(page) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => {
                p.style.display = 'none';
            });
            
            // Show selected page
            document.getElementById(`${page}Page`).style.display = 'block';
            
            // Update active menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === page) {
                    item.classList.add('active');
                }
            });
            
            // Update current page
            app.currentPage = page;
            
            // Load page data
            loadPageData(page);
        }

        // Load page data
        function loadPageData(page) {
            switch (page) {
                case 'cashbill':
                    loadCashbills();
                    break;
                case 'logbook':
                    loadLogEntries();
                    break;
                case 'quotation':
                    loadQuotations();
                    break;
                case 'schedule':
                    loadSchedule();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'crew':
                    loadCrewMembers();
                    break;
                case 'stock':
                    loadStockItems();
                    break;
            }
        }

        // Update admin features
        function updateAdminFeatures() {
            const isAdmin = app.user && app.user.isAdmin;
            
            // Show/hide admin menu items
            document.querySelectorAll('.admin-only').forEach(item => {
                if (isAdmin) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Show/hide admin buttons in pages
            const adminButtons = document.querySelectorAll('.admin-only');
            adminButtons.forEach(btn => {
                if (isAdmin) {
                    btn.style.display = 'inline-flex';
                } else {
                    btn.style.display = 'none';
                }
            });
            
            // Update schedule admin controls
            const scheduleAdminControls = document.getElementById('scheduleAdminControls');
            if (isAdmin) {
                scheduleAdminControls.style.display = 'flex';
            } else {
                scheduleAdminControls.style.display = 'none';
            }
        }

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            
            // Update date
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            elements.currentDate.textContent = now.toLocaleDateString('en-US', dateOptions);
            
            // Update time
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
            elements.currentTime.textContent = now.toLocaleTimeString('en-US', timeOptions);
        }

        // Check today's schedule
        function checkTodaySchedule() {
            const today = new Date();
            const todayStr = formatDate(today);
            const userSchedule = getUserSchedule(app.user.id, todayStr);
            
            if (userSchedule) {
                elements.currentSchedule.textContent = `${userSchedule.startTime} - ${userSchedule.endTime}`;
                elements.punchSection.style.display = 'flex';
                elements.scheduleMessage.style.display = 'none';
            } else {
                elements.currentSchedule.textContent = 'Not scheduled';
                elements.punchSection.style.display = 'none';
                elements.scheduleMessage.style.display = 'block';
            }
        }

        // Get user schedule for a specific date
        function getUserSchedule(userId, dateStr) {
            // This is a simplified implementation
            // In a real app, this would fetch from a database
            const schedules = [
                { userId: '0001', date: getCurrentDateStr(), startTime: '09:00', endTime: '17:00' },
                { userId: '0002', date: getCurrentDateStr(), startTime: '09:00', endTime: '17:00' },
                { userId: '0003', date: getCurrentDateStr(), startTime: '10:00', endTime: '18:00' },
                { userId: '0004', date: getCurrentDateStr(), startTime: '09:00', endTime: '17:00' }
            ];
            
            return schedules.find(s => s.userId === userId && s.date === dateStr);
        }

        // Get current date string (YYYY-MM-DD)
        function getCurrentDateStr() {
            const today = new Date();
            return formatDate(today);
        }

        // Format date as YYYY-MM-DD
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Handle punch in/out
        function handlePunch(action) {
            switch (action) {
                case 'in':
                    app.punchStatus = 'in';
                    elements.punchInBtn.disabled = true;
                    elements.punchOutBtn.disabled = false;
                    elements.breakBtn.disabled = false;
                    showNotification('Punched in successfully', 'success');
                    break;
                case 'out':
                    app.punchStatus = 'out';
                    elements.punchInBtn.disabled = false;
                    elements.punchOutBtn.disabled = true;
                    elements.breakBtn.disabled = true;
                    elements.resumeBtn.style.display = 'none';
                    showNotification('Punched out successfully', 'success');
                    break;
                case 'break':
                    app.punchStatus = 'break';
                    elements.punchInBtn.disabled = true;
                    elements.punchOutBtn.disabled = true;
                    elements.breakBtn.disabled = true;
                    elements.resumeBtn.style.display = 'inline-flex';
                    showNotification('Break started', 'success');
                    break;
                case 'resume':
                    app.punchStatus = 'in';
                    elements.punchInBtn.disabled = true;
                    elements.punchOutBtn.disabled = false;
                    elements.breakBtn.disabled = false;
                    elements.resumeBtn.style.display = 'none';
                    showNotification('Resumed work', 'success');
                    break;
            }
        }

        // Show login alert
        function showLoginAlert(message) {
            elements.loginAlert.textContent = message;
            elements.loginAlert.style.display = 'block';
            
            setTimeout(() => {
                elements.loginAlert.style.display = 'none';
            }, 3000);
        }

        // Show notification
        function showNotification(message, type = 'success') {
            elements.notificationMessage.textContent = message;
            elements.notification.className = `notification notification-${type}`;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                hideNotification();
            }, 3000);
        }

        // Hide notification
        function hideNotification() {
            elements.notification.classList.remove('show');
        }

        // Load data from localStorage
        function loadData() {
            // Load cashbills
            const cashbillsData = localStorage.getItem('pneCashbills');
            if (cashbillsData) {
                app.cashbills = JSON.parse(cashbillsData);
            }
            
            // Load log entries
            const logEntriesData = localStorage.getItem('pneLogEntries');
            if (logEntriesData) {
                app.logEntries = JSON.parse(logEntriesData);
            }
            
            // Load quotations
            const quotationsData = localStorage.getItem('pneQuotations');
            if (quotationsData) {
                app.quotations = JSON.parse(quotationsData);
            }
            
            // Load orders
            const ordersData = localStorage.getItem('pneOrders');
            if (ordersData) {
                app.orders = JSON.parse(ordersData);
            }
            
            // Load crew members
            const crewMembersData = localStorage.getItem('pneCrewMembers');
            if (crewMembersData) {
                app.crewMembers = JSON.parse(crewMembersData);
            } else {
                // Initialize with default crew members
                app.crewMembers = [
                    { id: '0001', name: 'Danial Danish', role: 'Head IT (Admin)', outlet: 'HQ', status: 'Active' },
                    { id: '0002', name: 'Aida', role: 'Director/Business Manager', outlet: 'HQ', status: 'Active' },
                    { id: '0003', name: 'Putri Erinna', role: 'Business Development Manager', outlet: 'HQ', status: 'Active' },
                    { id: '0004', name: 'Putri Farah', role: 'Business Marketing Manager', outlet: 'HQ', status: 'Active' }
                ];
                saveCrewMembers();
            }
            
            // Load stock items
            const stockItemsData = localStorage.getItem('pneStockItems');
            if (stockItemsData) {
                app.stockItems = JSON.parse(stockItemsData);
            } else {
                // Initialize with sample stock items
                app.stockItems = [
                    { code: 'ITEM001', name: 'Sample Item 1', description: 'Description for item 1', price: 10.00, quantity: 50, outlet: 'HQ' },
                    { code: 'ITEM002', name: 'Sample Item 2', description: 'Description for item 2', price: 20.00, quantity: 30, outlet: 'HQ' },
                    { code: 'ITEM003', name: 'Sample Item 3', description: 'Description for item 3', price: 15.00, quantity: 25, outlet: 'BLM' }
                ];
                saveStockItems();
            }
            
            // Load schedules
            const schedulesData = localStorage.getItem('pneSchedules');
            if (schedulesData) {
                app.schedules = JSON.parse(schedulesData);
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('pneCashbills', JSON.stringify(app.cashbills));
            localStorage.setItem('pneLogEntries', JSON.stringify(app.logEntries));
            localStorage.setItem('pneQuotations', JSON.stringify(app.quotations));
            localStorage.setItem('pneOrders', JSON.stringify(app.orders));
            localStorage.setItem('pneCrewMembers', JSON.stringify(app.crewMembers));
            localStorage.setItem('pneStockItems', JSON.stringify(app.stockItems));
            localStorage.setItem('pneSchedules', JSON.stringify(app.schedules));
        }

        // Cashbill Functions
        function loadCashbills() {
            const tbody = document.getElementById('cashbillTableBody');
            tbody.innerHTML = '';
            
            if (app.cashbills.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="no-schedule">No cashbills found</td></tr>';
                return;
            }
            
            app.cashbills.forEach(cashbill => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${cashbill.invoiceNo}</td>
                    <td>${cashbill.date}</td>
                    <td>${cashbill.customerName}</td>
                    <td>${cashbill.customerPhone}</td>
                    <td>$${cashbill.totalAmount.toFixed(2)}</td>
                    <td><span class="status-badge ${cashbill.status === 'Committed' ? 'status-active' : 'status-inactive'}">${cashbill.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewCashbill('${cashbill.invoiceNo}')">View</button>
                        ${app.user.isAdmin && cashbill.status === 'Committed' ? 
                            `<button class="btn btn-sm btn-danger" onclick="uncommitCashbill('${cashbill.invoiceNo}')">Uncommit</button>` : ''}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function openCashbillModal() {
            // Reset form
            elements.cashbillForm.reset();
            
            // Generate invoice number
            const invoiceNo = generateInvoiceNo();
            document.getElementById('invoiceNo').value = invoiceNo;
            
            // Set today's date
            document.getElementById('cashbillDate').value = getCurrentDateStr();
            
            // Populate item dropdown
            populateItemDropdown();
            
            // Show/hide price adjustment for admin
            const priceAdjustmentGroup = document.getElementById('priceAdjustmentGroup');
            if (app.user.isAdmin) {
                priceAdjustmentGroup.style.display = 'block';
            } else {
                priceAdjustmentGroup.style.display = 'none';
            }
            
            // Reset items
            resetCashbillItems();
            
            // Show modal
            elements.cashbillModal.classList.add('active');
        }

        function closeCashbillModal() {
            elements.cashbillModal.classList.remove('active');
        }

        function generateInvoiceNo() {
            const prefix = 'INV-';
            const nextNumber = app.cashbills.length + 1;
            return `${prefix}${String(nextNumber).padStart(4, '0')}`;
        }

        function populateItemDropdown() {
            const selects = document.querySelectorAll('.item-select');
            
            selects.forEach(select => {
                select.innerHTML = '<option value="">Select Item</option>';
                
                app.stockItems.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.code;
                    option.textContent = `${item.name} - $${item.price.toFixed(2)}`;
                    option.dataset.price = item.price;
                    select.appendChild(option);
                });
                
                // Add change event listener
                select.addEventListener('change', updateItemPrice);
            });
        }

        function updateItemPrice(e) {
            const select = e.target;
            const priceInput = select.closest('.cashbill-item').querySelector('.item-price');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                priceInput.value = selectedOption.dataset.price;
                calculateTotal();
            } else {
                priceInput.value = '';
            }
        }

        function addCashbillItem() {
            const itemsContainer = document.getElementById('cashbillItems');
            const itemTemplate = document.querySelector('.cashbill-item').cloneNode(true);
            
            // Reset values
            itemTemplate.querySelector('.item-select').value = '';
            itemTemplate.querySelector('.item-quantity').value = '1';
            itemTemplate.querySelector('.item-price').value = '';
            
            // Show remove button
            itemTemplate.querySelector('.remove-item').style.display = 'inline-flex';
            
            // Add event listener
            itemTemplate.querySelector('.item-select').addEventListener('change', updateItemPrice);
            
            itemsContainer.appendChild(itemTemplate);
            
            // Populate dropdown
            populateItemDropdown();
        }

        function removeCashbillItem(item) {
            item.remove();
            calculateTotal();
            
            // Show/hide remove buttons
            const items = document.querySelectorAll('.cashbill-item');
            items.forEach((item, index) => {
                const removeBtn = item.querySelector('.remove-item');
                if (items.length > 1) {
                    removeBtn.style.display = 'inline-flex';
                } else {
                    removeBtn.style.display = 'none';
                }
            });
        }

        function resetCashbillItems() {
            const itemsContainer = document.getElementById('cashbillItems');
            itemsContainer.innerHTML = `
                <div class="form-row cashbill-item">
                    <div class="form-col">
                        <div class="form-group">
                            <select class="form-input item-select" required>
                                <option value="">Select Item</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <input type="number" class="form-input item-quantity" placeholder="Quantity" min="1" value="1" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <input type="number" class="form-input item-price" placeholder="Price" step="0.01" readonly>
                        </div>
                    </div>
                    <div class="form-col" style="display: flex; align-items: end;">
                        <button type="button" class="btn btn-danger remove-item" style="display: none;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Populate dropdown
            populateItemDropdown();
        }

        function calculateTotal() {
            const items = document.querySelectorAll('.cashbill-item');
            let total = 0;
            
            items.forEach(item => {
                const quantity = parseFloat(item.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(item.querySelector('.item-price').value) || 0;
                total += quantity * price;
            });
            
            // Apply price adjustment if admin
            if (app.user.isAdmin) {
                const adjustment = parseFloat(document.getElementById('priceAdjustment').value) || 0;
                total += adjustment;
            }
            
            document.getElementById('totalAmount').value = total.toFixed(2);
        }

        function saveCashbill(status) {
            // Get form data
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const date = document.getElementById('cashbillDate').value;
            const invoiceNo = document.getElementById('invoiceNo').value;
            const totalAmount = parseFloat(document.getElementById('totalAmount').value);
            
            // Get items
            const items = [];
            document.querySelectorAll('.cashbill-item').forEach(item => {
                const itemCode = item.querySelector('.item-select').value;
                const quantity = parseInt(item.querySelector('.item-quantity').value);
                const price = parseFloat(item.querySelector('.item-price').value);
                
                if (itemCode && quantity && price) {
                    const stockItem = app.stockItems.find(si => si.code === itemCode);
                    items.push({
                        code: itemCode,
                        name: stockItem.name,
                        quantity: quantity,
                        price: price
                    });
                }
            });
            
            // Create cashbill object
            const cashbill = {
                invoiceNo,
                date,
                customerName,
                customerPhone,
                items,
                totalAmount,
                status: status === 'commit' ? 'Committed' : 'Draft',
                createdBy: app.user.id,
                createdAt: new Date().toISOString()
            };
            
            // Add to app state
            app.cashbills.push(cashbill);
            saveData();
            
            // Close modal
            closeCashbillModal();
            
            // Reload cashbills
            loadCashbills();
            
            // Show notification
            showNotification(`Cashbill ${status === 'commit' ? 'committed' : 'saved as draft'} successfully`, 'success');
        }

        function viewCashbill(invoiceNo) {
            // Find cashbill
            const cashbill = app.cashbills.find(c => c.invoiceNo === invoiceNo);
            if (!cashbill) return;
            
            // Open modal with cashbill data
            openCashbillModal();
            
            // Populate form
            document.getElementById('invoiceNo').value = cashbill.invoiceNo;
            document.getElementById('customerName').value = cashbill.customerName;
            document.getElementById('customerPhone').value = cashbill.customerPhone;
            document.getElementById('cashbillDate').value = cashbill.date;
            document.getElementById('totalAmount').value = cashbill.totalAmount.toFixed(2);
            
            // Populate items
            const itemsContainer = document.getElementById('cashbillItems');
            itemsContainer.innerHTML = '';
            
            cashbill.items.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'form-row cashbill-item';
                itemElement.innerHTML = `
                    <div class="form-col">
                        <div class="form-group">
                            <select class="form-input item-select" required>
                                <option value="">Select Item</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <input type="number" class="form-input item-quantity" placeholder="Quantity" min="1" value="${item.quantity}" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <input type="number" class="form-input item-price" placeholder="Price" step="0.01" value="${item.price}" readonly>
                        </div>
                    </div>
                    <div class="form-col" style="display: flex; align-items: end;">
                        <button type="button" class="btn btn-danger remove-item" ${index === 0 ? 'style="display: none;"' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                itemsContainer.appendChild(itemElement);
            });
            
            // Populate dropdown
            populateItemDropdown();
            
            // Set selected values
            const itemSelects = document.querySelectorAll('.item-select');
            itemSelects.forEach((select, index) => {
                if (cashbill.items[index]) {
                    select.value = cashbill.items[index].code;
                }
            });
            
            // Show/hide buttons based on status
            const draftBtn = document.getElementById('draftCashbillBtn');
            const commitBtn = document.getElementById('commitCashbillBtn');
            const printBtn = document.getElementById('printCashbillBtn');
            
            if (cashbill.status === 'Committed') {
                draftBtn.style.display = 'none';
                commitBtn.style.display = 'none';
                printBtn.style.display = 'inline-flex';
                
                // Disable form inputs
                document.querySelectorAll('#cashbillForm input, #cashbillForm select').forEach(input => {
                    input.disabled = true;
                });
            } else {
                draftBtn.style.display = 'inline-flex';
                commitBtn.style.display = 'inline-flex';
                printBtn.style.display = 'none';
                
                // Enable form inputs
                document.querySelectorAll('#cashbillForm input, #cashbillForm select').forEach(input => {
                    input.disabled = false;
                });
            }
        }

        function uncommitCashbill(invoiceNo) {
            // Find cashbill
            const cashbillIndex = app.cashbills.findIndex(c => c.invoiceNo === invoiceNo);
            if (cashbillIndex === -1) return;
            
            // Update status
            app.cashbills[cashbillIndex].status = 'Draft';
            saveData();
            
            // Reload cashbills
            loadCashbills();
            
            // Show notification
            showNotification('Cashbill uncommitted successfully', 'success');
        }

        function printCashbill() {
            // This would open a print dialog in a real app
            showNotification('Print functionality would be implemented here', 'success');
        }

        // Logbook Functions
        function loadLogEntries() {
            const tbody = document.getElementById('logbookTableBody');
            tbody.innerHTML = '';
            
            if (app.logEntries.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-schedule">No log entries found</td></tr>';
                return;
            }
            
            app.logEntries.forEach(entry => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${entry.date}</td>
                    <td>${entry.description}</td>
                    <td>${entry.crewInvolved.join(', ')}</td>
                    <td><span class="status-badge ${entry.status === 'Committed' ? 'status-active' : 'status-inactive'}">${entry.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewLogEntry('${entry.id}')">View</button>
                        ${app.user.isAdmin && entry.status === 'Committed' ? 
                            `<button class="btn btn-sm btn-danger" onclick="uncommitLogEntry('${entry.id}')">Uncommit</button>` : ''}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function openLogbookModal() {
            // Reset form
            elements.logbookForm.reset();
            
            // Set today's date
            document.getElementById('logDate').value = getCurrentDateStr();
            
            // Populate crew dropdown
            const crewSelect = document.getElementById('logCrew');
            crewSelect.innerHTML = '';
            
            app.crewMembers.forEach(crew => {
                const option = document.createElement('option');
                option.value = crew.id;
                option.textContent = `${crew.name} (${crew.role})`;
                crewSelect.appendChild(option);
            });
            
            // Show modal
            elements.logbookModal.classList.add('active');
        }

        function closeLogbookModal() {
            elements.logbookModal.classList.remove('active');
        }

        function saveLogEntry(status) {
            // Get form data
            const date = document.getElementById('logDate').value;
            const description = document.getElementById('logDescription').value;
            const crewInvolved = Array.from(document.getElementById('logCrew').selectedOptions).map(option => {
                const crew = app.crewMembers.find(c => c.id === option.value);
                return crew ? crew.name : option.value;
            });
            
            // Create log entry object
            const logEntry = {
                id: generateId(),
                date,
                description,
                crewInvolved,
                status: status === 'commit' ? 'Committed' : 'Draft',
                createdBy: app.user.id,
                createdAt: new Date().toISOString()
            };
            
            // Add to app state
            app.logEntries.push(logEntry);
            saveData();
            
            // Close modal
            closeLogbookModal();
            
            // Reload log entries
            loadLogEntries();
            
            // Show notification
            showNotification(`Log entry ${status === 'commit' ? 'committed' : 'saved as draft'} successfully`, 'success');
        }

        function viewLogEntry(id) {
            // Find log entry
            const logEntry = app.logEntries.find(e => e.id === id);
            if (!logEntry) return;
            
            // Open modal with log entry data
            openLogbookModal();
            
            // Populate form
            document.getElementById('logDate').value = logEntry.date;
            document.getElementById('logDescription').value = logEntry.description;
            
            // Set selected crew
            const crewSelect = document.getElementById('logCrew');
            Array.from(crewSelect.options).forEach(option => {
                const crew = app.crewMembers.find(c => c.id === option.value);
                if (crew && logEntry.crewInvolved.includes(crew.name)) {
                    option.selected = true;
                }
            });
            
            // Show/hide buttons based on status
            const draftBtn = document.getElementById('draftLogBtn');
            const commitBtn = document.getElementById('commitLogBtn');
            
            if (logEntry.status === 'Committed') {
                draftBtn.style.display = 'none';
                commitBtn.style.display = 'none';
                
                // Disable form inputs
                document.querySelectorAll('#logbookForm input, #logbookForm select, #logbookForm textarea').forEach(input => {
                    input.disabled = true;
                });
            } else {
                draftBtn.style.display = 'inline-flex';
                commitBtn.style.display = 'inline-flex';
                
                // Enable form inputs
                document.querySelectorAll('#logbookForm input, #logbookForm select, #logbookForm textarea').forEach(input => {
                    input.disabled = false;
                });
            }
        }

        function uncommitLogEntry(id) {
            // Find log entry
            const logEntryIndex = app.logEntries.findIndex(e => e.id === id);
            if (logEntryIndex === -1) return;
            
            // Update status
            app.logEntries[logEntryIndex].status = 'Draft';
            saveData();
            
            // Reload log entries
            loadLogEntries();
            
            // Show notification
            showNotification('Log entry uncommitted successfully', 'success');
        }

        // Quotation Functions
        function loadQuotations() {
            const tbody = document.getElementById('quotationTableBody');
            tbody.innerHTML = '';
            
            if (app.quotations.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="no-schedule">No quotations found</td></tr>';
                return;
            }
            
            app.quotations.forEach(quotation => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${quotation.quoteNo}</td>
                    <td>${quotation.date}</td>
                    <td>${quotation.clientName}</td>
                    <td>${quotation.services.map(s => s.name).join(', ')}</td>
                    <td>$${quotation.totalAmount.toFixed(2)}</td>
                    <td><span class="status-badge status-active">${quotation.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="viewQuotation('${quotation.quoteNo}')">View</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function openQuotationModal() {
            // Reset form
            elements.quotationForm.reset();
            
            // Set today's date
            document.getElementById('quoteDate').value = getCurrentDateStr();
            
            // Reset services
            resetQuotationServices();
            
            // Show modal
            elements.quotationModal.classList.add('active');
        }

        function closeQuotationModal() {
            elements.quotationModal.classList.remove('active');
        }

        function generateQuoteNo() {
            const prefix = 'QUOTE-';
            const nextNumber = app.quotations.length + 1;
            return `${prefix}${String(nextNumber).padStart(4, '0')}`;
        }

        function addQuotationService() {
            const servicesContainer = document.getElementById('quotationServices');
            const serviceTemplate = document.querySelector('.quotation-service').cloneNode(true);
            
            // Reset values
            serviceTemplate.querySelector('.service-name').value = '';
            serviceTemplate.querySelector('.service-price').value = '';
            
            // Show remove button
            serviceTemplate.querySelector('.remove-service').style.display = 'inline-flex';
            
            servicesContainer.appendChild(serviceTemplate);
        }

        function removeQuotationService(service) {
            service.remove();
            calculateQuoteTotal();
            
            // Show/hide remove buttons
            const services = document.querySelectorAll('.quotation-service');
            services.forEach((service, index) => {
                const removeBtn = service.querySelector('.remove-service');
                if (services.length > 1) {
                    removeBtn.style.display = 'inline-flex';
                } else {
                    removeBtn.style.display = 'none';
                }
            });
        }

        function resetQuotationServices() {
            const servicesContainer = document.getElementById('quotationServices');
            servicesContainer.innerHTML = `
                <div class="form-row quotation-service">
                    <div class="form-col">
                        <div class="form-group">
                            <input type="text" class="form-input service-name" placeholder="Service Name" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <input type="number" class="form-input service-price" placeholder="Price" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-col" style="display: flex; align-items: end;">
                        <button type="button" class="btn btn-danger remove-service" style="display: none;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listeners
            document.querySelectorAll('.service-price').forEach(input => {
                input.addEventListener('input', calculateQuoteTotal);
            });
        }

        function calculateQuoteTotal() {
            const services = document.querySelectorAll('.quotation-service');
            let total = 0;
            
            services.forEach(service => {
                const price = parseFloat(service.querySelector('.service-price').value) || 0;
                total += price;
            });
            
            document.getElementById('quoteTotal').value = total.toFixed(2);
        }

        function saveQuotation() {
            // Get form data
            const clientName = document.getElementById('clientName').value;
            const clientEmail = document.getElementById('clientEmail').value;
            const clientPhone = document.getElementById('clientPhone').value;
            const date = document.getElementById('quoteDate').value;
            const totalAmount = parseFloat(document.getElementById('quoteTotal').value);
            
            // Get services
            const services = [];
            document.querySelectorAll('.quotation-service').forEach(service => {
                const name = service.querySelector('.service-name').value;
                const price = parseFloat(service.querySelector('.service-price').value);
                
                if (name && price) {
                    services.push({
                        name,
                        price
                    });
                }
            });
            
            // Create quotation object
            const quotation = {
                quoteNo: generateQuoteNo(),
                date,
                clientName,
                clientEmail,
                clientPhone,
                services,
                totalAmount,
                status: 'Draft',
                createdBy: app.user.id,
                createdAt: new Date().toISOString()
            };
            
            // Add to app state
            app.quotations.push(quotation);
            saveData();
            
            // Close modal
            closeQuotationModal();
            
            // Reload quotations
            loadQuotations();
            
            // Show notification
            showNotification('Quotation saved successfully', 'success');
        }

        function viewQuotation(quoteNo) {
            // Find quotation
            const quotation = app.quotations.find(q => q.quoteNo === quoteNo);
            if (!quotation) return;
            
            // Open modal with quotation data
            openQuotationModal();
            
            // Populate form
            document.getElementById('clientName').value = quotation.clientName;
            document.getElementById('clientEmail').value = quotation.clientEmail || '';
            document.getElementById('clientPhone').value = quotation.clientPhone || '';
            document.getElementById('quoteDate').value = quotation.date;
            document.getElementById('quoteTotal').value = quotation.totalAmount.toFixed(2);
            
            // Populate services
            const servicesContainer = document.getElementById('quotationServices');
            servicesContainer.innerHTML = '';
            
            quotation.services.forEach((service, index) => {
                const serviceElement = document.createElement('div');
                serviceElement.className = 'form-row quotation-service';
                serviceElement.innerHTML = `
                    <div class="form-col">
                        <div class="form-group">
                            <input type="text" class="form-input service-name" placeholder="Service Name" value="${service.name}" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <input type="number" class="form-input service-price" placeholder="Price" step="0.01" value="${service.price}" required>
                        </div>
                    </div>
                    <div class="form-col" style="display: flex; align-items: end;">
                        <button type="button" class="btn btn-danger remove-service" ${index === 0 ? 'style="display: none;"' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                servicesContainer.appendChild(serviceElement);
            });
            
            // Add event listeners
            document.querySelectorAll('.service-price').forEach(input => {
                input.addEventListener('input', calculateQuoteTotal);
            });
        }

        function downloadQuotation() {
            // This would generate and download a PDF in a real app
            showNotification('PDF download functionality would be implemented here', 'success');
        }

        function emailQuotation() {
            // This would send an email in a real app
            showNotification('Email functionality would be implemented here', 'success');
        }

        // Schedule Functions
        function loadSchedule() {
            // Set current week
            if (!app.currentWeek) {
                app.currentWeek = getCurrentWeek();
            }
            
            updateWeekDisplay();
            
            // Load schedule for current week
            const weekKey = getWeekKey(app.currentWeek);
            const schedule = app.schedules[weekKey];
            
            if (schedule) {
                renderSchedule(schedule);
            } else {
                showNoSchedule();
            }
        }

        function getCurrentWeek() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
            const startDate = new Date(today);
            startDate.setDate(today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1)); // Adjust to Monday
            
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 6); // Sunday
            
            return { start: startDate, end: endDate };
        }

        function getWeekKey(week) {
            const startStr = formatDate(week.start);
            const endStr = formatDate(week.end);
            return `${startStr}_${endStr}`;
        }

        function updateWeekDisplay() {
            const startStr = app.currentWeek.start.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            const endStr = app.currentWeek.end.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            document.getElementById('currentWeek').textContent = `${startStr} - ${endStr}`;
        }

        function changeWeek(direction) {
            const newStart = new Date(app.currentWeek.start);
            newStart.setDate(newStart.getDate() + (direction * 7));
            
            const newEnd = new Date(newStart);
            newEnd.setDate(newStart.getDate() + 6);
            
            app.currentWeek = { start: newStart, end: newEnd };
            
            loadSchedule();
        }

        function createSchedule() {
            // Create empty schedule
            const weekKey = getWeekKey(app.currentWeek);
            app.schedules[weekKey] = {
                week: weekKey,
                startDate: formatDate(app.currentWeek.start),
                endDate: formatDate(app.currentWeek.end),
                entries: []
            };
            
            // Add entries for all crew members
            app.crewMembers.forEach(crew => {
                for (let i = 0; i < 7; i++) {
                    const date = new Date(app.currentWeek.start);
                    date.setDate(date.getDate() + i);
                    
                    app.schedules[weekKey].entries.push({
                        crewId: crew.id,
                        crewName: crew.name,
                        crewRole: crew.role,
                        crewOutlet: crew.outlet,
                        date: formatDate(date),
                        startTime: '',
                        endTime: '',
                        duties: '',
                        remarks: ''
                    });
                }
            });
            
            // Enter edit mode
            app.scheduleEditMode = true;
            updateScheduleControls();
            
            // Render schedule
            renderSchedule(app.schedules[weekKey]);
        }

        function saveSchedule() {
            // Save to localStorage
            saveData();
            
            // Exit edit mode
            app.scheduleEditMode = false;
            updateScheduleControls();
            
            // Show notification
            showNotification('Schedule saved successfully', 'success');
        }

        function updateScheduleControls() {
            const createBtn = document.getElementById('createScheduleBtn');
            const saveBtn = document.getElementById('saveScheduleBtn');
            
            if (app.scheduleEditMode) {
                createBtn.style.display = 'none';
                saveBtn.style.display = 'inline-flex';
            } else {
                createBtn.style.display = 'inline-flex';
                saveBtn.style.display = 'none';
            }
        }

        function showNoSchedule() {
            const container = document.getElementById('scheduleTableContainer');
            container.innerHTML = '<div class="no-schedule" id="noScheduleMessage">This week schedule is not yet available</div>';
        }

        function renderSchedule(schedule) {
            const container = document.getElementById('scheduleTableContainer');
            
            // Create table
            const table = document.createElement('table');
            table.className = 'schedule-table';
            
            // Create header
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            // Add empty cell for crew info
            const emptyHeader = document.createElement('th');
            emptyHeader.textContent = 'Employee';
            headerRow.appendChild(emptyHeader);
            
            // Add day headers
            for (let i = 0; i < 7; i++) {
                const date = new Date(app.currentWeek.start);
                date.setDate(date.getDate() + i);
                
                const dayHeader = document.createElement('th');
                dayHeader.className = 'day-header';
                dayHeader.innerHTML = `
                    ${date.toLocaleDateString('en-US', { weekday: 'short' })}
                    <div class="date-label">${date.getDate()}</div>
                `;
                headerRow.appendChild(dayHeader);
            }
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Create body
            const tbody = document.createElement('tbody');
            
            // Group entries by crew
            const crewEntries = {};
            schedule.entries.forEach(entry => {
                if (!crewEntries[entry.crewId]) {
                    crewEntries[entry.crewId] = [];
                }
                crewEntries[entry.crewId].push(entry);
            });
            
            // Add rows for each crew
            Object.keys(crewEntries).forEach(crewId => {
                const entries = crewEntries[crewId];
                const crew = app.crewMembers.find(c => c.id === crewId);
                
                // Create crew info row
                const crewRow = document.createElement('tr');
                
                // Crew info cell
                const crewCell = document.createElement('td');
                crewCell.className = 'employee-info';
                crewCell.innerHTML = `
                    <div><strong>${crew.name}</strong></div>
                    <div>${crew.role}</div>
                    <div>${crew.outlet}</div>
                `;
                crewRow.appendChild(crewCell);
                
                // Add schedule cells for each day
                for (let i = 0; i < 7; i++) {
                    const date = new Date(app.currentWeek.start);
                    date.setDate(date.getDate() + i);
                    const dateStr = formatDate(date);
                    
                    const entry = entries.find(e => e.date === dateStr);
                    const scheduleCell = document.createElement('td');
                    scheduleCell.className = 'schedule-cell';
                    
                    if (entry) {
                        let statusClass = 'schedule-working';
                        let statusText = '';
                        
                        if (entry.remarks === 'Off') {
                            statusClass = 'schedule-off';
                            statusText = 'Off Day';
                        } else if (entry.remarks === 'Annual Leave') {
                            statusClass = 'schedule-leave';
                            statusText = 'Annual Leave';
                        } else if (entry.startTime && entry.endTime) {
                            statusText = `${entry.startTime} - ${entry.endTime}`;
                        }
                        
                        if (app.scheduleEditMode) {
                            scheduleCell.innerHTML = `
                                <div>
                                    <input type="time" class="form-input" value="${entry.startTime}" data-crew="${crewId}" data-date="${dateStr}" data-field="startTime" style="margin-bottom: 5px;">
                                    <input type="time" class="form-input" value="${entry.endTime}" data-crew="${crewId}" data-date="${dateStr}" data-field="endTime" style="margin-bottom: 5px;">
                                    <input type="text" class="form-input" value="${entry.duties}" data-crew="${crewId}" data-date="${dateStr}" data-field="duties" placeholder="Duties" style="margin-bottom: 5px;">
                                    <select class="form-input" data-crew="${crewId}" data-date="${dateStr}" data-field="remarks">
                                        <option value="">None</option>
                                        <option value="Off" ${entry.remarks === 'Off' ? 'selected' : ''}>Off</option>
                                        <option value="Annual Leave" ${entry.remarks === 'Annual Leave' ? 'selected' : ''}>Annual Leave</option>
                                        <option value="Emergency Leave" ${entry.remarks === 'Emergency Leave' ? 'selected' : ''}>Emergency Leave</option>
                                    </select>
                                </div>
                            `;
                            
                            // Add event listeners
                            scheduleCell.querySelectorAll('input, select').forEach(input => {
                                input.addEventListener('change', updateScheduleEntry);
                            });
                        } else {
                            scheduleCell.innerHTML = `
                                <div class="schedule-status ${statusClass}">${statusText}</div>
                                ${entry.duties ? `<div style="font-size: 12px; margin-top: 5px;">${entry.duties}</div>` : ''}
                            `;
                        }
                    }
                    
                    crewRow.appendChild(scheduleCell);
                }
                
                tbody.appendChild(crewRow);
            });
            
            // Add total hours row if not in edit mode
            if (!app.scheduleEditMode) {
                const totalRow = document.createElement('tr');
                totalRow.className = 'totals-row';
                
                const totalLabel = document.createElement('td');
                totalLabel.textContent = 'Total Hours';
                totalRow.appendChild(totalLabel);
                
                // Calculate total hours for each day
                for (let i = 0; i < 7; i++) {
                    const date = new Date(app.currentWeek.start);
                    date.setDate(date.getDate() + i);
                    const dateStr = formatDate(date);
                    
                    let totalHours = 0;
                    
                    Object.keys(crewEntries).forEach(crewId => {
                        const entries = crewEntries[crewId];
                        const entry = entries.find(e => e.date === dateStr);
                        
                        if (entry && entry.startTime && entry.endTime && !entry.remarks) {
                            const start = new Date(`2000-01-01T${entry.startTime}`);
                            const end = new Date(`2000-01-01T${entry.endTime}`);
                            const hours = (end - start) / (1000 * 60 * 60);
                            totalHours += hours;
                        }
                    });
                    
                    const totalCell = document.createElement('td');
                    totalCell.textContent = totalHours.toFixed(1);
                    totalRow.appendChild(totalCell);
                }
                
                tbody.appendChild(totalRow);
            }
            
            table.appendChild(tbody);
            container.innerHTML = '';
            container.appendChild(table);
        }

        function updateScheduleEntry(e) {
            const crewId = e.target.dataset.crew;
            const date = e.target.dataset.date;
            const field = e.target.dataset.field;
            const value = e.target.value;
            
            const weekKey = getWeekKey(app.currentWeek);
            const schedule = app.schedules[weekKey];
            
            if (schedule) {
                const entry = schedule.entries.find(e => e.crewId === crewId && e.date === date);
                if (entry) {
                    entry[field] = value;
                }
            }
        }

        // Orders Functions
        function loadOrders() {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = '';
            
            if (app.orders.length === 0) {
                // Initialize with sample orders
                app.orders = [
                    {
                        id: 'ORD-0001',
                        date: getCurrentDateStr(),
                        customer: 'John Doe',
                        items: [
                            { name: 'Sample Item 1', quantity: 2, price: 10.00 },
                            { name: 'Sample Item 2', quantity: 1, price: 20.00 }
                        ],
                        total: 40.00,
                        outlet: 'HQ',
                        status: 'Pending',
                        assignedTo: ''
                    },
                    {
                        id: 'ORD-0002',
                        date: getCurrentDateStr(),
                        customer: 'Jane Smith',
                        items: [
                            { name: 'Sample Item 3', quantity: 3, price: 15.00 }
                        ],
                        total: 45.00,
                        outlet: 'BLM',
                        status: 'Assigned',
                        assignedTo: '0003'
                    }
                ];
                saveData();
            }
            
            app.orders.forEach(order => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.date}</td>
                    <td>${order.customer}</td>
                    <td>${order.items.map(i => `${i.name} (x${i.quantity})`).join(', ')}</td>
                    <td>$${order.total.toFixed(2)}</td>
                    <td>${order.outlet}</td>
                    <td><span class="status-badge ${order.status === 'Pending' ? 'status-inactive' : 'status-active'}">${order.status}</span></td>
                    <td>
                        ${app.user.isAdmin ? 
                            `<button class="btn btn-sm btn-danger" onclick="assignOrder('${order.id}')">Assign</button>` : 
                            order.assignedTo === app.user.id ? 
                            `<button class="btn btn-sm btn-primary" onclick="generateCashbillFromOrder('${order.id}')">Generate Cashbill</button>` : 
                            ''}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function assignOrder(orderId) {
            // In a real app, this would open a modal to assign the order to a crew member
            // For simplicity, we'll just assign it to the current admin
            const orderIndex = app.orders.findIndex(o => o.id === orderId);
            if (orderIndex === -1) return;
            
            app.orders[orderIndex].status = 'Assigned';
            app.orders[orderIndex].assignedTo = app.user.id;
            saveData();
            
            // Reload orders
            loadOrders();
            
            // Show notification
            showNotification('Order assigned successfully', 'success');
        }

        function generateCashbillFromOrder(orderId) {
            // Find order
            const order = app.orders.find(o => o.id === orderId);
            if (!order) return;
            
            // Open cashbill modal with order data
            openCashbillModal();
            
            // Set customer info
            document.getElementById('customerName').value = order.customer;
            document.getElementById('customerPhone').value = '';
            
            // Add items from order
            const itemsContainer = document.getElementById('cashbillItems');
            itemsContainer.innerHTML = '';
            
            order.items.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'form-row cashbill-item';
                itemElement.innerHTML = `
                    <div class="form-col">
                        <div class="form-group">
                            <select class="form-input item-select" required>
                                <option value="">Select Item</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <input type="number" class="form-input item-quantity" placeholder="Quantity" min="1" value="${item.quantity}" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <input type="number" class="form-input item-price" placeholder="Price" step="0.01" value="${item.price}" readonly>
                        </div>
                    </div>
                    <div class="form-col" style="display: flex; align-items: end;">
                        <button type="button" class="btn btn-danger remove-item" ${index === 0 ? 'style="display: none;"' : ''}>
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                itemsContainer.appendChild(itemElement);
            });
            
            // Populate dropdown
            populateItemDropdown();
            
            // Set selected values
            const itemSelects = document.querySelectorAll('.item-select');
            itemSelects.forEach((select, index) => {
                if (order.items[index]) {
                    // Try to find matching item by name
                    const stockItem = app.stockItems.find(si => si.name === order.items[index].name);
                    if (stockItem) {
                        select.value = stockItem.code;
                    }
                }
            });
            
            // Calculate total
            calculateTotal();
        }

        // Crew Management Functions
        function loadCrewMembers() {
            const tbody = document.getElementById('crewTableBody');
            tbody.innerHTML = '';
            
            app.crewMembers.forEach(crew => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${crew.id}</td>
                    <td>${crew.name}</td>
                    <td>${crew.role}</td>
                    <td>${crew.outlet}</td>
                    <td><span class="status-badge ${crew.status === 'Active' ? 'status-active' : 'status-inactive'}">${crew.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editCrew('${crew.id}')">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCrew('${crew.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function openCrewModal() {
            // Reset form
            elements.crewForm.reset();
            
            // Update modal title
            document.getElementById('crewModalTitle').textContent = 'Add Crew Member';
            
            // Show modal
            elements.crewModal.classList.add('active');
        }

        function closeCrewModal() {
            elements.crewModal.classList.remove('active');
        }

        function saveCrew() {
            // Get form data
            const id = document.getElementById('crewId').value;
            const name = document.getElementById('crewName').value;
            const role = document.getElementById('crewRole').value;
            const outlet = document.getElementById('crewOutlet').value;
            
            // Check if crew member already exists
            const existingCrewIndex = app.crewMembers.findIndex(c => c.id === id);
            
            if (existingCrewIndex !== -1) {
                // Update existing crew member
                app.crewMembers[existingCrewIndex] = {
                    ...app.crewMembers[existingCrewIndex],
                    name,
                    role,
                    outlet
                };
            } else {
                // Add new crew member
                app.crewMembers.push({
                    id,
                    name,
                    role,
                    outlet,
                    status: 'Active'
                });
            }
            
            // Save to localStorage
            saveCrewMembers();
            
            // Close modal
            closeCrewModal();
            
            // Reload crew members
            loadCrewMembers();
            
            // Show notification
            showNotification('Crew member saved successfully', 'success');
        }

        function saveCrewMembers() {
            localStorage.setItem('pneCrewMembers', JSON.stringify(app.crewMembers));
        }

        function editCrew(id) {
            // Find crew member
            const crew = app.crewMembers.find(c => c.id === id);
            if (!crew) return;
            
            // Open modal with crew data
            openCrewModal();
            
            // Update modal title
            document.getElementById('crewModalTitle').textContent = 'Edit Crew Member';
            
            // Populate form
            document.getElementById('crewId').value = crew.id;
            document.getElementById('crewId').disabled = true;
            document.getElementById('crewName').value = crew.name;
            document.getElementById('crewRole').value = crew.role;
            document.getElementById('crewOutlet').value = crew.outlet;
        }

        function deleteCrew(id) {
            if (confirm('Are you sure you want to delete this crew member?')) {
                // Find and remove crew member
                const crewIndex = app.crewMembers.findIndex(c => c.id === id);
                if (crewIndex === -1) return;
                
                app.crewMembers.splice(crewIndex, 1);
                
                // Save to localStorage
                saveCrewMembers();
                
                // Reload crew members
                loadCrewMembers();
                
                // Show notification
                showNotification('Crew member deleted successfully', 'success');
            }
        }

        // Stock Management Functions
        function loadStockItems() {
            const tbody = document.getElementById('stockTableBody');
            tbody.innerHTML = '';
            
            app.stockItems.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.code}</td>
                    <td>${item.name}</td>
                    <td>${item.description}</td>
                    <td>$${item.price.toFixed(2)}</td>
                    <td>${item.quantity}</td>
                    <td>${item.outlet}</td>
                    <td>
                        ${app.user.isAdmin ? 
                            `<button class="btn btn-sm btn-primary" onclick="editStock('${item.code}')">Edit</button>
                             <button class="btn btn-sm btn-danger" onclick="deleteStock('${item.code}')">Delete</button>` : 
                            ''}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function openStockModal() {
            // Reset form
            elements.stockForm.reset();
            
            // Update modal title
            document.getElementById('stockModalTitle').textContent = 'Add Stock Item';
            
            // Show modal
            elements.stockModal.classList.add('active');
        }

        function closeStockModal() {
            elements.stockModal.classList.remove('active');
        }

        function saveStock() {
            // Get form data
            const code = document.getElementById('itemCode').value;
            const name = document.getElementById('itemName').value;
            const description = document.getElementById('itemDescription').value;
            const price = parseFloat(document.getElementById('itemPrice').value);
            const quantity = parseInt(document.getElementById('itemQuantity').value);
            const outlet = document.getElementById('itemOutlet').value;
            
            // Check if stock item already exists
            const existingStockIndex = app.stockItems.findIndex(s => s.code === code);
            
            if (existingStockIndex !== -1) {
                // Update existing stock item
                app.stockItems[existingStockIndex] = {
                    ...app.stockItems[existingStockIndex],
                    name,
                    description,
                    price,
                    quantity,
                    outlet
                };
            } else {
                // Add new stock item
                app.stockItems.push({
                    code,
                    name,
                    description,
                    price,
                    quantity,
                    outlet
                });
            }
            
            // Save to localStorage
            saveStockItems();
            
            // Close modal
            closeStockModal();
            
            // Reload stock items
            loadStockItems();
            
            // Show notification
            showNotification('Stock item saved successfully', 'success');
        }

        function saveStockItems() {
            localStorage.setItem('pneStockItems', JSON.stringify(app.stockItems));
        }

        function editStock(code) {
            // Find stock item
            const stock = app.stockItems.find(s => s.code === code);
            if (!stock) return;
            
            // Open modal with stock data
            openStockModal();
            
            // Update modal title
            document.getElementById('stockModalTitle').textContent = 'Edit Stock Item';
            
            // Populate form
            document.getElementById('itemCode').value = stock.code;
            document.getElementById('itemCode').disabled = true;
            document.getElementById('itemName').value = stock.name;
            document.getElementById('itemDescription').value = stock.description;
            document.getElementById('itemPrice').value = stock.price;
            document.getElementById('itemQuantity').value = stock.quantity;
            document.getElementById('itemOutlet').value = stock.outlet;
        }

        function deleteStock(code) {
            if (confirm('Are you sure you want to delete this stock item?')) {
                // Find and remove stock item
                const stockIndex = app.stockItems.findIndex(s => s.code === code);
                if (stockIndex === -1) return;
                
                app.stockItems.splice(stockIndex, 1);
                
                // Save to localStorage
                saveStockItems();
                
                // Reload stock items
                loadStockItems();
                
                // Show notification
                showNotification('Stock item deleted successfully', 'success');
            }
        }

        // Utility Functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Hide loading overlay
            setTimeout(() => {
                elements.loadingOverlay.style.opacity = '0';
                setTimeout(() => {
                    elements.loadingOverlay.style.display = 'none';
                }, 500);
            }, 1000);
            
            // Initialize app
            initApp();
        });
    </script>
</body>
</html>
