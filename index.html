<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNE ARENA - Advanced Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #28cc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --sidebar-width: 250px;
            --sidebar-collapsed-width: 0;
            --morning-shift: #FFD700;
            --evening-shift: #FF8C00;
            --night-shift: #4B0082;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ffffff;
            color: #333;
            transition: background-color 0.3s, color 0.3s;
        }
        /* Dark Mode Styles */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        body.dark-mode .card,
        body.dark-mode .form-container,
        body.dark-mode .table-container,
        body.dark-mode .modal-content,
        body.dark-mode .sidebar,
        body.dark-mode .top-navbar {
            background-color: #2d2d2d;
            color: #e0e0e0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        body.dark-mode .table {
            color: #e0e0e0;
        }
        body.dark-mode .table th,
        body.dark-mode .table td {
            border-color: #444;
        }
        body.dark-mode .form-control,
        body.dark-mode .form-select {
            background-color: #3a3a3a;
            border-color: #555;
            color: #e0e0e0;
        }
        body.dark-mode .btn {
            border: none;
        }
        body.dark-mode .btn-primary {
            background-color: #2980b9;
        }
        body.dark-mode .btn-success {
            background-color: #27ae60;
        }
        body.dark-mode .btn-danger {
            background-color: #c0392b;
        }
        body.dark-mode .btn-warning {
            background-color: #d35400;
        }
        body.dark-mode .sidebar-menu a:hover,
        body.dark-mode .sidebar-menu a.active {
            background-color: rgba(52, 152, 219, 0.2);
        }
        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #ffffff;
        }
        .login-card {
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 40px;
            width: 100%;
            max-width: 420px;
            transform: translateY(0);
            transition: transform 0.3s ease;
        }
        .login-card:hover {
            transform: translateY(-5px);
        }
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .login-logo {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .login-form .form-group {
            margin-bottom: 20px;
        }
        .login-form .form-control {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px 15px;
            font-size: 16px;
            transition: all 0.3s;
        }
        .login-form .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        .login-btn {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        /* Main Application */
        .app-container {
            display: none;
        }
        /* Top Navigation Bar */
        .top-navbar {
            background-color: white;
            color: var(--dark-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 60px;
            transition: background-color 0.3s;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            color: var(--primary-color);
            gap: 8px;
        }
        .navbar-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .search-bar {
            position: relative;
        }
        .search-bar input {
            padding: 8px 15px 8px 40px;
            border-radius: 20px;
            border: 1px solid #ddd;
            width: 250px;
            transition: width 0.3s;
        }
        .search-bar input:focus {
            width: 300px;
            outline: none;
            border-color: var(--primary-color);
        }
        .search-bar i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }
        .theme-toggle {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--dark-color);
            cursor: pointer;
            transition: color 0.3s;
        }
        .theme-toggle:hover {
            color: var(--primary-color);
        }
        .notification-icon {
            position: relative;
            font-size: 20px;
            color: var(--dark-color);
            cursor: pointer;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-role {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        .logout-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .logout-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 60px);
            background-color: white;
            color: var(--dark-color);
            transition: width 0.3s ease;
            overflow-x: hidden;
            z-index: 999;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }
        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }
        .sidebar-toggle {
            position: absolute;
            top: 15px;
            right: -40px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark-color);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .sidebar-toggle:hover {
            background-color: var(--light-color);
            transform: scale(1.1);
        }
        .sidebar-menu {
            margin-top: 20px;
            list-style: none;
            padding: 0 10px;
        }
        .sidebar-menu li {
            margin-bottom: 5px;
        }
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: var(--dark-color);
            text-decoration: none;
            transition: all 0.3s;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        .sidebar-menu a::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background-color: var(--primary-color);
            transform: translateX(-100%);
            transition: transform 0.3s;
        }
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
        }
        .sidebar-menu a:hover::before, .sidebar-menu a.active::before {
            transform: translateX(0);
        }
        .sidebar-menu i {
            margin-right: 10px;
            font-size: 18px;
            width: 20px;
            text-align: center;
        }
        .sidebar.collapsed .sidebar-menu span {
            display: none;
        }
        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: 60px;
            padding: 20px;
            transition: margin-left 0.3s ease;
            min-height: calc(100vh - 60px);
        }
        .main-content.expanded {
            margin-left: var(--sidebar-collapsed-width);
        }
        .page {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .page.active {
            display: block;
        }
        /* Dashboard */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        .dashboard-title {
            font-size: 28px;
            font-weight: 600;
            color: var(--dark-color);
        }
        .dashboard-actions {
            display: flex;
            gap: 10px;
        }
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 25px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background-color: var(--primary-color);
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .card-icon {
            font-size: 30px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        .card-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark-color);
            font-weight: 500;
        }
        .card-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--dark-color);
        }
        .card-change {
            font-size: 14px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .card-change.positive {
            color: var(--success-color);
        }
        .card-change.negative {
            color: var(--danger-color);
        }
        .chart-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
            height: 350px;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark-color);
        }
        .chart-options {
            display: flex;
            gap: 10px;
        }
        .chart-option {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .chart-option.active {
            background-color: var(--primary-color);
            color: white;
        }
        /* Schedule Section */
        .schedule-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .schedule-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--dark-color);
        }
        .schedule-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .view-toggle {
            display: flex;
            background-color: #f1f1f1;
            border-radius: 8px;
            overflow: hidden;
        }
        .view-option {
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        .view-option.active {
            background-color: var(--primary-color);
            color: white;
        }
        .schedule-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
        }
        .schedule-calendar {
            display: grid;
            grid-template-columns: 100px repeat(7, 1fr);
            gap: 1px;
            background-color: #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        .calendar-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
        }
        .calendar-day {
            background-color: white;
            padding: 10px;
            min-height: 100px;
            position: relative;
        }
        .calendar-day-header {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark-color);
        }
        .calendar-date {
            font-size: 12px;
            color: #777;
            margin-bottom: 5px;
        }
        .crew-schedule {
            display: flex;
            align-items: center;
            padding: 5px;
            margin-bottom: 5px;
            border-radius: 6px;
            font-size: 12px;
            cursor: move;
            transition: all 0.3s;
        }
        .crew-schedule:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .crew-schedule.morning-shift {
            background-color: rgba(255, 215, 0, 0.2);
            color: #b8860b;
        }
        .crew-schedule.evening-shift {
            background-color: rgba(255, 140, 0, 0.2);
            color: #ff6347;
        }
        .crew-schedule.night-shift {
            background-color: rgba(75, 0, 130, 0.2);
            color: #4B0082;
        }
        .crew-schedule.off-day {
            background-color: #f8f9fa;
            color: #777;
        }
        .crew-schedule.annual-leave {
            background-color: #fff3cd;
            color: #856404;
        }
        .crew-name {
            font-weight: 600;
            margin-right: 5px;
        }
        .shift-type {
            font-size: 10px;
            padding: 2px 5px;
            border-radius: 10px;
            background-color: rgba(0,0,0,0.1);
        }
        .monthly-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        .month-header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: 600;
        }
        .month-day {
            background-color: white;
            padding: 10px;
            min-height: 120px;
            position: relative;
        }
        .month-day-number {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .month-day.other-month {
            background-color: #f8f9fa;
            color: #aaa;
        }
        .month-day.today {
            background-color: rgba(52, 152, 219, 0.1);
        }
        .month-day.today .month-day-number {
            color: var(--primary-color);
            font-weight: bold;
        }
        .month-crew-count {
            font-size: 11px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            display: inline-block;
            margin-top: 5px;
        }
        /* Forms */
        .form-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 25px;
            margin-bottom: 20px;
        }
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .form-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark-color);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--dark-color);
        }
        .form-control, .form-select {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px 15px;
            width: 100%;
            transition: all 0.3s;
        }
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        /* Tables */
        .table-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 20px;
            overflow-x: auto;
        }
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .table-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark-color);
        }
        .table-actions {
            display: flex;
            gap: 10px;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--dark-color);
            position: sticky;
            top: 0;
        }
        .table tr:hover {
            background-color: #f8f9fa;
        }
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        .btn-success:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 204, 113, 0.3);
        }
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        .btn-danger:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        .btn-warning:hover {
            background-color: #e67e22;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }
        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #7f8c8d;
            transform: translateY(-2px);
        }
        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
        }
        .btn-lg {
            padding: 12px 24px;
            font-size: 16px;
        }
        .btn-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        /* Status badges */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .badge-draft {
            background-color: var(--warning-color);
            color: white;
        }
        .badge-committed {
            background-color: var(--success-color);
            color: white;
        }
        .badge-pending {
            background-color: var(--primary-color);
            color: white;
        }
        .badge-fulfilled {
            background-color: var(--success-color);
            color: white;
        }
        /* Time Tracking */
        .time-tracking-container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }
        .time-status {
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        .time-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        .time-record {
            margin-top: 25px;
            text-align: left;
        }
        .time-record h4 {
            margin-bottom: 15px;
            font-weight: 600;
        }
        .time-record table {
            width: 100%;
            border-collapse: collapse;
        }
        .time-record th, .time-record td {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }
        .time-record th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        /* Create Cashbill Button */
        .create-cashbill-btn {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
            z-index: 100;
        }
        .create-cashbill-btn:hover {
            background-color: #27ae60;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(40, 204, 113, 0.4);
        }
        /* Cashbill Summary */
        .cashbill-summary {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
        }
        .cashbill-summary h3 {
            margin-bottom: 15px;
            font-weight: 600;
        }
        .cashbill-summary .total-count {
            font-size: 48px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        /* Loading Animation */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* No Schedule Message */
        .no-schedule-message {
            text-align: center;
            padding: 40px;
            background-color: #f8f9fa;
            border-radius: 12px;
            color: #7f8c8d;
            font-size: 18px;
        }
        /* Edit Mode Styles */
        .edit-mode-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        .edit-mode-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        .save-mode-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        .save-mode-btn:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }
        .schedule-cell.editable {
            cursor: pointer;
        }
        .schedule-cell.editable:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        .schedule-cell.editing {
            background-color: rgba(52, 152, 219, 0.2);
        }
        .schedule-cell .edit-input {
            width: 100%;
            padding: 5px;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            margin-top: 5px;
        }
        .schedule-cell .status-select {
            width: 100%;
            padding: 5px;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            margin-top: 5px;
        }
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark-color);
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.3s;
        }
        .modal-close:hover {
            color: var(--danger-color);
        }
        .modal-body {
            padding: 25px;
        }
        .modal-footer {
            padding: 15px 25px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 3000;
        }
        .toast {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            min-width: 250px;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .toast-success {
            border-left: 4px solid var(--success-color);
        }
        .toast-error {
            border-left: 4px solid var(--danger-color);
        }
        .toast-warning {
            border-left: 4px solid var(--warning-color);
        }
        .toast-icon {
            margin-right: 10px;
            font-size: 20px;
        }
        .toast-success .toast-icon {
            color: var(--success-color);
        }
        .toast-error .toast-icon {
            color: var(--danger-color);
        }
        .toast-warning .toast-icon {
            color: var(--warning-color);
        }
        /* Print Styles */
        @media print {
            .top-navbar, .sidebar, .btn, .modal, .toast-container, .create-cashbill-btn {
                display: none !important;
            }
            
            .main-content {
                margin-left: 0 !important;
                margin-top: 0 !important;
                padding: 0 !important;
            }
            
            .page {
                display: block !important;
            }
        }
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: var(--sidebar-collapsed-width);
            }
            
            .sidebar .sidebar-menu span {
                display: none;
            }
            
            .main-content {
                margin-left: var(--sidebar-collapsed-width);
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .schedule-controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .search-bar input {
                width: 150px;
            }
            
            .search-bar input:focus {
                width: 180px;
            }
        }
        /* Notification Panel */
        .notification-panel {
            position: fixed;
            top: 60px;
            right: 20px;
            width: 350px;
            max-height: 70vh;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1500;
            overflow: hidden;
            display: none;
            flex-direction: column;
        }
        .notification-panel.active {
            display: flex;
        }
        .notification-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .notification-title {
            font-size: 18px;
            font-weight: 600;
        }
        .notification-list {
            flex: 1;
            overflow-y: auto;
        }
        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f1f1f1;
            transition: background-color 0.3s;
        }
        .notification-item:hover {
            background-color: #f8f9fa;
        }
        .notification-item.unread {
            background-color: rgba(52, 152, 219, 0.05);
        }
        .notification-item-title {
            font-weight: 500;
            margin-bottom: 5px;
        }
        .notification-item-message {
            font-size: 14px;
            color: #777;
            margin-bottom: 5px;
        }
        .notification-item-time {
            font-size: 12px;
            color: #aaa;
        }
        /* Advanced Search */
        .advanced-search {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 700px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1500;
            padding: 25px;
            display: none;
        }
        .advanced-search.active {
            display: block;
        }
        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .search-title {
            font-size: 20px;
            font-weight: 600;
        }
        .search-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .search-results {
            max-height: 300px;
            overflow-y: auto;
        }
        .search-result-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .search-result-item:hover {
            background-color: #f8f9fa;
        }
        .search-result-title {
            font-weight: 500;
            margin-bottom: 5px;
        }
        .search-result-description {
            font-size: 14px;
            color: #777;
        }
        /* Shift Legend */
        .shift-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        .legend-color.morning {
            background-color: var(--morning-shift);
        }
        .legend-color.evening {
            background-color: var(--evening-shift);
        }
        .legend-color.night {
            background-color: var(--night-shift);
        }
        .legend-color.off {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
        }
        .legend-color.leave {
            background-color: #fff3cd;
        }
        /* Document Upload */
        .document-upload {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .document-upload:hover {
            border-color: var(--primary-color);
            background-color: rgba(52, 152, 219, 0.05);
        }
        .document-upload.dragover {
            border-color: var(--success-color);
            background-color: rgba(40, 204, 113, 0.05);
        }
        .upload-icon {
            font-size: 40px;
            color: #aaa;
            margin-bottom: 15px;
        }
        .upload-text {
            font-size: 16px;
            color: #777;
            margin-bottom: 10px;
        }
        .upload-subtext {
            font-size: 14px;
            color: #aaa;
        }
        .uploaded-files {
            margin-top: 20px;
        }
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .file-icon {
            font-size: 20px;
            color: var(--primary-color);
        }
        .file-name {
            font-weight: 500;
        }
        .file-size {
            font-size: 12px;
            color: #777;
        }
        .file-actions {
            display: flex;
            gap: 5px;
        }
        /* Report Generator */
        .report-generator {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 25px;
            margin-bottom: 20px;
        }
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .report-title {
            font-size: 20px;
            font-weight: 600;
        }
        .report-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .report-preview {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        .report-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .report-preview-title {
            font-weight: 600;
        }
        .report-preview-content {
            max-height: 300px;
            overflow-y: auto;
        }
        /* Audit Trail */
        .audit-trail {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 25px;
            margin-bottom: 20px;
        }
        .audit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .audit-title {
            font-size: 20px;
            font-weight: 600;
        }
        .audit-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .audit-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            gap: 15px;
        }
        .audit-icon {
            font-size: 20px;
            color: var(--primary-color);
        }
        .audit-content {
            flex: 1;
        }
        .audit-action {
            font-weight: 500;
            margin-bottom: 5px;
        }
        .audit-description {
            font-size: 14px;
            color: #777;
            margin-bottom: 5px;
        }
        .audit-time {
            font-size: 12px;
            color: #aaa;
        }
        /* Keyboard Shortcuts */
        .shortcuts-modal {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 15px;
            z-index: 1000;
            display: none;
        }
        .shortcuts-modal.active {
            display: block;
        }
        .shortcuts-title {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .shortcut-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .shortcut-key {
            background-color: #f1f1f1;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-building"></i> PNE ARENA
                </div>
                <p>Advanced Management System</p>
            </div>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">Staff ID</label>
                    <input type="text" class="form-control" id="username" placeholder="Enter Staff ID" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="Enter Password" required>
                </div>
                <button type="submit" class="login-btn">Login</button>
            </form>
            <div class="mt-3 text-center">
                <small>Default password: 0000</small>
            </div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div class="app-container" id="appContainer">
        <!-- Top Navigation Bar -->
        <div class="top-navbar">
            <div class="logo">
                <i class="fas fa-building"></i> PNE ARENA
            </div>
            
            <div class="navbar-controls">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search..." id="searchInput">
                </div>
                
                <button class="theme-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
                
                <div class="notification-icon" onclick="toggleNotifications()">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </div>
            </div>
            
            <div class="user-info">
                <div class="user-role" id="userRole">Admin</div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
        
        <!-- Notification Panel -->
        <div class="notification-panel" id="notificationPanel">
            <div class="notification-header">
                <div class="notification-title">Notifications</div>
                <button class="modal-close" onclick="toggleNotifications()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notification-list">
                <div class="notification-item unread">
                    <div class="notification-item-title">New Order Received</div>
                    <div class="notification-item-message">A new online order has been received from customer John Doe.</div>
                    <div class="notification-item-time">5 minutes ago</div>
                </div>
                <div class="notification-item unread">
                    <div class="notification-item-title">Schedule Conflict</div>
                    <div class="notification-item-message">There is a scheduling conflict for next Monday.</div>
                    <div class="notification-item-time">1 hour ago</div>
                </div>
                <div class="notification-item">
                    <div class="notification-item-title">System Update</div>
                    <div class="notification-item-message">The system will be updated tonight at 10 PM.</div>
                    <div class="notification-item-time">3 hours ago</div>
                </div>
            </div>
        </div>
        
        <!-- Advanced Search -->
        <div class="advanced-search" id="advancedSearch">
            <div class="search-header">
                <div class="search-title">Advanced Search</div>
                <button class="modal-close" onclick="toggleAdvancedSearch()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="search-options">
                <div class="form-group">
                    <label class="form-label">Search In</label>
                    <select class="form-select" id="searchCategory">
                        <option value="all">All Modules</option>
                        <option value="cashbill">Cashbill</option>
                        <option value="logbook">Logbook</option>
                        <option value="quotation">Quotation</option>
                        <option value="schedule">Schedule</option>
                        <option value="onlineOrder">Online Order</option>
                        <option value="crew">Crew</option>
                        <option value="stock">Stock</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Date Range</label>
                    <input type="text" class="form-control" id="searchDateRange" placeholder="Select date range">
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select class="form-select" id="searchStatus">
                        <option value="all">All Statuses</option>
                        <option value="draft">Draft</option>
                        <option value="pending">Pending</option>
                        <option value="committed">Committed</option>
                        <option value="fulfilled">Fulfilled</option>
                    </select>
                </div>
            </div>
            <div class="search-results">
                <div class="search-result-item">
                    <div class="search-result-title">Cashbill #INV-0001</div>
                    <div class="search-result-description">Customer: John Doe | Amount: RM 250.00 | Date: 2023-06-15</div>
                </div>
                <div class="search-result-item">
                    <div class="search-result-title">Log Entry #LOG-12345</div>
                    <div class="search-result-description">Description: System maintenance | Crew: Danial Danish | Date: 2023-06-14</div>
                </div>
                <div class="search-result-item">
                    <div class="search-result-title">Quotation #QTN-0001</div>
                    <div class="search-result-description">Client: ABC Company | Amount: RM 1,500.00 | Date: 2023-06-10</div>
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-chevron-right"></i>
            </button>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" onclick="showPage('dashboard')"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                <li><a href="#" onclick="showPage('cashbill')"><i class="fas fa-receipt"></i> <span>Cashbill</span></a></li>
                <li><a href="#" onclick="showPage('logbook')"><i class="fas fa-book"></i> <span>Logbook</span></a></li>
                <li><a href="#" onclick="showPage('quotation')"><i class="fas fa-file-invoice"></i> <span>Quotation</span></a></li>
                <li><a href="#" onclick="showPage('schedule')"><i class="fas fa-calendar-alt"></i> <span>Schedule Timetable</span></a></li>
                <li><a href="#" onclick="showPage('onlineOrder')"><i class="fas fa-shopping-cart"></i> <span>Online Order</span></a></li>
                <li><a href="#" onclick="showPage('crewManagement')" id="crewManagementLink" style="display: none;"><i class="fas fa-users"></i> <span>Crew Management</span></a></li>
                <li><a href="#" onclick="showPage('stockManagement')"><i class="fas fa-boxes"></i> <span>Stock Management</span></a></li>
                <li><a href="#" onclick="showPage('timeTracking')"><i class="fas fa-clock"></i> <span>Time Tracking</span></a></li>
                <li><a href="#" onclick="showPage('reports')"><i class="fas fa-chart-bar"></i> <span>Reports</span></a></li>
                <li><a href="#" onclick="showPage('auditTrail')"><i class="fas fa-history"></i> <span>Audit Trail</span></a></li>
            </ul>
        </div>
        
        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboard">
                <div class="dashboard-header">
                    <h2 class="dashboard-title">Dashboard</h2>
                    <div class="dashboard-actions">
                        <button class="btn btn-primary btn-sm" onclick="refreshDashboard()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="exportDashboard()">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-icon text-primary">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="card-title">Total Cashbills</div>
                        <div class="card-value" id="totalCashbills">0</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> 12% from last month
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon text-success">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="card-title">Total Revenue</div>
                        <div class="card-value" id="totalRevenue">RM 0.00</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> 8.5% from last month
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon text-info">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="card-title">Log Entries</div>
                        <div class="card-value" id="totalLogEntries">0</div>
                        <div class="card-change negative">
                            <i class="fas fa-arrow-down"></i> 3% from last month
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon text-warning">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="card-title">Pending Orders</div>
                        <div class="card-value" id="pendingOrders">0</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> 5 new today
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="chart-container">
                            <div class="chart-header">
                                <div class="chart-title">Revenue Overview</div>
                                <div class="chart-options">
                                    <div class="chart-option active" onclick="changeChartPeriod('week', this)">Week</div>
                                    <div class="chart-option" onclick="changeChartPeriod('month', this)">Month</div>
                                    <div class="chart-option" onclick="changeChartPeriod('year', this)">Year</div>
                                </div>
                            </div>
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="chart-container">
                            <div class="chart-header">
                                <div class="chart-title">Activity Distribution</div>
                            </div>
                            <canvas id="activityChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="table-container">
                            <div class="table-header">
                                <div class="table-title">Recent Cashbills</div>
                                <div class="table-actions">
                                    <button class="btn btn-sm btn-primary" onclick="showPage('cashbill')">
                                        <i class="fas fa-plus"></i> New
                                    </button>
                                </div>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Invoice #</th>
                                        <th>Customer</th>
                                        <th>Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentCashbills">
                                    <tr>
                                        <td colspan="5" class="text-center">No cashbills found</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="table-container">
                            <div class="table-header">
                                <div class="table-title">Recent Log Entries</div>
                                <div class="table-actions">
                                    <button class="btn btn-sm btn-primary" onclick="showPage('logbook')">
                                        <i class="fas fa-plus"></i> New
                                    </button>
                                </div>
                            </div>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Crew</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentLogEntries">
                                    <tr>
                                        <td colspan="4" class="text-center">No log entries found</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Schedule Page -->
            <div class="page" id="schedule">
                <div class="schedule-controls">
                    <h2 class="schedule-title">Schedule Timetable</h2>
                    <div class="schedule-actions">
                        <div class="view-toggle">
                            <div class="view-option active" onclick="changeScheduleView('weekly', this)">Weekly</div>
                            <div class="view-option" onclick="changeScheduleView('monthly', this)">Monthly</div>
                        </div>
                        <input type="text" class="form-control d-inline-block" id="scheduleDatePicker" style="width: auto;" placeholder="Select date">
                        <button class="btn btn-primary" onclick="loadSchedule()">
                            <i class="fas fa-search"></i> Find
                        </button>
                        <button class="btn btn-secondary" onclick="setTodaySchedule()">
                            <i class="fas fa-calendar-day"></i> Today
                        </button>
                        <button class="btn btn-success" onclick="createNewSchedule()">
                            <i class="fas fa-plus"></i> Create Schedule
                        </button>
                        <button class="btn btn-primary" onclick="saveSchedule()">
                            <i class="fas fa-save"></i> Save Schedule
                        </button>
                        <button id="editScheduleBtn" class="edit-mode-btn" onclick="toggleEditMode()">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button id="saveScheduleChangesBtn" class="save-mode-btn" style="display: none;" onclick="saveScheduleChanges()">
                            <i class="fas fa-check"></i> Save Changes
                        </button>
                    </div>
                </div>
                
                <div class="shift-legend">
                    <div class="legend-item">
                        <div class="legend-color morning"></div>
                        <span>Morning Shift</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color evening"></div>
                        <span>Evening Shift</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color night"></div>
                        <span>Night Shift</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color off"></div>
                        <span>Off Day</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color leave"></div>
                        <span>Annual Leave</span>
                    </div>
                </div>
                
                <div class="form-container" id="scheduleFormContainer" style="display: none;">
                    <h4 class="mb-3">Create New Schedule</h4>
                    <div class="form-group">
                        <label class="form-label">Week Starting</label>
                        <input type="date" class="form-control" id="newScheduleWeek" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Select Crew Members</label>
                        <div class="crew-selector" id="crewSelector">
                            <!-- Crew checkboxes will be generated here -->
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Default Shift Type</label>
                        <select class="form-select" id="defaultShiftType">
                            <option value="morning">Morning Shift</option>
                            <option value="evening">Evening Shift</option>
                            <option value="night">Night Shift</option>
                        </select>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-success" onclick="addCrewToSchedule()">
                            <i class="fas fa-plus"></i> Add to Schedule
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="cancelNewSchedule()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
                
                <div id="scheduleLoadingContainer" style="display: none;">
                    <div class="loading-container">
                        <div class="spinner"></div>
                        <p class="mt-2">Loading schedule data...</p>
                    </div>
                </div>
                
                <div id="scheduleTableContainer">
                    <div class="schedule-container">
                        <div class="schedule-calendar" id="weeklySchedule">
                            <div class="calendar-header">Crew Name</div>
                            <div class="calendar-header">Sunday</div>
                            <div class="calendar-header">Monday</div>
                            <div class="calendar-header">Tuesday</div>
                            <div class="calendar-header">Wednesday</div>
                            <div class="calendar-header">Thursday</div>
                            <div class="calendar-header">Friday</div>
                            <div class="calendar-header">Saturday</div>
                            <div class="calendar-header">Total Hours</div>
                            
                            <div id="scheduleTableBody">
                                <!-- Schedule rows will be generated here -->
                            </div>
                        </div>
                        
                        <div class="monthly-view" id="monthlySchedule" style="display: none;">
                            <!-- Monthly calendar will be generated here -->
                        </div>
                    </div>
                </div>
                
                <div id="noScheduleContainer" style="display: none;">
                    <div class="no-schedule-message">
                        <i class="fas fa-calendar-times" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <h3>No Schedule Found</h3>
                        <p>No schedule exists for the selected week. Please create a new schedule.</p>
                    </div>
                </div>
            </div>
            
            <!-- Cashbill Page -->
            <div class="page" id="cashbill">
                <div class="form-container" id="cashbillFormContainer" style="display: none;">
                    <div class="form-header">
                        <h4 class="form-title">Create Cashbill</h4>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="toggleCashbillForm()">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                    
                    <form id="cashbillForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Invoice Number</label>
                                    <input type="text" class="form-control" id="invoiceNumber" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="cashbillDate" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Customer Name</label>
                                    <input type="text" class="form-control" id="customerName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Customer Phone</label>
                                    <input type="text" class="form-control" id="customerPhone" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Outlet</label>
                            <select class="form-select" id="cashbillOutlet" required>
                                <option value="">Select Outlet</option>
                                <option value="HQ">HQ</option>
                                <option value="BLM">Bandar Laguna Merbok</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="cashbillNotes" rows="3"></textarea>
                        </div>
                        
                        <h5 class="mt-4 mb-3">Items</h5>
                        
                        <div class="row">
                            <div class="col-md-5">
                                <div class="form-group">
                                    <label class="form-label">Item</label>
                                    <select class="form-select" id="cashbillItem" required>
                                        <option value="">Select Item</option>
                                        <option value="Laptop">Laptop</option>
                                        <option value="Mouse">Mouse</option>
                                        <option value="Keyboard">Keyboard</option>
                                        <option value="T-Shirt">T-Shirt</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="itemQuantity" min="1" value="1" required>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label">Price (RM)</label>
                                    <input type="number" class="form-control" id="itemPrice" step="0.01" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-1">
                                <div class="form-group">
                                    <label class="form-label">&nbsp;</label>
                                    <button type="button" class="btn btn-primary" onclick="addItemToCashbill()">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-container mt-3">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Quantity</th>
                                        <th>Price</th>
                                        <th>Total</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="cashbillItems">
                                    <tr>
                                        <td colspan="5" class="text-center">No items added</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Total Amount (RM)</label>
                                    <input type="number" class="form-control" id="totalAmount" step="0.01" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">&nbsp;</label>
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-success" onclick="saveCashbill('draft')">
                                            <i class="fas fa-save"></i> Save as Draft
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="saveCashbill('committed')">
                                            <i class="fas fa-check"></i> Commit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="cashbill-summary" id="cashbillSummaryContainer">
                    <h3>Cashbill Management</h3>
                    <div class="total-count" id="cashbillTotalCount">0</div>
                    <p class="text-muted">Total cashbills in the system</p>
                    
                    <div class="table-container mt-4">
                        <div class="table-header">
                            <div class="table-title">Cashbill History</div>
                            <div class="table-actions">
                                <button class="btn btn-sm btn-primary" onclick="toggleCashbillForm()">
                                    <i class="fas fa-plus"></i> New Cashbill
                                </button>
                            </div>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Invoice #</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="cashbillHistory">
                                <tr>
                                    <td colspan="6" class="text-center">No cashbills found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Logbook Page -->
            <div class="page" id="logbook">
                <div class="form-container" id="logbookFormContainer" style="display: none;">
                    <div class="form-header">
                        <h4 class="form-title">Create Log Entry</h4>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="toggleCashbillForm()">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                    
                    <form id="logbookForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="logDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Crew</label>
                                    <select class="form-select" id="logCrew" required>
                                        <option value="">Select Crew</option>
                                        <option value="Danial Danish">Danial Danish</option>
                                        <option value="Aida">Aida</option>
                                        <option value="Putri Erinna">Putri Erinna</option>
                                        <option value="Putri Farah">Putri Farah</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="logDescription" rows="3" required></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Price (RM)</label>
                                    <input type="number" class="form-control" id="logPrice" step="0.01" min="0">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">&nbsp;</label>
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-success" onclick="saveLogEntry('draft')">
                                            <i class="fas fa-save"></i> Save as Draft
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="saveLogEntry('committed')">
                                            <i class="fas fa-check"></i> Commit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="cashbill-summary" id="logbookSummaryContainer">
                    <h3>Logbook Management</h3>
                    <div class="total-count" id="logbookTotalCount">0</div>
                    <p class="text-muted">Total log entries in the system</p>
                    
                    <div class="table-container mt-4">
                        <div class="table-header">
                            <div class="table-title">Logbook Entries</div>
                            <div class="table-actions">
                                <button class="btn btn-sm btn-primary" onclick="toggleCashbillForm()">
                                    <i class="fas fa-plus"></i> New Entry
                                </button>
                            </div>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Crew</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="logbookEntries">
                                <tr>
                                    <td colspan="6" class="text-center">No log entries found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Quotation Page -->
            <div class="page" id="quotation">
                <div class="form-container" id="quotationFormContainer" style="display: none;">
                    <div class="form-header">
                        <h4 class="form-title">Create Quotation</h4>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="toggleCashbillForm()">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                    
                    <form id="quotationForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Quotation Number</label>
                                    <input type="text" class="form-control" id="quotationNumber" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="quotationDate" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Client Name</label>
                                    <input type="text" class="form-control" id="clientName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Client Email</label>
                                    <input type="email" class="form-control" id="clientEmail" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Client Phone</label>
                                    <input type="text" class="form-control" id="clientPhone" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Client Company</label>
                                    <input type="text" class="form-control" id="clientCompany">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="quotationNotes" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Template</label>
                            <select class="form-select" id="quotationTemplate">
                                <option value="">Select Template</option>
                                <option value="standard">Standard Template</option>
                                <option value="premium">Premium Template</option>
                                <option value="custom">Custom Template</option>
                            </select>
                        </div>
                        
                        <h5 class="mt-4 mb-3">Services</h5>
                        
                        <div id="quotationServices">
                            <div class="row mb-2">
                                <div class="col-md-6">
                                    <input type="text" class="form-control service-name" placeholder="Service Name" required>
                                </div>
                                <div class="col-md-4">
                                    <input type="number" class="form-control service-price" placeholder="Price (RM)" step="0.01" min="0" required>
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-danger btn-sm" onclick="removeQuotationService(this)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <button type="button" class="btn btn-sm btn-secondary" onclick="addQuotationService()">
                                <i class="fas fa-plus"></i> Add Service
                            </button>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Total Amount (RM)</label>
                                    <input type="number" class="form-control" id="quotationTotal" step="0.01" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">&nbsp;</label>
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-success" onclick="saveQuotation()">
                                            <i class="fas fa-save"></i> Save Quotation
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="downloadQuotation()">
                                            <i class="fas fa-download"></i> Download
                                        </button>
                                        <button type="button" class="btn btn-info" onclick="emailQuotation()">
                                            <i class="fas fa-envelope"></i> Email
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="cashbill-summary" id="quotationSummaryContainer">
                    <h3>Quotation Management</h3>
                    <div class="total-count" id="quotationTotalCount">0</div>
                    <p class="text-muted">Total quotations in the system</p>
                    
                    <div class="table-container mt-4">
                        <div class="table-header">
                            <div class="table-title">Quotation History</div>
                            <div class="table-actions">
                                <button class="btn btn-sm btn-primary" onclick="toggleCashbillForm()">
                                    <i class="fas fa-plus"></i> New Quotation
                                </button>
                            </div>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Quotation #</th>
                                    <th>Date</th>
                                    <th>Client</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="quotationHistory">
                                <tr>
                                    <td colspan="6" class="text-center">No quotations found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Online Order Page -->
            <div class="page" id="onlineOrder">
                <div class="form-container" id="adminOrderSection" style="display: none;">
                    <div class="form-header">
                        <h4 class="form-title">Create Online Order</h4>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="toggleCashbillForm()">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                    
                    <form id="orderForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Order ID</label>
                                    <input type="text" class="form-control" id="orderId" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="orderDate" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Customer Name</label>
                                    <input type="text" class="form-control" id="orderCustomerName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Customer Email</label>
                                    <input type="email" class="form-control" id="orderCustomerEmail" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Customer Phone</label>
                                    <input type="text" class="form-control" id="orderCustomerPhone" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Outlet</label>
                                    <select class="form-select" id="orderOutlet" required>
                                        <option value="">Select Outlet</option>
                                        <option value="HQ">HQ</option>
                                        <option value="BLM">Bandar Laguna Merbok</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="orderNotes" rows="3"></textarea>
                        </div>
                        
                        <h5 class="mt-4 mb-3">Order Items</h5>
                        
                        <div id="orderItems">
                            <div class="row mb-2">
                                <div class="col-md-6">
                                    <input type="text" class="form-control order-item-name" placeholder="Item Name" required>
                                </div>
                                <div class="col-md-4">
                                    <input type="number" class="form-control order-item-price" placeholder="Price (RM)" step="0.01" min="0" required>
                                </div>
                                <div class="col-md-2">
                                    <button type="button" class="btn btn-danger btn-sm" onclick="removeOrderItem(this)">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <button type="button" class="btn btn-sm btn-secondary" onclick="addOrderItem()">
                                <i class="fas fa-plus"></i> Add Item
                            </button>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Total Amount (RM)</label>
                                    <input type="number" class="form-control" id="orderTotal" step="0.01" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">&nbsp;</label>
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-success" onclick="saveOnlineOrder()">
                                            <i class="fas fa-save"></i> Save Order
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="cashbill-summary" id="onlineOrderSummaryContainer">
                    <h3>Online Order Management</h3>
                    <div class="total-count" id="onlineOrderTotalCount">0</div>
                    <p class="text-muted">Total online orders in the system</p>
                    
                    <div class="table-container mt-4">
                        <div class="table-header">
                            <div class="table-title">Online Orders</div>
                            <div class="table-actions">
                                <button class="btn btn-sm btn-primary" onclick="toggleCashbillForm()">
                                    <i class="fas fa-plus"></i> New Order
                                </button>
                            </div>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Order #</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Outlet</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="onlineOrders">
                                <tr>
                                    <td colspan="7" class="text-center">No orders found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Crew Management Page -->
            <div class="page" id="crewManagement">
                <div class="form-container">
                    <div class="form-header">
                        <h4 class="form-title">Crew Management</h4>
                    </div>
                    
                    <form id="crewForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control" id="crewName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Staff ID</label>
                                    <input type="text" class="form-control" id="crewId" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Position</label>
                                    <input type="text" class="form-control" id="crewPosition" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Role</label>
                                    <select class="form-select" id="crewRole" required>
                                        <option value="">Select Role</option>
                                        <option value="Admin">Admin</option>
                                        <option value="Supervisor">Supervisor</option>
                                        <option value="Crew">Crew</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Outlet</label>
                            <select class="form-select" id="crewOutlet" required>
                                <option value="">Select Outlet</option>
                                <option value="HQ">HQ</option>
                                <option value="BLM">Bandar Laguna Merbok</option>
                            </select>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-primary" onclick="saveCrew()">
                                <i class="fas fa-save"></i> Save Crew
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetCrewForm()">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-container mt-4">
                    <div class="table-header">
                        <div class="table-title">Crew List</div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Staff ID</th>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Role</th>
                                <th>Outlet</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="crewList">
                            <tr>
                                <td colspan="6" class="text-center">No crew members found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Stock Management Page -->
            <div class="page" id="stockManagement">
                <div class="form-container" id="stockFormContainer">
                    <div class="form-header">
                        <h4 class="form-title">Stock Management</h4>
                    </div>
                    
                    <form id="stockForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Item Name</label>
                                    <input type="text" class="form-control" id="stockItemName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">SKU</label>
                                    <input type="text" class="form-control" id="stockSku" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <select class="form-select" id="stockCategory" required>
                                        <option value="">Select Category</option>
                                        <option value="Electronics">Electronics</option>
                                        <option value="Clothing">Clothing</option>
                                        <option value="Food">Food</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Price (RM)</label>
                                    <input type="number" class="form-control" id="stockPrice" step="0.01" min="0" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="stockQuantity" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Outlet</label>
                                    <select class="form-select" id="stockOutlet" required>
                                        <option value="">Select Outlet</option>
                                        <option value="HQ">HQ</option>
                                        <option value="BLM">Bandar Laguna Merbok</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="stockDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-primary" onclick="saveStock()">
                                <i class="fas fa-save"></i> Save Stock
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetStockForm()">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-container mt-4">
                    <div class="table-header">
                        <div class="table-title">Stock List</div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>SKU</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Outlet</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="stockList">
                            <tr>
                                <td colspan="7" class="text-center">No stock items found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Time Tracking Page -->
            <div class="page" id="timeTracking">
                <div class="time-tracking-container">
                    <h3>Time Tracking</h3>
                    <div class="time-status" id="timeStatus">You are not punched in</div>
                    <div class="time-actions">
                        <button class="btn btn-success" id="punchInBtn" onclick="punchIn()">
                            <i class="fas fa-sign-in-alt"></i> Punch In
                        </button>
                        <button class="btn btn-warning" id="breakBtn" onclick="takeBreak()" disabled>
                            <i class="fas fa-coffee"></i> Take Break
                        </button>
                        <button class="btn btn-danger" id="punchOutBtn" onclick="punchOut()" disabled>
                            <i class="fas fa-sign-out-alt"></i> Punch Out
                        </button>
                    </div>
                    
                    <div class="time-record">
                        <h4>Today's Time Record</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Action</th>
                                    <th>Time</th>
                                    <th>Duration</th>
                                </tr>
                            </thead>
                            <tbody id="timeRecordTable">
                                <tr>
                                    <td colspan="3" class="text-center">No time records for today</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Reports Page -->
            <div class="page" id="reports">
                <h2 class="mb-4">Reports</h2>
                
                <div class="report-generator">
                    <div class="report-header">
                        <div class="report-title">Generate Report</div>
                    </div>
                    
                    <div class="report-options">
                        <div class="form-group">
                            <label class="form-label">Report Type</label>
                            <select class="form-select" id="reportType">
                                <option value="sales">Sales Report</option>
                                <option value="inventory">Inventory Report</option>
                                <option value="staff">Staff Performance</option>
                                <option value="schedule">Schedule Analysis</option>
                                <option value="financial">Financial Summary</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Date Range</label>
                            <input type="text" class="form-control" id="reportDateRange" placeholder="Select date range">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Outlet</label>
                            <select class="form-select" id="reportOutlet">
                                <option value="all">All Outlets</option>
                                <option value="HQ">HQ</option>
                                <option value="BLM">Bandar Laguna Merbok</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Format</label>
                            <select class="form-select" id="reportFormat">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                                <option value="csv">CSV</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary" onclick="generateReport()">
                            <i class="fas fa-file-alt"></i> Generate Report
                        </button>
                        <button class="btn btn-secondary" onclick="previewReport()">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                    </div>
                    
                    <div class="report-preview" id="reportPreview" style="display: none;">
                        <div class="report-preview-header">
                            <div class="report-preview-title">Report Preview</div>
                            <button class="btn btn-sm btn-primary" onclick="downloadReport()">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                        <div class="report-preview-content">
                            <!-- Report preview will be generated here -->
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Recent Reports</div>
                        <div class="table-actions">
                            <button class="btn btn-sm btn-primary" onclick="showAllReports()">
                                <i class="fas fa-list"></i> View All
                            </button>
                        </div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Report ID</th>
                                <th>Type</th>
                                <th>Date Range</th>
                                <th>Generated By</th>
                                <th>Date</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>REP-0001</td>
                                <td>Sales Report</td>
                                <td>Jun 1, 2023 - Jun 30, 2023</td>
                                <td>Danial Danish</td>
                                <td>Jul 1, 2023</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="viewReport('REP-0001')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="downloadReport('REP-0001')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>REP-0002</td>
                                <td>Inventory Report</td>
                                <td>Jun 1, 2023 - Jun 30, 2023</td>
                                <td>Aida</td>
                                <td>Jul 2, 2023</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="viewReport('REP-0002')">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-secondary" onclick="downloadReport('REP-0002')">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Audit Trail Page -->
            <div class="page" id="auditTrail">
                <h2 class="mb-4">Audit Trail</h2>
                
                <div class="audit-trail">
                    <div class="audit-header">
                        <div class="audit-title">System Activity Log</div>
                        <div class="table-actions">
                            <button class="btn btn-sm btn-secondary" onclick="exportAuditLog()">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="audit-filters">
                        <div class="form-group">
                            <label class="form-label">User</label>
                            <select class="form-select" id="auditUser">
                                <option value="all">All Users</option>
                                <option value="0001">Danial Danish</option>
                                <option value="0002">Aida</option>
                                <option value="0003">Putri Erinna</option>
                                <option value="0004">Putri Farah</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Action</label>
                            <select class="form-select" id="auditAction">
                                <option value="all">All Actions</option>
                                <option value="create">Create</option>
                                <option value="update">Update</option>
                                <option value="delete">Delete</option>
                                <option value="login">Login</option>
                                <option value="logout">Logout</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Date Range</label>
                            <input type="text" class="form-control" id="auditDateRange" placeholder="Select date range">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Module</label>
                            <select class="form-select" id="auditModule">
                                <option value="all">All Modules</option>
                                <option value="cashbill">Cashbill</option>
                                <option value="logbook">Logbook</option>
                                <option value="quotation">Quotation</option>
                                <option value="schedule">Schedule</option>
                                <option value="onlineOrder">Online Order</option>
                                <option value="crew">Crew</option>
                                <option value="stock">Stock</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="auditLogList">
                        <div class="audit-item">
                            <div class="audit-icon">
                                <i class="fas fa-sign-in-alt"></i>
                            </div>
                            <div class="audit-content">
                                <div class="audit-action">User Login</div>
                                <div class="audit-description">Danial Danish (0001) logged into the system</div>
                                <div class="audit-time">Today, 09:15 AM</div>
                            </div>
                        </div>
                        
                        <div class="audit-item">
                            <div class="audit-icon">
                                <i class="fas fa-receipt"></i>
                            </div>
                            <div class="audit-content">
                                <div class="audit-action">Cashbill Created</div>
                                <div class="audit-description">Created cashbill INV-0001 for customer John Doe</div>
                                <div class="audit-time">Today, 10:30 AM</div>
                            </div>
                        </div>
                        
                        <div class="audit-item">
                            <div class="audit-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="audit-content">
                                <div class="audit-action">Schedule Updated</div>
                                <div class="audit-description">Updated schedule for crew member Putri Erinna (0003)</div>
                                <div class="audit-time">Yesterday, 04:45 PM</div>
                            </div>
                        </div>
                        
                        <div class="audit-item">
                            <div class="audit-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="audit-content">
                                <div class="audit-action">Crew Added</div>
                                <div class="audit-description">Added new crew member Ahmad (0005) to the system</div>
                                <div class="audit-time">Jun 15, 2023, 11:20 AM</div>
                            </div>
                        </div>
                        
                        <div class="audit-item">
                            <div class="audit-icon">
                                <i class="fas fa-sign-out-alt"></i>
                            </div>
                            <div class="audit-content">
                                <div class="audit-action">User Logout</div>
                                <div class="audit-description">Aida (0002) logged out of the system</div>
                                <div class="audit-time">Jun 14, 2023, 06:30 PM</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Create Cashbill Button -->
        <button class="create-cashbill-btn" id="createCashbillBtn" onclick="toggleCashbillForm()" style="display: none;">
            <i class="fas fa-plus"></i> Create Cashbill
        </button>
        
        <!-- Keyboard Shortcuts Help -->
        <div class="shortcuts-modal" id="shortcutsModal">
            <div class="shortcuts-title">Keyboard Shortcuts</div>
            <div class="shortcut-item">
                <span>Go to Dashboard</span>
                <span class="shortcut-key">Alt + D</span>
            </div>
            <div class="shortcut-item">
                <span>New Cashbill</span>
                <span class="shortcut-key">Alt + C</span>
            </div>
            <div class="shortcut-item">
                <span>Search</span>
                <span class="shortcut-key">Ctrl + /</span>
            </div>
            <div class="shortcut-item">
                <span>Toggle Dark Mode</span>
                <span class="shortcut-key">Alt + T</span>
            </div>
            <div class="shortcut-item">
                <span>Help</span>
                <span class="shortcut-key">F1</span>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Modal for Schedule Edit -->
    <div class="modal" id="scheduleEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Schedule</h5>
                <button class="modal-close" onclick="closeModal('scheduleEditModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="scheduleEditForm">
                    <div class="form-group">
                        <label class="form-label">Crew Member</label>
                        <input type="text" class="form-control" id="editCrewName" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Day</label>
                        <input type="text" class="form-control" id="editDay" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="editStatus">
                            <option value="working">Working</option>
                            <option value="off-day">Off Day</option>
                            <option value="annual-leave">Annual Leave</option>
                        </select>
                    </div>
                    <div class="form-group" id="editShiftTypeGroup">
                        <label class="form-label">Shift Type</label>
                        <select class="form-select" id="editShiftType">
                            <option value="morning">Morning Shift</option>
                            <option value="evening">Evening Shift</option>
                            <option value="night">Night Shift</option>
                        </select>
                    </div>
                    <div class="form-group" id="editHoursGroup">
                        <label class="form-label">Custom Hours (Optional)</label>
                        <input type="text" class="form-control" id="editHours" placeholder="e.g., 9:00 AM - 5:00 PM">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('scheduleEditModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveScheduleEdit()">Save Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Modal for Confirmation -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationTitle">Confirmation</h5>
                <button class="modal-close" onclick="closeModal('confirmationModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('confirmationModal')">Cancel</button>
                <button class="btn btn-primary" id="confirmButton">Confirm</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script>
        // Global variables
        let currentUser = {
            id: '0001',
            name: 'Danial Danish',
            role: 'Admin',
            outlet: 'HQ'
        };
        let cashbills = [];
        let logEntries = [];
        let quotations = [];
        let onlineOrders = [];
        let crews = [
            { id: '0001', name: 'Danial Danish', position: 'Head IT', role: 'Admin', outlet: 'HQ' },
            { id: '0002', name: 'Aida', position: 'Director/Business Manager', role: 'Supervisor', outlet: 'HQ' },
            { id: '0003', name: 'Putri Erinna', position: 'Business Development Manager', role: 'Crew', outlet: 'HQ' },
            { id: '0004', name: 'Putri Farah', position: 'Business Marketing Manager', role: 'Crew', outlet: 'HQ' }
        ];
        let stockItems = [
            { sku: 'SKU001', name: 'Laptop', category: 'Electronics', price: 2500, quantity: 10, outlet: 'HQ' },
            { sku: 'SKU002', name: 'Mouse', category: 'Electronics', price: 50, quantity: 25, outlet: 'HQ' },
            { sku: 'SKU003', name: 'Keyboard', category: 'Electronics', price: 100, quantity: 15, outlet: 'HQ' },
            { sku: 'SKU004', name: 'T-Shirt', category: 'Clothing', price: 30, quantity: 50, outlet: 'HQ' }
        ];
        let currentCashbillItems = [];
        let currentQuotationServices = [];
        let currentOrderItems = [];
        let invoiceCounter = 1;
        let orderCounter = 1;
        let quotationCounter = 1;
        
        // Schedule data
        let scheduleData = [
            {
                crewId: '0001',
                crewName: 'Danial Danish',
                sunday: { status: 'off-day' },
                monday: { status: 'working', shiftType: 'morning' },
                tuesday: { status: 'working', shiftType: 'morning' },
                wednesday: { status: 'working', shiftType: 'morning' },
                thursday: { status: 'working', shiftType: 'morning' },
                friday: { status: 'working', shiftType: 'morning' },
                saturday: { status: 'off-day' }
            },
            {
                crewId: '0002',
                crewName: 'Aida',
                sunday: { status: 'off-day' },
                monday: { status: 'working', shiftType: 'morning' },
                tuesday: { status: 'working', shiftType: 'morning' },
                wednesday: { status: 'working', shiftType: 'morning' },
                thursday: { status: 'working', shiftType: 'morning' },
                friday: { status: 'working', shiftType: 'morning' },
                saturday: { status: 'off-day' }
            },
            {
                crewId: '0003',
                crewName: 'Putri Erinna',
                sunday: { status: 'off-day' },
                monday: { status: 'working', shiftType: 'evening' },
                tuesday: { status: 'working', shiftType: 'evening' },
                wednesday: { status: 'working', shiftType: 'evening' },
                thursday: { status: 'working', shiftType: 'evening' },
                friday: { status: 'working', shiftType: 'evening' },
                saturday: { status: 'off-day' }
            },
            {
                crewId: '0004',
                crewName: 'Putri Farah',
                sunday: { status: 'off-day' },
                monday: { status: 'working', shiftType: 'night' },
                tuesday: { status: 'working', shiftType: 'night' },
                wednesday: { status: 'working', shiftType: 'night' },
                thursday: { status: 'working', shiftType: 'night' },
                friday: { status: 'working', shiftType: 'night' },
                saturday: { status: 'off-day' }
            }
        ];
        
        // Time tracking data
        let timeRecords = [];
        let currentTimeStatus = 'out'; // 'in', 'break', 'out'
        let currentScheduleEdit = {
            crewId: '',
            crewName: '',
            day: '',
            status: '',
            shiftType: '',
            hours: ''
        };
        let isEditMode = false;
        let currentScheduleView = 'weekly';
        
        // Chart variables
        let revenueChart = null;
        let activityChart = null;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            checkLoginStatus();
            
            // Set current date to all date fields
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('cashbillDate').value = today;
            document.getElementById('logDate').value = today;
            document.getElementById('quotationDate').value = today;
            document.getElementById('orderDate').value = today;
            document.getElementById('scheduleDate').value = today;
            
            // Generate initial numbers
            document.getElementById('invoiceNumber').value = `INV-${String(invoiceCounter).padStart(4, '0')}`;
            document.getElementById('orderId').value = `ORD-${String(orderCounter).padStart(4, '0')}`;
            document.getElementById('quotationNumber').value = `QTN-${String(quotationCounter).padStart(4, '0')}`;
            
            // Populate stock items dropdown
            populateStockItemsDropdown();
            
            // Check user role and show/hide admin features
            checkUserRole();
            
            // Load data from localStorage if available
            loadDataFromStorage();
            
            // Update dashboard
            updateDashboard();
            
            // Initialize charts
            initializeCharts();
            
            // Set up sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
            
            // Set up event listeners for dynamic calculations
            document.getElementById('itemQuantity').addEventListener('input', calculateCashbillTotal);
            document.getElementById('itemPrice').addEventListener('input', calculateCashbillTotal);
            
            document.getElementById('cashbillItem').addEventListener('change', function() {
                const selectedItem = stockItems.find(item => item.name === this.value);
                if (selectedItem) {
                    document.getElementById('itemPrice').value = selectedItem.price;
                    calculateCashbillTotal();
                }
            });
            
            // Set up event listeners for quotation services
            document.querySelectorAll('.service-price').forEach(input => {
                input.addEventListener('input', calculateQuotationTotal);
            });
            
            // Set up event listeners for order items
            document.querySelectorAll('.order-item-price').forEach(input => {
                input.addEventListener('input', calculateOrderTotal);
            });
            
            // Set up login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });
            
            // Set up schedule edit form
            document.getElementById('editStatus').addEventListener('change', function() {
                const hoursGroup = document.getElementById('editHoursGroup');
                const shiftTypeGroup = document.getElementById('editShiftTypeGroup');
                
                if (this.value === 'working') {
                    hoursGroup.style.display = 'block';
                    shiftTypeGroup.style.display = 'block';
                } else {
                    hoursGroup.style.display = 'none';
                    shiftTypeGroup.style.display = 'none';
                }
            });
            
            // Initialize date pickers
            initializeDatePickers();
            
            // Load schedule
            loadSchedule();
            
            // Load time records for today
            loadTimeRecords();
            
            // Set up keyboard shortcuts
            setupKeyboardShortcuts();
            
            // Check for dark mode preference
            const darkMode = localStorage.getItem('darkMode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
                updateThemeIcon();
            }
        });
        
        // Initialize date pickers
        function initializeDatePickers() {
            // Schedule date picker
            flatpickr("#scheduleDatePicker", {
                dateFormat: "Y-m-d",
                defaultDate: "today",
                onChange: function(selectedDates) {
                    if (selectedDates.length > 0) {
                        document.getElementById('scheduleDate').value = selectedDates[0].toISOString().split('T')[0];
                        loadSchedule();
                    }
                }
            });
            
            // Report date range picker
            flatpickr("#reportDateRange", {
                mode: "range",
                dateFormat: "Y-m-d",
                defaultDate: [
                    new Date(new Date().setDate(new Date().getDate() - 30)),
                    new Date()
                ]
            });
            
            // Audit date range picker
            flatpickr("#auditDateRange", {
                mode: "range",
                dateFormat: "Y-m-d",
                defaultDate: [
                    new Date(new Date().setDate(new Date().getDate() - 7)),
                    new Date()
                ]
            });
            
            // Search date range picker
            flatpickr("#searchDateRange", {
                mode: "range",
                dateFormat: "Y-m-d"
            });
        }
        
        // Initialize charts
        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            revenueChart = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Revenue',
                        data: [1200, 1900, 3000, 5000, 2000, 3000, 4500],
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'RM ' + value;
                                }
                            }
                        }
                    }
                }
            });
            
            // Activity Chart
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            activityChart = new Chart(activityCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Cashbill', 'Logbook', 'Quotation', 'Online Order'],
                    datasets: [{
                        data: [30, 25, 20, 25],
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.8)',
                            'rgba(40, 204, 113, 0.8)',
                            'rgba(243, 156, 18, 0.8)',
                            'rgba(231, 76, 60, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // Setup keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Alt + D: Go to Dashboard
                if (e.altKey && e.key === 'd') {
                    e.preventDefault();
                    showPage('dashboard');
                }
                
                // Alt + C: New Cashbill
                if (e.altKey && e.key === 'c') {
                    e.preventDefault();
                    showPage('cashbill');
                    toggleCashbillForm();
                }
                
                // Ctrl + /: Search
                if (e.ctrlKey && e.key === '/') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                }
                
                // Alt + T: Toggle Dark Mode
                if (e.altKey && e.key === 't') {
                    e.preventDefault();
                    toggleDarkMode();
                }
                
                // F1: Help
                if (e.key === 'F1') {
                    e.preventDefault();
                    document.getElementById('shortcutsModal').classList.toggle('active');
                }
                
                // ESC: Close modals
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.active').forEach(modal => {
                        modal.classList.remove('active');
                    });
                    document.getElementById('shortcutsModal').classList.remove('active');
                    document.getElementById('notificationPanel').classList.remove('active');
                    document.getElementById('advancedSearch').classList.remove('active');
                }
            });
        }
        
        // Check login status
        function checkLoginStatus() {
            const loggedInUser = localStorage.getItem('loggedInUser');
            
            if (loggedInUser) {
                currentUser = JSON.parse(loggedInUser);
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                checkUserRole();
            } else {
                document.getElementById('loginContainer').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
            }
        }
        
        // Login function
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Check if username matches any crew ID
            const crew = crews.find(c => c.id === username);
            
            if (crew && password === '0000') {
                currentUser = {
                    id: crew.id,
                    name: crew.name,
                    role: crew.role,
                    outlet: crew.outlet
                };
                
                // Save to localStorage
                localStorage.setItem('loggedInUser', JSON.stringify(currentUser));
                
                // Log the login action
                logAuditTrail('login', 'User Login', `${currentUser.name} (${currentUser.id}) logged into the system`);
                
                // Show app and hide login
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                
                // Update UI
                checkUserRole();
                updateDashboard();
                
                showToast('Login successful', 'success');
            } else {
                showToast('Invalid Staff ID or password', 'error');
            }
        }
        
        // Logout function
        function logout() {
            showConfirmation('Are you sure you want to logout?', function() {
                // Log the logout action
                logAuditTrail('logout', 'User Logout', `${currentUser.name} (${currentUser.id}) logged out of the system`);
                
                localStorage.removeItem('loggedInUser');
                document.getElementById('loginContainer').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
                
                // Reset login form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                showToast('Logged out successfully', 'success');
            });
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            updateThemeIcon();
            
            // Update charts for dark mode
            if (revenueChart) {
                const textColor = isDarkMode ? '#e0e0e0' : '#333';
                revenueChart.options.scales.y.ticks.color = textColor;
                revenueChart.options.scales.x.ticks.color = textColor;
                revenueChart.update();
            }
            
            if (activityChart) {
                activityChart.options.plugins.legend.labels.color = isDarkMode ? '#e0e0e0' : '#333';
                activityChart.update();
            }
        }
        
        // Update theme icon
        function updateThemeIcon() {
            const themeIcon = document.querySelector('.theme-toggle i');
            if (document.body.classList.contains('dark-mode')) {
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
        }
        
        // Toggle notifications panel
        function toggleNotifications() {
            document.getElementById('notificationPanel').classList.toggle('active');
        }
        
        // Toggle advanced search
        function toggleAdvancedSearch() {
            document.getElementById('advancedSearch').classList.toggle('active');
        }
        
        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const toggleBtn = document.getElementById('sidebarToggle');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            
            if (sidebar.classList.contains('collapsed')) {
                toggleBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            } else {
                toggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            }
        }
        
        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update active menu item
            document.querySelectorAll('.sidebar-menu a').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('a').classList.add('active');
            
            // Show/hide create cashbill button based on page
            const createCashbillBtn = document.getElementById('createCashbillBtn');
            if (pageId === 'cashbill' || pageId === 'logbook' || pageId === 'quotation' || pageId === 'onlineOrder') {
                createCashbillBtn.style.display = 'flex';
            } else {
                createCashbillBtn.style.display = 'none';
            }
            
            // Update page-specific content
            if (pageId === 'dashboard') {
                updateDashboard();
            } else if (pageId === 'cashbill') {
                updateCashbillHistory();
            } else if (pageId === 'logbook') {
                updateLogbookEntries();
            } else if (pageId === 'quotation') {
                updateQuotationHistory();
            } else if (pageId === 'onlineOrder') {
                updateOnlineOrders();
            } else if (pageId === 'crewManagement') {
                updateCrewList();
            } else if (pageId === 'stockManagement') {
                updateStockList();
            } else if (pageId === 'timeTracking') {
                loadTimeRecords();
            } else if (pageId === 'schedule') {
                loadSchedule();
            } else if (pageId === 'reports') {
                // Initialize report page
            } else if (pageId === 'auditTrail') {
                // Initialize audit trail page
            }
        }
        
        // Check user role and show/hide admin features
        function checkUserRole() {
            const userRoleElement = document.getElementById('userRole');
            const crewManagementLink = document.getElementById('crewManagementLink');
            const adminOrderSection = document.getElementById('adminOrderSection');
            const stockFormContainer = document.getElementById('stockFormContainer');
            const editScheduleBtn = document.getElementById('editScheduleBtn');
            
            userRoleElement.textContent = currentUser.role;
            
            if (currentUser.role === 'Admin' || currentUser.role === 'Supervisor') {
                crewManagementLink.style.display = 'block';
                if (adminOrderSection) adminOrderSection.style.display = 'block';
                if (stockFormContainer) stockFormContainer.style.display = 'block';
                if (editScheduleBtn) editScheduleBtn.style.display = 'inline-block';
            } else {
                crewManagementLink.style.display = 'none';
                if (adminOrderSection) adminOrderSection.style.display = 'none';
                if (stockFormContainer) stockFormContainer.style.display = 'none';
                if (editScheduleBtn) editScheduleBtn.style.display = 'none';
            }
        }
        
        // Toggle cashbill form
        function toggleCashbillForm() {
            const currentPage = document.querySelector('.page.active').id;
            let formContainer, summaryContainer;
            
            switch(currentPage) {
                case 'cashbill':
                    formContainer = document.getElementById('cashbillFormContainer');
                    summaryContainer = document.getElementById('cashbillSummaryContainer');
                    break;
                case 'logbook':
                    formContainer = document.getElementById('logbookFormContainer');
                    summaryContainer = document.getElementById('logbookSummaryContainer');
                    break;
                case 'quotation':
                    formContainer = document.getElementById('quotationFormContainer');
                    summaryContainer = document.getElementById('quotationSummaryContainer');
                    break;
                case 'onlineOrder':
                    formContainer = document.getElementById('adminOrderSection');
                    summaryContainer = document.getElementById('onlineOrderSummaryContainer');
                    break;
            }
            
            if (formContainer && summaryContainer) {
                if (formContainer.style.display === 'none') {
                    formContainer.style.display = 'block';
                    summaryContainer.style.display = 'none';
                } else {
                    formContainer.style.display = 'none';
                    summaryContainer.style.display = 'block';
                }
            }
        }
        
        // Populate stock items dropdown
        function populateStockItemsDropdown() {
            const dropdown = document.getElementById('cashbillItem');
            if (dropdown) {
                dropdown.innerHTML = '<option value="">Select Item</option>';
                
                stockItems.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.name;
                    option.textContent = `${item.name} (RM ${item.price})`;
                    dropdown.appendChild(option);
                });
            }
        }
        
        // Calculate cashbill total
        function calculateCashbillTotal() {
            const quantity = parseFloat(document.getElementById('itemQuantity').value) || 0;
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;
            const total = quantity * price;
            
            document.getElementById('totalAmount').value = total.toFixed(2);
        }
        
        // Add item to cashbill
        function addItemToCashbill() {
            const itemName = document.getElementById('cashbillItem').value;
            const quantity = parseInt(document.getElementById('itemQuantity').value) || 0;
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;
            
            if (!itemName || quantity <= 0 || price <= 0) {
                showToast('Please fill in all item fields correctly', 'error');
                return;
            }
            
            const total = quantity * price;
            
            currentCashbillItems.push({
                name: itemName,
                quantity: quantity,
                price: price,
                total: total
            });
            
            updateCashbillItemsTable();
            resetCashbillItemForm();
        }
        
        // Update cashbill items table
        function updateCashbillItemsTable() {
            const tableBody = document.getElementById('cashbillItems');
            
            if (currentCashbillItems.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center">No items added</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            let grandTotal = 0;
            
            currentCashbillItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>RM ${item.price.toFixed(2)}</td>
                    <td>RM ${item.total.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="removeCashbillItem(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
                
                grandTotal += item.total;
            });
            
            // Add grand total row
            const totalRow = document.createElement('tr');
            totalRow.innerHTML = `
                <td colspan="3" class="text-end fw-bold">Grand Total</td>
                <td class="fw-bold">RM ${grandTotal.toFixed(2)}</td>
                <td></td>
            `;
            tableBody.appendChild(totalRow);
            
            // Update total amount field
            document.getElementById('totalAmount').value = grandTotal.toFixed(2);
        }
        
        // Remove item from cashbill
        function removeCashbillItem(index) {
            currentCashbillItems.splice(index, 1);
            updateCashbillItemsTable();
        }
        
        // Reset cashbill item form
        function resetCashbillItemForm() {
            document.getElementById('cashbillItem').value = '';
            document.getElementById('itemQuantity').value = '1';
            document.getElementById('itemPrice').value = '';
        }
        
        // Save cashbill
        function saveCashbill(status) {
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const date = document.getElementById('cashbillDate').value;
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const outlet = document.getElementById('cashbillOutlet').value;
            const notes = document.getElementById('cashbillNotes').value;
            const totalAmount = parseFloat(document.getElementById('totalAmount').value) || 0;
            
            if (!date || !customerName || !customerPhone || !outlet || currentCashbillItems.length === 0) {
                showToast('Please fill in all required fields and add at least one item', 'error');
                return;
            }
            
            const cashbill = {
                id: invoiceNumber,
                date: date,
                customerName: customerName,
                customerPhone: customerPhone,
                outlet: outlet,
                items: [...currentCashbillItems],
                totalAmount: totalAmount,
                notes: notes,
                status: status,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            cashbills.push(cashbill);
            saveDataToStorage();
            
            // Log the action
            logAuditTrail('create', 'Cashbill Created', `Created cashbill ${invoiceNumber} for customer ${customerName}`);
            
            showToast(`Cashbill ${invoiceNumber} saved as ${status}`, 'success');
            
            // Reset form
            resetCashbillForm();
            
            // Update counters and displays
            invoiceCounter++;
            document.getElementById('invoiceNumber').value = `INV-${String(invoiceCounter).padStart(4, '0')}`;
            updateCashbillHistory();
            updateDashboard();
            
            // Switch to summary view
            document.getElementById('cashbillFormContainer').style.display = 'none';
            document.getElementById('cashbillSummaryContainer').style.display = 'block';
        }
        
        // Reset cashbill form
        function resetCashbillForm() {
            document.getElementById('cashbillDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('cashbillOutlet').value = '';
            document.getElementById('cashbillNotes').value = '';
            document.getElementById('totalAmount').value = '';
            
            currentCashbillItems = [];
            updateCashbillItemsTable();
            resetCashbillItemForm();
        }
        
        // Update cashbill history
        function updateCashbillHistory() {
            const tableBody = document.getElementById('cashbillHistory');
            const totalCountElement = document.getElementById('cashbillTotalCount');
            
            if (totalCountElement) {
                totalCountElement.textContent = cashbills.length;
            }
            
            if (tableBody) {
                if (cashbills.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No cashbills found</td></tr>';
                    return;
                }
                
                tableBody.innerHTML = '';
                
                // Sort cashbills by date (newest first)
                const sortedCashbills = [...cashbills].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sortedCashbills.forEach(cashbill => {
                    const row = document.createElement('tr');
                    
                    let actionButtons = `
                        <button class="btn btn-sm btn-secondary" onclick="viewCashbill('${cashbill.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    `;
                    
                    if (currentUser.role === 'Admin') {
                        actionButtons += `
                            <button class="btn btn-sm btn-warning" onclick="uncommitCashbill('${cashbill.id}')">
                                <i class="fas fa-undo"></i>
                            </button>
                        `;
                    } else if (cashbill.status === 'committed') {
                        actionButtons += `
                            <button class="btn btn-sm btn-warning" onclick="requestAdjustment('${cashbill.id}')">
                                <i class="fas fa-exclamation-triangle"></i>
                            </button>
                        `;
                    }
                    
                    row.innerHTML = `
                        <td>${cashbill.id}</td>
                        <td>${cashbill.date}</td>
                        <td>${cashbill.customerName}</td>
                        <td>RM ${cashbill.totalAmount.toFixed(2)}</td>
                        <td><span class="badge badge-${cashbill.status}">${cashbill.status}</span></td>
                        <td>${actionButtons}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }
        
        // View cashbill details
        function viewCashbill(id) {
            const cashbill = cashbills.find(c => c.id === id);
            if (!cashbill) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing cashbill ${id}`, 'success');
        }
        
        // Uncommit cashbill (admin only)
        function uncommitCashbill(id) {
            const cashbill = cashbills.find(c => c.id === id);
            if (!cashbill) return;
            
            cashbill.status = 'draft';
            saveDataToStorage();
            updateCashbillHistory();
            
            // Log the action
            logAuditTrail('update', 'Cashbill Uncommitted', `Uncommitted cashbill ${id}`);
            
            showToast(`Cashbill ${id} has been uncommitted`, 'success');
        }
        
        // Request adjustment for cashbill
        function requestAdjustment(id) {
            const cashbill = cashbills.find(c => c.id === id);
            if (!cashbill) return;
            
            // In a real application, this would send a request to the admin
            showToast(`Adjustment request for cashbill ${id} has been submitted`, 'success');
        }
        
        // Print cashbill
        function printCashbill() {
            if (currentCashbillItems.length === 0) {
                showToast('Please add items to the cashbill before printing', 'error');
                return;
            }
            
            window.print();
        }
        
        // Download cashbill as PDF
        function downloadCashbill() {
            if (currentCashbillItems.length === 0) {
                showToast('Please add items to the cashbill before downloading', 'error');
                return;
            }
            
            // In a real application, this would generate and download a PDF
            showToast('Cashbill PDF download started', 'success');
        }
        
        // Save log entry
        function saveLogEntry(status) {
            const date = document.getElementById('logDate').value;
            const crew = document.getElementById('logCrew').value;
            const description = document.getElementById('logDescription').value;
            const price = parseFloat(document.getElementById('logPrice').value) || 0;
            
            if (!date || !crew || !description) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const logEntry = {
                id: `LOG-${Date.now()}`,
                date: date,
                crew: crew,
                description: description,
                price: price,
                status: status,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            logEntries.push(logEntry);
            saveDataToStorage();
            
            // Log the action
            logAuditTrail('create', 'Log Entry Created', `Created log entry for ${crew}`);
            
            showToast(`Log entry saved as ${status}`, 'success');
            
            // Reset form
            document.getElementById('logDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('logCrew').value = '';
            document.getElementById('logDescription').value = '';
            document.getElementById('logPrice').value = '';
            
            // Update displays
            updateLogbookEntries();
            updateDashboard();
            
            // Switch to summary view
            document.getElementById('logbookFormContainer').style.display = 'none';
            document.getElementById('logbookSummaryContainer').style.display = 'block';
        }
        
        // Update logbook entries
        function updateLogbookEntries() {
            const tableBody = document.getElementById('logbookEntries');
            const totalCountElement = document.getElementById('logbookTotalCount');
            
            if (totalCountElement) {
                totalCountElement.textContent = logEntries.length;
            }
            
            if (tableBody) {
                if (logEntries.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No log entries found</td></tr>';
                    return;
                }
                
                tableBody.innerHTML = '';
                
                // Sort log entries by date (newest first)
                const sortedLogEntries = [...logEntries].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sortedLogEntries.forEach(entry => {
                    const row = document.createElement('tr');
                    
                    let actionButtons = `
                        <button class="btn btn-sm btn-secondary" onclick="viewLogEntry('${entry.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    `;
                    
                    if (currentUser.role === 'Admin') {
                        actionButtons += `
                            <button class="btn btn-sm btn-warning" onclick="uncommitLogEntry('${entry.id}')">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteLogEntry('${entry.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        `;
                    } else if (entry.status === 'committed') {
                        actionButtons += `
                            <button class="btn btn-sm btn-warning" onclick="requestLogAdjustment('${entry.id}')">
                                <i class="fas fa-exclamation-triangle"></i>
                            </button>
                        `;
                    }
                    
                    row.innerHTML = `
                        <td>${entry.date}</td>
                        <td>${entry.description}</td>
                        <td>${entry.crew}</td>
                        <td>${entry.price > 0 ? `RM ${entry.price.toFixed(2)}` : '-'}</td>
                        <td><span class="badge badge-${entry.status}">${entry.status}</span></td>
                        <td>${actionButtons}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }
        
        // View log entry details
        function viewLogEntry(id) {
            const entry = logEntries.find(e => e.id === id);
            if (!entry) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing log entry ${id}`, 'success');
        }
        
        // Uncommit log entry (admin only)
        function uncommitLogEntry(id) {
            const entry = logEntries.find(e => e.id === id);
            if (!entry) return;
            
            entry.status = 'draft';
            saveDataToStorage();
            updateLogbookEntries();
            
            // Log the action
            logAuditTrail('update', 'Log Entry Uncommitted', `Uncommitted log entry ${id}`);
            
            showToast(`Log entry ${id} has been uncommitted`, 'success');
        }
        
        // Delete log entry (admin only)
        function deleteLogEntry(id) {
            showConfirmation('Are you sure you want to delete this log entry?', function() {
                logEntries = logEntries.filter(e => e.id !== id);
                saveDataToStorage();
                updateLogbookEntries();
                updateDashboard();
                
                // Log the action
                logAuditTrail('delete', 'Log Entry Deleted', `Deleted log entry ${id}`);
                
                showToast('Log entry deleted successfully', 'success');
            });
        }
        
        // Request adjustment for log entry
        function requestLogAdjustment(id) {
            const entry = logEntries.find(e => e.id === id);
            if (!entry) return;
            
            // In a real application, this would send a request to the admin
            showToast(`Adjustment request for log entry ${id} has been submitted`, 'success');
        }
        
        // Add quotation service
        function addQuotationService() {
            const servicesContainer = document.getElementById('quotationServices');
            const serviceRow = document.createElement('div');
            serviceRow.className = 'row mb-2';
            serviceRow.innerHTML = `
                <div class="col-md-6">
                    <input type="text" class="form-control service-name" placeholder="Service Name" required>
                </div>
                <div class="col-md-4">
                    <input type="number" class="form-control service-price" placeholder="Price (RM)" step="0.01" min="0" required>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeQuotationService(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            servicesContainer.appendChild(serviceRow);
            
            // Add event listener to the new price input
            serviceRow.querySelector('.service-price').addEventListener('input', calculateQuotationTotal);
        }
        
        // Remove quotation service
        function removeQuotationService(button) {
            button.closest('.row').remove();
            calculateQuotationTotal();
        }
        
        // Calculate quotation total
        function calculateQuotationTotal() {
            const priceInputs = document.querySelectorAll('.service-price');
            let total = 0;
            
            priceInputs.forEach(input => {
                const price = parseFloat(input.value) || 0;
                total += price;
            });
            
            document.getElementById('quotationTotal').value = total.toFixed(2);
        }
        
        // Save quotation
        function saveQuotation() {
            const quotationNumber = document.getElementById('quotationNumber').value;
            const date = document.getElementById('quotationDate').value;
            const clientName = document.getElementById('clientName').value;
            const clientEmail = document.getElementById('clientEmail').value;
            const clientPhone = document.getElementById('clientPhone').value;
            const clientCompany = document.getElementById('clientCompany').value;
            const notes = document.getElementById('quotationNotes').value;
            const template = document.getElementById('quotationTemplate').value;
            const totalAmount = parseFloat(document.getElementById('quotationTotal').value) || 0;
            
            if (!date || !clientName || !clientEmail || !clientPhone) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Collect services
            const services = [];
            const serviceNames = document.querySelectorAll('.service-name');
            const servicePrices = document.querySelectorAll('.service-price');
            
            for (let i = 0; i < serviceNames.length; i++) {
                const name = serviceNames[i].value.trim();
                const price = parseFloat(servicePrices[i].value) || 0;
                
                if (name && price > 0) {
                    services.push({
                        name: name,
                        price: price
                    });
                }
            }
            
            if (services.length === 0) {
                showToast('Please add at least one service', 'error');
                return;
            }
            
            const quotation = {
                id: quotationNumber,
                date: date,
                clientName: clientName,
                clientEmail: clientEmail,
                clientPhone: clientPhone,
                clientCompany: clientCompany,
                services: services,
                totalAmount: totalAmount,
                notes: notes,
                template: template,
                status: 'pending',
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            quotations.push(quotation);
            saveDataToStorage();
            
            // Log the action
            logAuditTrail('create', 'Quotation Created', `Created quotation ${quotationNumber} for client ${clientName}`);
            
            showToast(`Quotation ${quotationNumber} saved successfully`, 'success');
            
            // Reset form
            resetQuotationForm();
            
            // Update counters and displays
            quotationCounter++;
            document.getElementById('quotationNumber').value = `QTN-${String(quotationCounter).padStart(4, '0')}`;
            updateQuotationHistory();
            
            // Switch to summary view
            document.getElementById('quotationFormContainer').style.display = 'none';
            document.getElementById('quotationSummaryContainer').style.display = 'block';
        }
        
        // Reset quotation form
        function resetQuotationForm() {
            document.getElementById('quotationDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('clientName').value = '';
            document.getElementById('clientEmail').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('clientCompany').value = '';
            document.getElementById('quotationNotes').value = '';
            document.getElementById('quotationTemplate').value = '';
            document.getElementById('quotationTotal').value = '';
            
            // Reset services
            const servicesContainer = document.getElementById('quotationServices');
            servicesContainer.innerHTML = `
                <div class="row mb-2">
                    <div class="col-md-6">
                        <input type="text" class="form-control service-name" placeholder="Service Name" required>
                    </div>
                    <div class="col-md-4">
                        <input type="number" class="form-control service-price" placeholder="Price (RM)" step="0.01" min="0" required>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeQuotationService(this)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listener to the price input
            servicesContainer.querySelector('.service-price').addEventListener('input', calculateQuotationTotal);
        }
        
        // Update quotation history
        function updateQuotationHistory() {
            const tableBody = document.getElementById('quotationHistory');
            const totalCountElement = document.getElementById('quotationTotalCount');
            
            if (totalCountElement) {
                totalCountElement.textContent = quotations.length;
            }
            
            if (tableBody) {
                if (quotations.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No quotations found</td></tr>';
                    return;
                }
                
                tableBody.innerHTML = '';
                
                // Sort quotations by date (newest first)
                const sortedQuotations = [...quotations].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sortedQuotations.forEach(quotation => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${quotation.id}</td>
                        <td>${quotation.date}</td>
                        <td>${quotation.clientName}</td>
                        <td>RM ${quotation.totalAmount.toFixed(2)}</td>
                        <td><span class="badge badge-${quotation.status}">${quotation.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="viewQuotation('${quotation.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="downloadQuotationById('${quotation.id}')">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="emailQuotationById('${quotation.id}')">
                                <i class="fas fa-envelope"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }
        
        // View quotation details
        function viewQuotation(id) {
            const quotation = quotations.find(q => q.id === id);
            if (!quotation) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing quotation ${id}`, 'success');
        }
        
        // Download quotation
        function downloadQuotation() {
            // In a real application, this would generate and download a PDF
            showToast('Quotation PDF download started', 'success');
        }
        
        // Download quotation by ID
        function downloadQuotationById(id) {
            const quotation = quotations.find(q => q.id === id);
            if (!quotation) return;
            
            // In a real application, this would generate and download a PDF
            showToast(`Quotation ${id} PDF download started`, 'success');
        }
        
        // Email quotation
        function emailQuotation() {
            const clientEmail = document.getElementById('clientEmail').value;
            
            if (!clientEmail) {
                showToast('Please enter a client email address', 'error');
                return;
            }
            
            // In a real application, this would send an email
            showToast(`Quotation email sent to ${clientEmail}`, 'success');
        }
        
        // Email quotation by ID
        function emailQuotationById(id) {
            const quotation = quotations.find(q => q.id === id);
            if (!quotation) return;
            
            // In a real application, this would send an email
            showToast(`Quotation ${id} email sent to ${quotation.clientEmail}`, 'success');
        }
        
        // Load schedule
        function loadSchedule() {
            const scheduleDate = document.getElementById('scheduleDate').value;
            if (!scheduleDate) {
                const today = new Date();
                document.getElementById('scheduleDate').value = today.toISOString().split('T')[0];
                loadSchedule();
                return;
            }
            
            // Show loading animation
            document.getElementById('scheduleLoadingContainer').style.display = 'block';
            document.getElementById('scheduleTableContainer').style.display = 'none';
            document.getElementById('noScheduleContainer').style.display = 'none';
            
            // Simulate loading delay
            setTimeout(() => {
                // Calculate the week dates
                const selectedDate = new Date(scheduleDate);
                const dayOfWeek = selectedDate.getDay(); // 0 = Sunday, 1 = Monday, etc.
                
                // Calculate the start of the week (Sunday)
                const startDate = new Date(selectedDate);
                startDate.setDate(selectedDate.getDate() - dayOfWeek);
                
                // Calculate the end of the week (Saturday)
                const endDate = new Date(startDate);
                endDate.setDate(startDate.getDate() + 6);
                
                // Check if schedule exists for the selected week
                const scheduleExists = scheduleData.length > 0;
                
                if (scheduleExists) {
                    // Hide loading and no schedule messages
                    document.getElementById('scheduleLoadingContainer').style.display = 'none';
                    document.getElementById('noScheduleContainer').style.display = 'none';
                    document.getElementById('scheduleTableContainer').style.display = 'block';
                    
                    if (currentScheduleView === 'weekly') {
                        renderWeeklySchedule(startDate, endDate);
                    } else {
                        renderMonthlySchedule(selectedDate);
                    }
                } else {
                    // Hide loading and table, show no schedule message
                    document.getElementById('scheduleLoadingContainer').style.display = 'none';
                    document.getElementById('scheduleTableContainer').style.display = 'none';
                    document.getElementById('noScheduleContainer').style.display = 'block';
                }
            }, 500); // Simulate loading time
        }
        
        // Render weekly schedule
        function renderWeeklySchedule(startDate, endDate) {
            const weeklySchedule = document.getElementById('weeklySchedule');
            const scheduleTableBody = document.getElementById('scheduleTableBody');
            
            // Update date headers
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                const headerCell = weeklySchedule.children[i + 1];
                headerCell.innerHTML = `${dayNames[i]}<span class="day-date">${dateStr}</span>`;
            }
            
            // Clear existing schedule rows
            scheduleTableBody.innerHTML = '';
            
            // Calculate day totals
            const dayTotals = {
                sunday: 0,
                monday: 0,
                tuesday: 0,
                wednesday: 0,
                thursday: 0,
                friday: 0,
                saturday: 0
            };
            
            // Generate schedule rows for each crew member
            scheduleData.forEach(crew => {
                const row = document.createElement('div');
                row.className = 'schedule-row';
                
                // Crew name cell
                const crewNameCell = document.createElement('div');
                crewNameCell.className = 'calendar-header crew-name';
                
                const crewInfo = crews.find(c => c.id === crew.crewId);
                const crewRole = crewInfo ? crewInfo.role : '';
                
                crewNameCell.innerHTML = `
                    <div>${crew.crewName} (${crew.crewId})</div>
                    <div style="font-size: 12px; color: #777;">${crewRole}</div>
                `;
                row.appendChild(crewNameCell);
                
                let crewTotal = 0;
                
                // Generate day cells
                days.forEach(day => {
                    const dayCell = document.createElement('div');
                    dayCell.className = 'calendar-day';
                    dayCell.setAttribute('data-crew-id', crew.crewId);
                    dayCell.setAttribute('data-day', day);
                    
                    const dayData = crew[day];
                    let cellContent = '';
                    
                    if (dayData.status === 'off-day') {
                        dayCell.classList.add('off-day');
                        cellContent = '<div class="crew-schedule off-day">Off Day</div>';
                    } else if (dayData.status === 'annual-leave') {
                        dayCell.classList.add('annual-leave');
                        cellContent = '<div class="crew-schedule annual-leave">Annual Leave</div>';
                    } else if (dayData.status === 'working') {
                        const shiftType = dayData.shiftType;
                        const hours = getHoursFromShiftType(shiftType);
                        
                        dayCell.classList.add(`${shiftType}-shift`);
                        cellContent = `
                            <div class="crew-schedule ${shiftType}-shift">
                                <span class="crew-name">${crew.crewName}</span>
                                <span class="shift-type">${shiftType.charAt(0).toUpperCase() + shiftType.slice(1)}</span>
                            </div>
                            <div class="hours">${hours}</div>
                        `;
                        
                        // Calculate hours (simplified)
                        if (hours.includes('AM') && hours.includes('PM')) {
                            const parts = hours.split(' - ');
                            if (parts.length === 2) {
                                const startPart = parts[0].trim();
                                const endPart = parts[1].trim();
                                
                                let startHour = parseInt(startPart.split(':')[0]);
                                const startAmPm = startPart.includes('AM') ? 'AM' : 'PM';
                                
                                let endHour = parseInt(endPart.split(':')[0]);
                                const endAmPm = endPart.includes('AM') ? 'AM' : 'PM';
                                
                                // Convert to 24-hour format for calculation
                                if (startAmPm === 'PM' && startHour !== 12) {
                                    startHour += 12;
                                }
                                if (endAmPm === 'PM' && endHour !== 12) {
                                    endHour += 12;
                                }
                                
                                const hoursWorked = endHour - startHour;
                                crewTotal += hoursWorked;
                                dayTotals[day] += hoursWorked;
                            }
                        }
                    }
                    
                    // Add edit button for admin or supervisor
                    if ((currentUser.role === 'Admin' || currentUser.role === 'Supervisor') && isEditMode) {
                        cellContent += `
                            <button class="edit-schedule-btn" onclick="editScheduleInline('${crew.crewId}', '${crew.crewName}', '${day}')">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                        `;
                    }
                    
                    dayCell.innerHTML = cellContent;
                    row.appendChild(dayCell);
                });
                
                // Total hours cell
                const totalCell = document.createElement('div');
                totalCell.className = 'calendar-header total-hours';
                totalCell.textContent = `${crewTotal} hrs`;
                row.appendChild(totalCell);
                
                scheduleTableBody.appendChild(row);
            });
            
            // Update day totals in footer
            const footerRow = document.createElement('div');
            footerRow.className = 'schedule-row';
            
            // Empty cell for crew name column
            const emptyCell = document.createElement('div');
            emptyCell.className = 'calendar-header';
            footerRow.appendChild(emptyCell);
            
            // Day total cells
            days.forEach(day => {
                const totalCell = document.createElement('div');
                totalCell.className = 'calendar-header total-hours';
                totalCell.textContent = `${dayTotals[day]} hrs`;
                footerRow.appendChild(totalCell);
            });
            
            // Weekly total cell
            const weeklyTotalCell = document.createElement('div');
            weeklyTotalCell.className = 'calendar-header total-hours';
            const weeklyTotal = Object.values(dayTotals).reduce((sum, hours) => sum + hours, 0);
            weeklyTotalCell.textContent = `${weeklyTotal} hrs`;
            footerRow.appendChild(weeklyTotalCell);
            
            scheduleTableBody.appendChild(footerRow);
            
            // Show weekly view
            document.getElementById('weeklySchedule').style.display = 'grid';
            document.getElementById('monthlySchedule').style.display = 'none';
        }
        
        // Render monthly schedule
        function renderMonthlySchedule(selectedDate) {
            const monthlySchedule = document.getElementById('monthlySchedule');
            monthlySchedule.innerHTML = '';
            
            // Get year and month
            const year = selectedDate.getFullYear();
            const month = selectedDate.getMonth();
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            // Add day headers
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'month-header';
                dayHeader.textContent = day;
                monthlySchedule.appendChild(dayHeader);
            });
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'month-day other-month';
                monthlySchedule.appendChild(emptyDay);
            }
            
            // Add cells for each day of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'month-day';
                
                const currentDate = new Date(year, month, day);
                const dayOfWeek = currentDate.getDay();
                const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                const currentDay = days[dayOfWeek];
                
                // Check if this is today
                const today = new Date();
                if (currentDate.toDateString() === today.toDateString()) {
                    dayCell.classList.add('today');
                }
                
                // Add day number
                const dayNumber = document.createElement('div');
                dayNumber.className = 'month-day-number';
                dayNumber.textContent = day;
                dayCell.appendChild(dayNumber);
                
                // Count crew members working on this day
                let workingCount = 0;
                scheduleData.forEach(crew => {
                    const dayData = crew[currentDay];
                    if (dayData && dayData.status === 'working') {
                        workingCount++;
                    }
                });
                
                // Add crew count
                if (workingCount > 0) {
                    const crewCount = document.createElement('div');
                    crewCount.className = 'month-crew-count';
                    crewCount.textContent = `${workingCount} crew`;
                    dayCell.appendChild(crewCount);
                }
                
                // Add click event to show weekly view for this week
                dayCell.addEventListener('click', function() {
                    document.getElementById('scheduleDate').value = currentDate.toISOString().split('T')[0];
                    changeScheduleView('weekly', document.querySelector('.view-option.active'));
                    loadSchedule();
                });
                
                monthlySchedule.appendChild(dayCell);
            }
            
            // Show monthly view
            document.getElementById('weeklySchedule').style.display = 'none';
            document.getElementById('monthlySchedule').style.display = 'grid';
        }
        
        // Get hours from shift type
        function getHoursFromShiftType(shiftType) {
            switch(shiftType) {
                case 'morning': return '8:00 AM - 4:00 PM';
                case 'evening': return '4:00 PM - 12:00 AM';
                case 'night': return '12:00 AM - 8:00 AM';
                default: return '';
            }
        }
        
        // Change schedule view
        function changeScheduleView(view, element) {
            currentScheduleView = view;
            
            // Update active view option
            document.querySelectorAll('.view-option').forEach(option => {
                option.classList.remove('active');
            });
            element.classList.add('active');
            
            // Reload schedule with new view
            loadSchedule();
        }
        
        // Set today's date in schedule
        function setTodaySchedule() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('scheduleDate').value = today;
            loadSchedule();
        }
        
        // Toggle edit mode
        function toggleEditMode() {
            if (currentUser.role !== 'Admin' && currentUser.role !== 'Supervisor') {
                showToast('Only Admin or Supervisor can edit schedules', 'error');
                return;
            }
            
            isEditMode = !isEditMode;
            
            const editBtn = document.getElementById('editScheduleBtn');
            const saveBtn = document.getElementById('saveScheduleChangesBtn');
            
            if (isEditMode) {
                editBtn.style.display = 'none';
                saveBtn.style.display = 'inline-block';
                showToast('Edit mode enabled. Click on a cell to edit.', 'success');
            } else {
                editBtn.style.display = 'inline-block';
                saveBtn.style.display = 'none';
                showToast('Edit mode disabled.', 'warning');
            }
            
            // Reload schedule to apply edit mode
            loadSchedule();
        }
        
        // Edit schedule
        function editSchedule(crewId, crewName, day, status, shiftType, hours) {
            currentScheduleEdit = {
                crewId: crewId,
                crewName: crewName,
                day: day,
                status: status,
                shiftType: shiftType,
                hours: hours
            };
            
            document.getElementById('editCrewName').value = crewName;
            document.getElementById('editDay').value = day.charAt(0).toUpperCase() + day.slice(1);
            document.getElementById('editStatus').value = status;
            document.getElementById('editShiftType').value = shiftType || 'morning';
            document.getElementById('editHours').value = hours;
            
            // Show/hide hours field based on status
            const hoursGroup = document.getElementById('editHoursGroup');
            const shiftTypeGroup = document.getElementById('editShiftTypeGroup');
            
            if (status === 'working') {
                hoursGroup.style.display = 'block';
                shiftTypeGroup.style.display = 'block';
            } else {
                hoursGroup.style.display = 'none';
                shiftTypeGroup.style.display = 'none';
            }
            
            // Show modal
            document.getElementById('scheduleEditModal').classList.add('active');
        }
        
        // Edit schedule inline
        function editScheduleInline(crewId, crewName, day) {
            if (!isEditMode) return;
            
            const crewIndex = scheduleData.findIndex(c => c.crewId === crewId);
            if (crewIndex === -1) return;
            
            const dayData = scheduleData[crewIndex][day];
            
            currentScheduleEdit = {
                crewId: crewId,
                crewName: crewName,
                day: day,
                status: dayData.status,
                shiftType: dayData.shiftType || 'morning',
                hours: dayData.hours || ''
            };
            
            document.getElementById('editCrewName').value = crewName;
            document.getElementById('editDay').value = day.charAt(0).toUpperCase() + day.slice(1);
            document.getElementById('editStatus').value = dayData.status;
            document.getElementById('editShiftType').value = dayData.shiftType || 'morning';
            document.getElementById('editHours').value = dayData.hours || '';
            
            // Show/hide hours field based on status
            const hoursGroup = document.getElementById('editHoursGroup');
            const shiftTypeGroup = document.getElementById('editShiftTypeGroup');
            
            if (dayData.status === 'working') {
                hoursGroup.style.display = 'block';
                shiftTypeGroup.style.display = 'block';
            } else {
                hoursGroup.style.display = 'none';
                shiftTypeGroup.style.display = 'none';
            }
            
            // Show modal
            document.getElementById('scheduleEditModal').classList.add('active');
        }
        
        // Save schedule edit
        function saveScheduleEdit() {
            const crewId = currentScheduleEdit.crewId;
            const day = currentScheduleEdit.day;
            const status = document.getElementById('editStatus').value;
            const shiftType = document.getElementById('editShiftType').value;
            const hours = document.getElementById('editHours').value;
            
            // Find and update the schedule data
            const crewIndex = scheduleData.findIndex(c => c.crewId === crewId);
            if (crewIndex !== -1) {
                scheduleData[crewIndex][day] = {
                    status: status,
                    shiftType: status === 'working' ? shiftType : undefined,
                    hours: status === 'working' ? (hours || getHoursFromShiftType(shiftType)) : ''
                };
                
                saveDataToStorage();
                loadSchedule();
                closeModal('scheduleEditModal');
                
                // Log the action
                logAuditTrail('update', 'Schedule Updated', `Updated schedule for ${currentScheduleEdit.crewName} on ${day}`);
                
                showToast('Schedule updated successfully', 'success');
            }
        }
        
        // Create new schedule
        function createNewSchedule() {
            if (currentUser.role !== 'Admin') {
                showToast('Only admin can create new schedules', 'error');
                return;
            }
            
            // Show the schedule form
            document.getElementById('scheduleFormContainer').style.display = 'block';
            
            // Set the default week to next week
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('newScheduleWeek').value = nextWeek.toISOString().split('T')[0];
            
            // Generate crew checkboxes
            const crewSelector = document.getElementById('crewSelector');
            crewSelector.innerHTML = '';
            
            crews.forEach(crew => {
                const checkbox = document.createElement('div');
                checkbox.className = 'crew-checkbox';
                checkbox.innerHTML = `
                    <input type="checkbox" id="crew-${crew.id}" value="${crew.id}">
                    <label for="crew-${crew.id}">${crew.name} (${crew.id})</label>
                `;
                crewSelector.appendChild(checkbox);
            });
        }
        
        // Add crew to schedule
        function addCrewToSchedule() {
            const weekStart = document.getElementById('newScheduleWeek').value;
            if (!weekStart) {
                showToast('Please select a week', 'error');
                return;
            }
            
            // Get selected crew
            const selectedCrew = [];
            document.querySelectorAll('#crewSelector input:checked').forEach(checkbox => {
                const crewId = checkbox.value;
                const crew = crews.find(c => c.id === crewId);
                if (crew) {
                    selectedCrew.push(crew);
                }
            });
            
            if (selectedCrew.length === 0) {
                showToast('Please select at least one crew member', 'error');
                return;
            }
            
            // Get default shift type
            const defaultShiftType = document.getElementById('defaultShiftType').value;
            
            // Add crew to schedule data
            selectedCrew.forEach(crew => {
                // Check if crew already exists in schedule data
                const existingCrew = scheduleData.find(s => s.crewId === crew.id);
                if (!existingCrew) {
                    scheduleData.push({
                        crewId: crew.id,
                        crewName: crew.name,
                        sunday: { status: 'off-day' },
                        monday: { status: 'working', shiftType: defaultShiftType },
                        tuesday: { status: 'working', shiftType: defaultShiftType },
                        wednesday: { status: 'working', shiftType: defaultShiftType },
                        thursday: { status: 'working', shiftType: defaultShiftType },
                        friday: { status: 'working', shiftType: defaultShiftType },
                        saturday: { status: 'off-day' }
                    });
                }
            });
            
            // Hide the form and reload schedule
            document.getElementById('scheduleFormContainer').style.display = 'none';
            loadSchedule();
            
            // Log the action
            logAuditTrail('create', 'Schedule Created', `Created new schedule for week starting ${weekStart}`);
            
            showToast('Crew added to schedule successfully', 'success');
        }
        
        // Cancel new schedule
        function cancelNewSchedule() {
            document.getElementById('scheduleFormContainer').style.display = 'none';
        }
        
        // Save schedule
        function saveSchedule() {
            if (currentUser.role !== 'Admin') {
                showToast('Only admin can save schedules', 'error');
                return;
            }
            
            saveDataToStorage();
            
            // Log the action
            logAuditTrail('update', 'Schedule Saved', 'Saved current schedule');
            
            showToast('Schedule saved successfully', 'success');
        }
        
        // Save schedule changes
        function saveScheduleChanges() {
            if (currentUser.role !== 'Admin' && currentUser.role !== 'Supervisor') {
                showToast('Only Admin or Supervisor can save schedule changes', 'error');
                return;
            }
            
            saveDataToStorage();
            toggleEditMode();
            
            // Log the action
            logAuditTrail('update', 'Schedule Changes Saved', 'Saved schedule changes');
            
            showToast('Schedule changes saved successfully', 'success');
        }
        
        // Add order item
        function addOrderItem() {
            const itemsContainer = document.getElementById('orderItems');
            const itemRow = document.createElement('div');
            itemRow.className = 'row mb-2';
            itemRow.innerHTML = `
                <div class="col-md-6">
                    <input type="text" class="form-control order-item-name" placeholder="Item Name" required>
                </div>
                <div class="col-md-4">
                    <input type="number" class="form-control order-item-price" placeholder="Price (RM)" step="0.01" min="0" required>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeOrderItem(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            itemsContainer.appendChild(itemRow);
            
            // Add event listener to the new price input
            itemRow.querySelector('.order-item-price').addEventListener('input', calculateOrderTotal);
        }
        
        // Remove order item
        function removeOrderItem(button) {
            button.closest('.row').remove();
            calculateOrderTotal();
        }
        
        // Calculate order total
        function calculateOrderTotal() {
            const priceInputs = document.querySelectorAll('.order-item-price');
            let total = 0;
            
            priceInputs.forEach(input => {
                const price = parseFloat(input.value) || 0;
                total += price;
            });
            
            document.getElementById('orderTotal').value = total.toFixed(2);
        }
        
        // Save online order
        function saveOnlineOrder() {
            const orderId = document.getElementById('orderId').value;
            const date = document.getElementById('orderDate').value;
            const customerName = document.getElementById('orderCustomerName').value;
            const customerEmail = document.getElementById('orderCustomerEmail').value;
            const customerPhone = document.getElementById('orderCustomerPhone').value;
            const outlet = document.getElementById('orderOutlet').value;
            const notes = document.getElementById('orderNotes').value;
            const totalAmount = parseFloat(document.getElementById('orderTotal').value) || 0;
            
            if (!date || !customerName || !customerEmail || !customerPhone || !outlet) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Collect order items
            const items = [];
            const itemNames = document.querySelectorAll('.order-item-name');
            const itemPrices = document.querySelectorAll('.order-item-price');
            
            for (let i = 0; i < itemNames.length; i++) {
                const name = itemNames[i].value.trim();
                const price = parseFloat(itemPrices[i].value) || 0;
                
                if (name && price > 0) {
                    items.push({
                        name: name,
                        price: price
                    });
                }
            }
            
            if (items.length === 0) {
                showToast('Please add at least one item', 'error');
                return;
            }
            
            const order = {
                id: orderId,
                date: date,
                customerName: customerName,
                customerEmail: customerEmail,
                customerPhone: customerPhone,
                outlet: outlet,
                items: items,
                totalAmount: totalAmount,
                notes: notes,
                status: 'pending',
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            onlineOrders.push(order);
            saveDataToStorage();
            
            // Log the action
            logAuditTrail('create', 'Online Order Created', `Created order ${orderId} for customer ${customerName}`);
            
            showToast(`Order ${orderId} saved successfully`, 'success');
            
            // Reset form
            resetOrderForm();
            
            // Update counters and displays
            orderCounter++;
            document.getElementById('orderId').value = `ORD-${String(orderCounter).padStart(4, '0')}`;
            updateOnlineOrders();
            updateDashboard();
            
            // Switch to summary view
            document.getElementById('adminOrderSection').style.display = 'none';
            document.getElementById('onlineOrderSummaryContainer').style.display = 'block';
        }
        
        // Reset order form
        function resetOrderForm() {
            document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('orderCustomerName').value = '';
            document.getElementById('orderCustomerEmail').value = '';
            document.getElementById('orderCustomerPhone').value = '';
            document.getElementById('orderOutlet').value = '';
            document.getElementById('orderNotes').value = '';
            document.getElementById('orderTotal').value = '';
            
            // Reset order items
            const itemsContainer = document.getElementById('orderItems');
            itemsContainer.innerHTML = `
                <div class="row mb-2">
                    <div class="col-md-6">
                        <input type="text" class="form-control order-item-name" placeholder="Item Name" required>
                    </div>
                    <div class="col-md-4">
                        <input type="number" class="form-control order-item-price" placeholder="Price (RM)" step="0.01" min="0" required>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeOrderItem(this)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listener to the price input
            itemsContainer.querySelector('.order-item-price').addEventListener('input', calculateOrderTotal);
        }
        
        // Update online orders
        function updateOnlineOrders() {
            const tableBody = document.getElementById('onlineOrders');
            const totalCountElement = document.getElementById('onlineOrderTotalCount');
            
            if (totalCountElement) {
                totalCountElement.textContent = onlineOrders.length;
            }
            
            if (tableBody) {
                if (onlineOrders.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center">No orders found</td></tr>';
                    return;
                }
                
                tableBody.innerHTML = '';
                
                // Sort orders by date (newest first)
                const sortedOrders = [...onlineOrders].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sortedOrders.forEach(order => {
                    const row = document.createElement('tr');
                    
                    let actionButtons = `
                        <button class="btn btn-sm btn-secondary" onclick="viewOrder('${order.id}')">
                            <i class="fas fa-eye"></i>
                        </button>
                    `;
                    
                    if (currentUser.role === 'Admin') {
                        actionButtons += `
                            <button class="btn btn-sm btn-danger" onclick="deleteOrder('${order.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        `;
                    } else if (order.status === 'pending') {
                        actionButtons += `
                            <button class="btn btn-sm btn-success" onclick="fulfillOrder('${order.id}')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="createCashbillFromOrder('${order.id}')">
                                <i class="fas fa-receipt"></i>
                            </button>
                        `;
                    }
                    
                    row.innerHTML = `
                        <td>${order.id}</td>
                        <td>${order.date}</td>
                        <td>${order.customerName}</td>
                        <td>RM ${order.totalAmount.toFixed(2)}</td>
                        <td>${order.outlet}</td>
                        <td><span class="badge badge-${order.status}">${order.status}</span></td>
                        <td>${actionButtons}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }
        
        // View order details
        function viewOrder(id) {
            const order = onlineOrders.find(o => o.id === id);
            if (!order) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing order ${id}`, 'success');
        }
        
        // Delete order (admin only)
        function deleteOrder(id) {
            showConfirmation('Are you sure you want to delete this order?', function() {
                onlineOrders = onlineOrders.filter(o => o.id !== id);
                saveDataToStorage();
                updateOnlineOrders();
                updateDashboard();
                
                // Log the action
                logAuditTrail('delete', 'Online Order Deleted', `Deleted order ${id}`);
                
                showToast('Order deleted successfully', 'success');
            });
        }
        
        // Fulfill order
        function fulfillOrder(id) {
            const order = onlineOrders.find(o => o.id === id);
            if (!order) return;
            
            order.status = 'fulfilled';
            saveDataToStorage();
            updateOnlineOrders();
            updateDashboard();
            
            // Log the action
            logAuditTrail('update', 'Order Fulfilled', `Fulfilled order ${id}`);
            
            showToast(`Order ${id} has been fulfilled`, 'success');
        }
        
        // Create cashbill from order
        function createCashbillFromOrder(id) {
            const order = onlineOrders.find(o => o.id === id);
            if (!order) return;
            
            // Switch to cashbill page
            showPage('cashbill');
            
            // Show cashbill form
            document.getElementById('cashbillFormContainer').style.display = 'block';
            document.getElementById('cashbillSummaryContainer').style.display = 'none';
            
            // Pre-fill cashbill form with order details
            document.getElementById('customerName').value = order.customerName;
            document.getElementById('customerPhone').value = order.customerPhone;
            document.getElementById('cashbillOutlet').value = order.outlet;
            
            // Add order items to cashbill
            currentCashbillItems = order.items.map(item => ({
                name: item.name,
                quantity: 1,
                price: item.price,
                total: item.price
            }));
            
            updateCashbillItemsTable();
            
            showToast(`Cashbill form pre-filled with order ${id} details`, 'success');
        }
        
        // Save crew
        function saveCrew() {
            const name = document.getElementById('crewName').value;
            const id = document.getElementById('crewId').value;
            const position = document.getElementById('crewPosition').value;
            const role = document.getElementById('crewRole').value;
            const outlet = document.getElementById('crewOutlet').value;
            
            if (!name || !id || !position || !role || !outlet) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            // Check if crew ID already exists
            const existingCrewIndex = crews.findIndex(c => c.id === id);
            
            if (existingCrewIndex !== -1) {
                // Update existing crew
                crews[existingCrewIndex] = {
                    id: id,
                    name: name,
                    position: position,
                    role: role,
                    outlet: outlet
                };
                
                showToast(`Crew ${name} updated successfully`, 'success');
            } else {
                // Add new crew
                crews.push({
                    id: id,
                    name: name,
                    position: position,
                    role: role,
                    outlet: outlet
                });
                
                // Add to schedule data
                scheduleData.push({
                    crewId: id,
                    crewName: name,
                    sunday: { status: 'off-day' },
                    monday: { status: 'working', shiftType: 'morning' },
                    tuesday: { status: 'working', shiftType: 'morning' },
                    wednesday: { status: 'working', shiftType: 'morning' },
                    thursday: { status: 'working', shiftType: 'morning' },
                    friday: { status: 'working', shiftType: 'morning' },
                    saturday: { status: 'off-day' }
                });
                
                showToast(`Crew ${name} added successfully`, 'success');
            }
            
            saveDataToStorage();
            resetCrewForm();
            updateCrewList();
            loadSchedule();
            
            // Log the action
            logAuditTrail(existingCrewIndex !== -1 ? 'update' : 'create', 
                         existingCrewIndex !== -1 ? 'Crew Updated' : 'Crew Added', 
                         `${existingCrewIndex !== -1 ? 'Updated' : 'Added'} crew ${name} (${id})`);
        }
        
        // Reset crew form
        function resetCrewForm() {
            document.getElementById('crewName').value = '';
            document.getElementById('crewId').value = '';
            document.getElementById('crewPosition').value = '';
            document.getElementById('crewRole').value = '';
            document.getElementById('crewOutlet').value = '';
        }
        
        // Update crew list
        function updateCrewList() {
            const tableBody = document.getElementById('crewList');
            
            if (tableBody) {
                if (crews.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No crew members found</td></tr>';
                    return;
                }
                
                tableBody.innerHTML = '';
                
                // Sort crews by ID
                const sortedCrews = [...crews].sort((a, b) => a.id.localeCompare(b.id));
                
                sortedCrews.forEach(crew => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${crew.id}</td>
                        <td>${crew.name}</td>
                        <td>${crew.position}</td>
                        <td>${crew.role}</td>
                        <td>${crew.outlet}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editCrew('${crew.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCrew('${crew.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }
        
        // Edit crew
        function editCrew(id) {
            const crew = crews.find(c => c.id === id);
            if (!crew) return;
            
            document.getElementById('crewName').value = crew.name;
            document.getElementById('crewId').value = crew.id;
            document.getElementById('crewPosition').value = crew.position;
            document.getElementById('crewRole').value = crew.role;
            document.getElementById('crewOutlet').value = crew.outlet;
        }
        
        // Delete crew
        function deleteCrew(id) {
            showConfirmation('Are you sure you want to delete this crew member?', function() {
                crews = crews.filter(c => c.id !== id);
                scheduleData = scheduleData.filter(s => s.crewId !== id);
                saveDataToStorage();
                updateCrewList();
                loadSchedule();
                
                // Log the action
                logAuditTrail('delete', 'Crew Deleted', `Deleted crew member with ID ${id}`);
                
                showToast('Crew member deleted successfully', 'success');
            });
        }
        
        // Save stock
        function saveStock() {
            const itemName = document.getElementById('stockItemName').value;
            const sku = document.getElementById('stockSku').value;
            const category = document.getElementById('stockCategory').value;
            const price = parseFloat(document.getElementById('stockPrice').value) || 0;
            const quantity = parseInt(document.getElementById('stockQuantity').value) || 0;
            const outlet = document.getElementById('stockOutlet').value;
            const description = document.getElementById('stockDescription').value;
            
            if (!itemName || !sku || !category || price <= 0 || quantity < 0 || !outlet) {
                showToast('Please fill in all required fields with valid values', 'error');
                return;
            }
            
            // Check if SKU already exists
            const existingStockIndex = stockItems.findIndex(s => s.sku === sku);
            
            if (existingStockIndex !== -1) {
                // Update existing stock item
                stockItems[existingStockIndex] = {
                    sku: sku,
                    name: itemName,
                    category: category,
                    price: price,
                    quantity: quantity,
                    outlet: outlet,
                    description: description
                };
                
                showToast(`Stock item ${itemName} updated successfully`, 'success');
            } else {
                // Add new stock item
                stockItems.push({
                    sku: sku,
                    name: itemName,
                    category: category,
                    price: price,
                    quantity: quantity,
                    outlet: outlet,
                    description: description
                });
                
                showToast(`Stock item ${itemName} added successfully`, 'success');
            }
            
            saveDataToStorage();
            resetStockForm();
            updateStockList();
            populateStockItemsDropdown();
            
            // Log the action
            logAuditTrail(existingStockIndex !== -1 ? 'update' : 'create', 
                         existingStockIndex !== -1 ? 'Stock Updated' : 'Stock Added', 
                         `${existingStockIndex !== -1 ? 'Updated' : 'Added'} stock item ${itemName} (${sku})`);
        }
        
        // Reset stock form
        function resetStockForm() {
            document.getElementById('stockItemName').value = '';
            document.getElementById('stockSku').value = '';
            document.getElementById('stockCategory').value = '';
            document.getElementById('stockPrice').value = '';
            document.getElementById('stockQuantity').value = '';
            document.getElementById('stockOutlet').value = '';
            document.getElementById('stockDescription').value = '';
        }
        
        // Update stock list
        function updateStockList() {
            const tableBody = document.getElementById('stockList');
            
            if (tableBody) {
                if (stockItems.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="7" class="text-center">No stock items found</td></tr>';
                    return;
                }
                
                tableBody.innerHTML = '';
                
                // Sort stock items by SKU
                const sortedStockItems = [...stockItems].sort((a, b) => a.sku.localeCompare(b.sku));
                
                sortedStockItems.forEach(item => {
                    const row = document.createElement('tr');
                    
                    let actionButtons = '';
                    if (currentUser.role === 'Admin') {
                        actionButtons = `
                            <button class="btn btn-sm btn-primary" onclick="editStock('${item.sku}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteStock('${item.sku}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        `;
                    }
                    
                    row.innerHTML = `
                        <td>${item.sku}</td>
                        <td>${item.name}</td>
                        <td>${item.category}</td>
                        <td>RM ${item.price.toFixed(2)}</td>
                        <td>${item.quantity}</td>
                        <td>${item.outlet}</td>
                        <td>${actionButtons}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }
        
        // Edit stock
        function editStock(sku) {
            const stock = stockItems.find(s => s.sku === sku);
            if (!stock) return;
            
            document.getElementById('stockItemName').value = stock.name;
            document.getElementById('stockSku').value = stock.sku;
            document.getElementById('stockCategory').value = stock.category;
            document.getElementById('stockPrice').value = stock.price;
            document.getElementById('stockQuantity').value = stock.quantity;
            document.getElementById('stockOutlet').value = stock.outlet;
            document.getElementById('stockDescription').value = stock.description;
        }
        
        // Delete stock
        function deleteStock(sku) {
            showConfirmation('Are you sure you want to delete this stock item?', function() {
                stockItems = stockItems.filter(s => s.sku !== sku);
                saveDataToStorage();
                updateStockList();
                populateStockItemsDropdown();
                
                // Log the action
                logAuditTrail('delete', 'Stock Deleted', `Deleted stock item with SKU ${sku}`);
                
                showToast('Stock item deleted successfully', 'success');
            });
        }
        
        // Time tracking functions
        function punchIn() {
            // Check if user is scheduled today
            const today = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            const todayDay = days[today];
            
            const crewSchedule = scheduleData.find(s => s.crewId === currentUser.id);
            if (!crewSchedule || crewSchedule[todayDay].status !== 'working') {
                showToast('You are not scheduled to work today', 'error');
                return;
            }
            
            // Record punch in time
            const now = new Date();
            const timeRecord = {
                id: Date.now(),
                crewId: currentUser.id,
                action: 'punch-in',
                time: now.toISOString(),
                date: now.toISOString().split('T')[0],
                location: getCurrentLocation()
            };
            
            timeRecords.push(timeRecord);
            saveDataToStorage();
            
            // Update UI
            currentTimeStatus = 'in';
            updateTimeStatus();
            loadTimeRecords();
            
            // Log the action
            logAuditTrail('create', 'Time Punch In', `${currentUser.name} punched in at ${now.toLocaleTimeString()}`);
            
            showToast('Punched in successfully', 'success');
        }
        
        function takeBreak() {
            if (currentTimeStatus !== 'in') {
                showToast('You need to be punched in to take a break', 'error');
                return;
            }
            
            // Record break time
            const now = new Date();
            const timeRecord = {
                id: Date.now(),
                crewId: currentUser.id,
                action: 'break',
                time: now.toISOString(),
                date: now.toISOString().split('T')[0],
                location: getCurrentLocation()
            };
            
            timeRecords.push(timeRecord);
            saveDataToStorage();
            
            // Update UI
            currentTimeStatus = 'break';
            updateTimeStatus();
            loadTimeRecords();
            
            // Log the action
            logAuditTrail('create', 'Break Started', `${currentUser.name} started break at ${now.toLocaleTimeString()}`);
            
            showToast('Break started', 'success');
        }
        
        function punchOut() {
            if (currentTimeStatus === 'out') {
                showToast('You are not punched in', 'error');
                return;
            }
            
            // Record punch out time
            const now = new Date();
            const timeRecord = {
                id: Date.now(),
                crewId: currentUser.id,
                action: 'punch-out',
                time: now.toISOString(),
                date: now.toISOString().split('T')[0],
                location: getCurrentLocation()
            };
            
            timeRecords.push(timeRecord);
            saveDataToStorage();
            
            // Update UI
            currentTimeStatus = 'out';
            updateTimeStatus();
            loadTimeRecords();
            
            // Log the action
            logAuditTrail('create', 'Time Punch Out', `${currentUser.name} punched out at ${now.toLocaleTimeString()}`);
            
            showToast('Punched out successfully', 'success');
        }
        
        // Get current location (simulated)
        function getCurrentLocation() {
            // In a real application, this would use the Geolocation API
            return {
                latitude: 5.4164,
                longitude: 100.3327,
                accuracy: 10
            };
        }
        
        function updateTimeStatus() {
            const statusElement = document.getElementById('timeStatus');
            const punchInBtn = document.getElementById('punchInBtn');
            const breakBtn = document.getElementById('breakBtn');
            const punchOutBtn = document.getElementById('punchOutBtn');
            
            if (currentTimeStatus === 'in') {
                statusElement.textContent = 'You are punched in';
                punchInBtn.disabled = true;
                breakBtn.disabled = false;
                punchOutBtn.disabled = false;
            } else if (currentTimeStatus === 'break') {
                statusElement.textContent = 'You are on break';
                punchInBtn.disabled = true;
                breakBtn.disabled = true;
                punchOutBtn.disabled = false;
            } else {
                statusElement.textContent = 'You are not punched in';
                punchInBtn.disabled = false;
                breakBtn.disabled = true;
                punchOutBtn.disabled = true;
            }
        }
        
        function loadTimeRecords() {
            const tableBody = document.getElementById('timeRecordTable');
            const today = new Date().toISOString().split('T')[0];
            
            // Get today's records for current user
            const todayRecords = timeRecords.filter(r => 
                r.date === today && r.crewId === currentUser.id
            );
            
            if (tableBody) {
                if (todayRecords.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="3" class="text-center">No time records for today</td></tr>';
                    return;
                }
                
                tableBody.innerHTML = '';
                
                // Sort records by time
                const sortedRecords = [...todayRecords].sort((a, b) => new Date(a.time) - new Date(b.time));
                
                // Calculate durations
                for (let i = 0; i < sortedRecords.length; i++) {
                    const record = sortedRecords[i];
                    let duration = '';
                    
                    if (i > 0 && record.action === 'punch-out' && sortedRecords[i-1].action === 'punch-in') {
                        const startTime = new Date(sortedRecords[i-1].time);
                        const endTime = new Date(record.time);
                        const diffMs = endTime - startTime;
                        const diffHrs = Math.floor(diffMs / 3600000);
                        const diffMins = Math.floor((diffMs % 3600000) / 60000);
                        duration = `${diffHrs}h ${diffMins}m`;
                    } else if (i > 0 && record.action === 'break' && sortedRecords[i-1].action === 'punch-in') {
                        const startTime = new Date(sortedRecords[i-1].time);
                        const endTime = new Date(record.time);
                        const diffMs = endTime - startTime;
                        const diffHrs = Math.floor(diffMs / 3600000);
                        const diffMins = Math.floor((diffMs % 3600000) / 60000);
                        duration = `${diffHrs}h ${diffMins}m`;
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${record.action.replace('-', ' ').toUpperCase()}</td>
                        <td>${new Date(record.time).toLocaleTimeString()}</td>
                        <td>${duration}</td>
                    `;
                    tableBody.appendChild(row);
                }
                
                // Update current status based on last record
                if (sortedRecords.length > 0) {
                    const lastRecord = sortedRecords[sortedRecords.length - 1];
                    if (lastRecord.action === 'punch-in') {
                        currentTimeStatus = 'in';
                    } else if (lastRecord.action === 'break') {
                        currentTimeStatus = 'break';
                    } else {
                        currentTimeStatus = 'out';
                    }
                    updateTimeStatus();
                }
            }
        }
        
        // Update dashboard
        function updateDashboard() {
            // Update dashboard cards
            const totalCashbillsElement = document.getElementById('totalCashbills');
            const totalRevenueElement = document.getElementById('totalRevenue');
            const totalLogEntriesElement = document.getElementById('totalLogEntries');
            const pendingOrdersElement = document.getElementById('pendingOrders');
            
            if (totalCashbillsElement) {
                totalCashbillsElement.textContent = cashbills.length;
            }
            
            if (totalRevenueElement) {
                const totalRevenue = cashbills.reduce((sum, cashbill) => sum + cashbill.totalAmount, 0);
                totalRevenueElement.textContent = `RM ${totalRevenue.toFixed(2)}`;
            }
            
            if (totalLogEntriesElement) {
                totalLogEntriesElement.textContent = logEntries.length;
            }
            
            if (pendingOrdersElement) {
                const pendingOrdersCount = onlineOrders.filter(order => order.status === 'pending').length;
                pendingOrdersElement.textContent = pendingOrdersCount;
            }
            
            // Update recent cashbills
            const recentCashbillsTable = document.getElementById('recentCashbills');
            if (recentCashbillsTable) {
                recentCashbillsTable.innerHTML = '';
                
                if (cashbills.length === 0) {
                    recentCashbillsTable.innerHTML = '<tr><td colspan="5" class="text-center">No cashbills found</td></tr>';
                } else {
                    // Sort cashbills by date (newest first) and take the first 5
                    const recentCashbills = [...cashbills]
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 5);
                    
                    recentCashbills.forEach(cashbill => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${cashbill.id}</td>
                            <td>${cashbill.customerName}</td>
                            <td>${cashbill.date}</td>
                            <td>RM ${cashbill.totalAmount.toFixed(2)}</td>
                            <td><span class="badge badge-${cashbill.status}">${cashbill.status}</span></td>
                        `;
                        recentCashbillsTable.appendChild(row);
                    });
                }
            }
            
            // Update recent log entries
            const recentLogEntriesTable = document.getElementById('recentLogEntries');
            if (recentLogEntriesTable) {
                recentLogEntriesTable.innerHTML = '';
                
                if (logEntries.length === 0) {
                    recentLogEntriesTable.innerHTML = '<tr><td colspan="4" class="text-center">No log entries found</td></tr>';
                } else {
                    // Sort log entries by date (newest first) and take the first 5
                    const recentLogEntries = [...logEntries]
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 5);
                    
                    recentLogEntries.forEach(entry => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${entry.date}</td>
                            <td>${entry.description.length > 50 ? entry.description.substring(0, 50) + '...' : entry.description}</td>
                            <td>${entry.crew}</td>
                            <td><span class="badge badge-${entry.status}">${entry.status}</span></td>
                        `;
                        recentLogEntriesTable.appendChild(row);
                    });
                }
            }
            
            // Update charts
            updateCharts();
        }
        
        // Update charts
        function updateCharts() {
            // Update revenue chart with real data
            if (revenueChart) {
                // Get cashbills for the last 7 days
                const today = new Date();
                const lastWeek = new Date(today);
                lastWeek.setDate(today.getDate() - 7);
                
                const lastWeekCashbills = cashbills.filter(cashbill => {
                    const cashbillDate = new Date(cashbill.date);
                    return cashbillDate >= lastWeek && cashbillDate <= today;
                });
                
                // Group by day
                const dailyRevenue = [0, 0, 0, 0, 0, 0, 0];
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                
                lastWeekCashbills.forEach(cashbill => {
                    const dayOfWeek = new Date(cashbill.date).getDay();
                    dailyRevenue[dayOfWeek] += cashbill.totalAmount;
                });
                
                revenueChart.data.datasets[0].data = dailyRevenue;
                revenueChart.update();
            }
            
            // Update activity chart with real data
            if (activityChart) {
                const cashbillCount = cashbills.length;
                const logbookCount = logEntries.length;
                const quotationCount = quotations.length;
                const orderCount = onlineOrders.length;
                
                activityChart.data.datasets[0].data = [cashbillCount, logbookCount, quotationCount, orderCount];
                activityChart.update();
            }
        }
        
        // Change chart period
        function changeChartPeriod(period, element) {
            // Update active period
            document.querySelectorAll('.chart-option').forEach(option => {
                option.classList.remove('active');
            });
            element.classList.add('active');
            
            // Update chart based on period
            if (revenueChart) {
                let data = [];
                let labels = [];
                
                if (period === 'week') {
                    labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                    data = [1200, 1900, 3000, 5000, 2000, 3000, 4500];
                } else if (period === 'month') {
                    labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                    data = [12000, 19000, 15000, 22000];
                } else if (period === 'year') {
                    labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    data = [65000, 59000, 80000, 81000, 56000, 55000, 40000, 65000, 59000, 80000, 81000, 56000];
                }
                
                revenueChart.data.labels = labels;
                revenueChart.data.datasets[0].data = data;
                revenueChart.update();
            }
        }
        
        // Refresh dashboard
        function refreshDashboard() {
            showToast('Refreshing dashboard...', 'success');
            
            // Simulate loading delay
            setTimeout(() => {
                updateDashboard();
                showToast('Dashboard refreshed successfully', 'success');
            }, 1000);
        }
        
        // Export dashboard
        function exportDashboard() {
            // In a real application, this would generate and download a report
            showToast('Dashboard export started', 'success');
        }
        
        // Generate report
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('reportDateRange').value;
            const outlet = document.getElementById('reportOutlet').value;
            const format = document.getElementById('reportFormat').value;
            
            if (!dateRange) {
                showToast('Please select a date range', 'error');
                return;
            }
            
            // Show preview
            document.getElementById('reportPreview').style.display = 'block';
            
            // In a real application, this would generate the report based on the selected options
            showToast(`Generating ${reportType} report in ${format} format...`, 'success');
            
            // Log the action
            logAuditTrail('create', 'Report Generated', `Generated ${reportType} report for ${outlet} outlet`);
        }
        
        // Preview report
        function previewReport() {
            generateReport();
        }
        
        // Download report
        function downloadReport() {
            // In a real application, this would download the generated report
            showToast('Report download started', 'success');
        }
        
        // Show all reports
        function showAllReports() {
            // In a real application, this would navigate to a reports listing page
            showToast('Showing all reports', 'success');
        }
        
        // View report
        function viewReport(reportId) {
            // In a real application, this would open the report details
            showToast(`Viewing report ${reportId}`, 'success');
        }
        
        // Export audit log
        function exportAuditLog() {
            // In a real application, this would export the audit log
            showToast('Audit log export started', 'success');
        }
        
        // Log audit trail
        function logAuditTrail(action, description, details) {
            const auditLog = {
                id: `AUDIT-${Date.now()}`,
                userId: currentUser.id,
                userName: currentUser.name,
                action: action,
                description: description,
                details: details,
                timestamp: new Date().toISOString(),
                ipAddress: '192.168.1.1' // In a real application, this would be the actual IP
            };
            
            // In a real application, this would be saved to a database
            // For now, we'll just store it in memory
            if (!window.auditLogs) {
                window.auditLogs = [];
            }
            
            window.auditLogs.push(auditLog);
            
            // Keep only the last 1000 audit logs
            if (window.auditLogs.length > 1000) {
                window.auditLogs = window.auditLogs.slice(-1000);
            }
        }
        
        // Show toast notification
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            let icon = '';
            if (type === 'success') {
                icon = '<i class="fas fa-check-circle toast-icon"></i>';
            } else if (type === 'error') {
                icon = '<i class="fas fa-times-circle toast-icon"></i>';
            } else if (type === 'warning') {
                icon = '<i class="fas fa-exclamation-triangle toast-icon"></i>';
            }
            
            toast.innerHTML = `
                ${icon}
                <div>${message}</div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove toast after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        // Show confirmation modal
        function showConfirmation(message, callback) {
            const modal = document.getElementById('confirmationModal');
            const messageElement = document.getElementById('confirmationMessage');
            const confirmButton = document.getElementById('confirmButton');
            
            messageElement.textContent = message;
            modal.classList.add('active');
            
            // Set up confirmation button
            confirmButton.onclick = function() {
                callback();
                closeModal('confirmationModal');
            };
        }
        
        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // Save data to localStorage
        function saveDataToStorage() {
            localStorage.setItem('pneArenaData', JSON.stringify({
                cashbills: cashbills,
                logEntries: logEntries,
                quotations: quotations,
                onlineOrders: onlineOrders,
                crews: crews,
                stockItems: stockItems,
                scheduleData: scheduleData,
                timeRecords: timeRecords,
                invoiceCounter: invoiceCounter,
                orderCounter: orderCounter,
                quotationCounter: quotationCounter,
                auditLogs: window.auditLogs || []
            }));
        }
        
        // Load data from localStorage
        function loadDataFromStorage() {
            const savedData = localStorage.getItem('pneArenaData');
            
            if (savedData) {
                const data = JSON.parse(savedData);
                
                if (data.cashbills) cashbills = data.cashbills;
                if (data.logEntries) logEntries = data.logEntries;
                if (data.quotations) quotations = data.quotations;
                if (data.onlineOrders) onlineOrders = data.onlineOrders;
                if (data.crews) crews = data.crews;
                if (data.stockItems) stockItems = data.stockItems;
                if (data.scheduleData) scheduleData = data.scheduleData;
                if (data.timeRecords) timeRecords = data.timeRecords;
                if (data.invoiceCounter) invoiceCounter = data.invoiceCounter;
                if (data.orderCounter) orderCounter = data.orderCounter;
                if (data.quotationCounter) quotationCounter = data.quotationCounter;
                if (data.auditLogs) window.auditLogs = data.auditLogs;
            }
        }
    </script>
</body>
</html>