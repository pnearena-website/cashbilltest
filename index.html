<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNE ARENA - Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10./font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #28cc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --sidebar-width: 250px;
            --sidebar-collapsed-width: 0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .login-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 30px;
            width: 100%;
            max-width: 400px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-form .form-control {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            font-size: 16px;
        }

        .login-form .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .login-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 12px;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .login-btn:hover {
            background-color: var(--secondary-color);
        }

        /* Main Application */
        .app-container {
            display: none;
        }

        /* Top Navigation Bar */
        .top-navbar {
            background-color: white;
            color: var(--dark-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 60px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            color: var(--primary-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-role {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
        }

        .logout-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .logout-btn:hover {
            background-color: #c0392b;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 60px);
            background-color: white;
            color: var(--dark-color);
            transition: width 0.3s ease;
            overflow-x: hidden;
            z-index: 999;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar-toggle {
            position: absolute;
            top: 15px;
            right: -40px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark-color);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .sidebar-toggle:hover {
            background-color: var(--light-color);
        }

        .sidebar-menu {
            margin-top: 20px;
            list-style: none;
            padding: 0 10px;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: var(--dark-color);
            text-decoration: none;
            transition: background-color 0.3s;
            border-radius: 4px;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
        }

        .sidebar-menu i {
            margin-right: 10px;
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        .sidebar.collapsed .sidebar-menu span {
            display: none;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: 60px;
            padding: 20px;
            transition: margin-left 0.3s ease;
            min-height: calc(100vh - 60px);
        }

        .main-content.expanded {
            margin-left: var(--sidebar-collapsed-width);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Dashboard */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-icon {
            font-size: 30px;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .card-value {
            font-size: 24px;
            font-weight: bold;
        }

        /* Forms */
        .form-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .form-control, .form-select {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px 12px;
            width: 100%;
            transition: border-color 0.3s;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        /* Tables */
        .table-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .table tr:hover {
            background-color: #f8f9fa;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e67e22;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        /* Status badges */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-draft {
            background-color: var(--warning-color);
            color: white;
        }

        .badge-committed {
            background-color: var(--success-color);
            color: white;
        }

        .badge-pending {
            background-color: var(--primary-color);
            color: white;
        }

        .badge-fulfilled {
            background-color: var(--success-color);
            color: white;
        }

        /* Schedule Table */
        .schedule-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .schedule-table th, .schedule-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
            vertical-align: top;
        }

        .schedule-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .schedule-table .crew-name {
            text-align: left;
            font-weight: 500;
            min-width: 150px;
        }

        .schedule-table .day-header {
            background-color: var(--primary-color);
            color: white;
            position: sticky;
            top: 0;
        }

        .schedule-table .day-date {
            font-size: 12px;
            font-weight: normal;
            display: block;
        }

        .schedule-table .total-hours {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .schedule-cell {
            min-height: 80px;
            position: relative;
        }

        .schedule-cell.off-day {
            background-color: #f8f9fa;
            color: #7f8c8d;
        }

        .schedule-cell.annual-leave {
            background-color: #fff3cd;
            color: #856404;
        }

        .schedule-cell.working {
            background-color: #d4edda;
            color: #155724;
        }

        .schedule-cell .hours {
            font-size: 14px;
            margin-top: 5px;
        }

        .edit-schedule-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--dark-color);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .edit-schedule-btn:hover {
            background-color: var(--light-color);
        }

        .crew-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .crew-checkbox {
            display: flex;
            align-items: center;
            background-color: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .crew-checkbox:hover {
            background-color: #e9ecef;
        }

        .crew-checkbox input {
            margin-right: 5px;
        }

        /* Loading Animation */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* No Schedule Message */
        .no-schedule-message {
            text-align: center;
            padding: 40px;
            background-color: #f8f9fa;
            border-radius: 8px;
            color: #7f8c8d;
            font-size: 18px;
        }

        /* Edit Mode Styles */
        .edit-mode-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .edit-mode-btn:hover {
            background-color: #c0392b;
        }

        .save-mode-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .save-mode-btn:hover {
            background-color: #27ae60;
        }

        .schedule-cell.editable {
            cursor: pointer;
        }

        .schedule-cell.editable:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }

        .schedule-cell.editing {
            background-color: rgba(52, 152, 219, 0.2);
        }

        .schedule-cell .edit-input {
            width: 100%;
            padding: 5px;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            margin-top: 5px;
        }

        .schedule-cell .status-select {
            width: 100%;
            padding: 5px;
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            margin-top: 5px;
        }

        /* Time Tracking */
        .time-tracking-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .time-status {
            font-size: 18px;
            margin-bottom: 15px;
        }

        .time-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .time-record {
            margin-top: 20px;
            text-align: left;
        }

        .time-record h4 {
            margin-bottom: 10px;
        }

        .time-record table {
            width: 100%;
            border-collapse: collapse;
        }

        .time-record th, .time-record td {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
        }

        .time-record th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        /* Create Cashbill Button */
        .create-cashbill-btn {
            position: fixed;
            top: 80px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
            z-index: 100;
        }

        .create-cashbill-btn:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        /* Cashbill Summary */
        .cashbill-summary {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .cashbill-summary h3 {
            margin-bottom: 15px;
        }

        .cashbill-summary .total-count {
            font-size: 48px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: var(--sidebar-collapsed-width);
            }
            
            .sidebar .sidebar-menu span {
                display: none;
            }
            
            .main-content {
                margin-left: var(--sidebar-collapsed-width);
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .schedule-controls {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 3000;
        }

        .toast {
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            min-width: 250px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-success {
            border-left: 4px solid var(--success-color);
        }

        .toast-error {
            border-left: 4px solid var(--danger-color);
        }

        .toast-warning {
            border-left: 4px solid var(--warning-color);
        }

        .toast-icon {
            margin-right: 10px;
            font-size: 20px;
        }

        .toast-success .toast-icon {
            color: var(--success-color);
        }

        .toast-error .toast-icon {
            color: var(--danger-color);
        }

        .toast-warning .toast-icon {
            color: var(--warning-color);
        }

        /* Print Styles */
        @media print {
            .top-navbar, .sidebar, .btn, .modal, .toast-container, .create-cashbill-btn {
                display: none !important;
            }
            
            .main-content {
                margin-left: 0 !important;
                margin-top: 0 !important;
                padding: 0 !important;
            }
            
            .page {
                display: block !important;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <i class="bi bi-building"></i> PNE ARENA
                </div>
                <p>Management System</p>
            </div>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">Staff ID</label>
                    <input type="text" class="form-control" id="username" placeholder="Enter Staff ID" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="Enter Password" required>
                </div>
                <button type="submit" class="login-btn">Login</button>
            </form>
            <div class="mt-3 text-center">
                <small>Default password: 0000</small>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="app-container" id="appContainer">
        <!-- Top Navigation Bar -->
        <div class="top-navbar">
            <div class="logo">
                <i class="bi bi-building"></i> PNE ARENA
            </div>
            <div class="user-info">
                <div class="user-role" id="userRole">Admin</div>
                <button class="logout-btn" onclick="logout()">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </button>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="bi bi-chevron-right"></i>
            </button>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" onclick="showPage('dashboard')"><i class="bi bi-speedometer2"></i> <span>Dashboard</span></a></li>
                <li><a href="#" onclick="showPage('cashbill')"><i class="bi bi-receipt"></i> <span>Cashbill</span></a></li>
                <li><a href="#" onclick="showPage('logbook')"><i class="bi bi-journal-text"></i> <span>Logbook</span></a></li>
                <li><a href="#" onclick="showPage('quotation')"><i class="bi bi-file-earmark-text"></i> <span>Quotation</span></a></li>
                <li><a href="#" onclick="showPage('schedule')"><i class="bi bi-calendar3"></i> <span>Schedule Timetable</span></a></li>
                <li><a href="#" onclick="showPage('onlineOrder')"><i class="bi bi-cart3"></i> <span>Online Order</span></a></li>
                <li><a href="#" onclick="showPage('crewManagement')" id="crewManagementLink" style="display: none;"><i class="bi bi-people"></i> <span>Crew Management</span></a></li>
                <li><a href="#" onclick="showPage('stockManagement')"><i class="bi bi-box-seam"></i> <span>Stock Management</span></a></li>
                <li><a href="#" onclick="showPage('timeTracking')"><i class="bi bi-clock-history"></i> <span>Time Tracking</span></a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboard">
                <h2 class="mb-4">Dashboard</h2>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-icon text-primary">
                            <i class="bi bi-receipt"></i>
                        </div>
                        <div class="card-title">Total Cashbills</div>
                        <div class="card-value" id="totalCashbills">0</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon text-success">
                            <i class="bi bi-cash-stack"></i>
                        </div>
                        <div class="card-title">Total Revenue</div>
                        <div class="card-value" id="totalRevenue">RM 0.00</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon text-info">
                            <i class="bi bi-journal-text"></i>
                        </div>
                        <div class="card-title">Log Entries</div>
                        <div class="card-value" id="totalLogEntries">0</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon text-warning">
                            <i class="bi bi-cart3"></i>
                        </div>
                        <div class="card-title">Pending Orders</div>
                        <div class="card-value" id="pendingOrders">0</div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="table-container">
                            <h4 class="mb-3">Recent Cashbills</h4>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Invoice #</th>
                                        <th>Customer</th>
                                        <th>Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentCashbills">
                                    <tr>
                                        <td colspan="5" class="text-center">No cashbills found</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="table-container">
                            <h4 class="mb-3">Recent Log Entries</h4>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Crew</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentLogEntries">
                                    <tr>
                                        <td colspan="4" class="text-center">No log entries found</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cashbill Page -->
            <div class="page" id="cashbill">
                <h2 class="mb-4">Cashbill Management</h2>
                
                <div id="cashbillFormContainer" style="display: none;">
                    <div class="form-container">
                        <h4 class="mb-3">Create New Cashbill</h4>
                        <form id="cashbillForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Invoice Number</label>
                                        <input type="text" class="form-control" id="invoiceNumber" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-control" id="cashbillDate" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Customer Name</label>
                                        <input type="text" class="form-control" id="customerName" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="customerPhone" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Outlet</label>
                                        <select class="form-select" id="cashbillOutlet" required>
                                            <option value="">Select Outlet</option>
                                            <option value="HQ">HQ</option>
                                            <option value="BLM">Bandar Laguna Merbok</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Item</label>
                                        <select class="form-select" id="cashbillItem" required>
                                            <option value="">Select Item</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Quantity</label>
                                        <input type="number" class="form-control" id="itemQuantity" min="1" value="1" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Price (RM)</label>
                                        <input type="number" class="form-control" id="itemPrice" step="0.01" min="0" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Total Amount (RM)</label>
                                <input type="number" class="form-control" id="totalAmount" step="0.01" min="0" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Notes</label>
                                <textarea class="form-control" id="cashbillNotes" rows="3"></textarea>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-primary" onclick="addItemToCashbill()">
                                    <i class="bi bi-plus-circle"></i> Add Item
                                </button>
                                <button type="button" class="btn btn-success" onclick="saveCashbill('draft')">
                                    <i class="bi bi-save"></i> Save as Draft
                                </button>
                                <button type="button" class="btn btn-success" onclick="saveCashbill('commit')">
                                    <i class="bi bi-check-circle"></i> Commit
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="printCashbill()">
                                    <i class="bi bi-printer"></i> Print
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="downloadCashbill()">
                                    <i class="bi bi-download"></i> Download PDF
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="table-container">
                        <h4 class="mb-3">Cashbill Items</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Quantity</th>
                                    <th>Price (RM)</th>
                                    <th>Total (RM)</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="cashbillItems">
                                <tr>
                                    <td colspan="5" class="text-center">No items added</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="cashbillSummaryContainer">
                    <div class="cashbill-summary">
                        <h3>Cashbill Summary</h3>
                        <div class="total-count" id="cashbillTotalCount">0</div>
                        <p>Total Cashbills Created</p>
                    </div>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Cashbill History</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Invoice #</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Amount (RM)</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="cashbillHistory">
                            <tr>
                                <td colspan="6" class="text-center">No cashbills found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Logbook Page -->
            <div class="page" id="logbook">
                <h2 class="mb-4">Logbook Management</h2>
                
                <div id="logbookFormContainer" style="display: none;">
                    <div class="form-container">
                        <h4 class="mb-3">Create New Log Entry</h4>
                        <form id="logbookForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-control" id="logDate" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Crew Involved</label>
                                        <select class="form-select" id="logCrew" required>
                                            <option value="">Select Crew</option>
                                            <option value="Danial Danish (0001)">Danial Danish (0001)</option>
                                            <option value="Aida (0002)">Aida (0002)</option>
                                            <option value="Putri Erinna (0003)">Putri Erinna (0003)</option>
                                            <option value="Putri Farah (0004)">Putri Farah (0004)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" id="logDescription" rows="4" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Price (RM)</label>
                                <input type="number" class="form-control" id="logPrice" step="0.01" min="0">
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-success" onclick="saveLogEntry('draft')">
                                    <i class="bi bi-save"></i> Save as Draft
                                </button>
                                <button type="button" class="btn btn-success" onclick="saveLogEntry('commit')">
                                    <i class="bi bi-check-circle"></i> Commit
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div id="logbookSummaryContainer">
                    <div class="cashbill-summary">
                        <h3>Logbook Summary</h3>
                        <div class="total-count" id="logbookTotalCount">0</div>
                        <p>Total Log Entries Created</p>
                    </div>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Log Entries</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Crew Involved</th>
                                <th>Price (RM)</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="logbookEntries">
                            <tr>
                                <td colspan="6" class="text-center">No log entries found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Quotation Page -->
            <div class="page" id="quotation">
                <h2 class="mb-4">Quotation Management</h2>
                
                <div id="quotationFormContainer" style="display: none;">
                    <div class="form-container">
                        <h4 class="mb-3">Create New Quotation</h4>
                        <form id="quotationForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Quotation Number</label>
                                        <input type="text" class="form-control" id="quotationNumber" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-control" id="quotationDate" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Client Name</label>
                                        <input type="text" class="form-control" id="clientName" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Client Email</label>
                                        <input type="email" class="form-control" id="clientEmail" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Client Phone</label>
                                        <input type="tel" class="form-control" id="clientPhone" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Company</label>
                                        <input type="text" class="form-control" id="clientCompany">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Services</label>
                                <div id="quotationServices">
                                    <div class="row mb-2">
                                        <div class="col-md-6">
                                            <input type="text" class="form-control service-name" placeholder="Service Name" required>
                                        </div>
                                        <div class="col-md-4">
                                            <input type="number" class="form-control service-price" placeholder="Price (RM)" step="0.01" min="0" required>
                                        </div>
                                        <div class="col-md-2">
                                            <button type="button" class="btn btn-danger btn-sm" onclick="removeQuotationService(this)">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-primary btn-sm mt-2" onclick="addQuotationService()">
                                    <i class="bi bi-plus-circle"></i> Add Service
                                </button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Total Amount (RM)</label>
                                <input type="number" class="form-control" id="quotationTotal" step="0.01" min="0" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Notes</label>
                                <textarea class="form-control" id="quotationNotes" rows="3"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Template</label>
                                <select class="form-select" id="quotationTemplate">
                                    <option value="">Select Template</option>
                                    <option value="standard">Standard Template</option>
                                    <option value="premium">Premium Template</option>
                                </select>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-success" onclick="saveQuotation()">
                                    <i class="bi bi-save"></i> Save
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="downloadQuotation()">
                                    <i class="bi bi-download"></i> Download
                                </button>
                                <button type="button" class="btn btn-secondary" onclick="emailQuotation()">
                                    <i class="bi bi-envelope"></i> Send Email
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div id="quotationSummaryContainer">
                    <div class="cashbill-summary">
                        <h3>Quotation Summary</h3>
                        <div class="total-count" id="quotationTotalCount">0</div>
                        <p>Total Quotations Created</p>
                    </div>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Quotation History</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Quotation #</th>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Amount (RM)</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="quotationHistory">
                            <tr>
                                <td colspan="6" class="text-center">No quotations found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Schedule Page -->
            <div class="page" id="schedule">
                <div class="schedule-controls">
                    <h2>Schedule Timetable</h2>
                    <div>
                        <input type="date" class="form-control d-inline-block" id="scheduleDate" style="width: auto;">
                        <button class="btn btn-primary ms-2" onclick="loadSchedule()">
                            <i class="bi bi-search"></i> Find
                        </button>
                        <button class="btn btn-secondary ms-2" onclick="setTodaySchedule()">
                            <i class="bi bi-calendar-day"></i> Today
                        </button>
                        <button class="btn btn-success ms-2" onclick="createNewSchedule()">
                            <i class="bi bi-plus-circle"></i> Create Schedule
                        </button>
                        <button class="btn btn-primary ms-2" onclick="saveSchedule()">
                            <i class="bi bi-save"></i> Save Schedule
                        </button>
                        <button id="editScheduleBtn" class="edit-mode-btn ms-2" onclick="toggleEditMode()">
                            <i class="bi bi-pencil"></i> Edit
                        </button>
                        <button id="saveScheduleChangesBtn" class="save-mode-btn ms-2" style="display: none;" onclick="saveScheduleChanges()">
                            <i class="bi bi-check"></i> Save Changes
                        </button>
                    </div>
                </div>
                
                <div class="form-container" id="scheduleFormContainer" style="display: none;">
                    <h4 class="mb-3">Create New Schedule</h4>
                    <div class="form-group">
                        <label class="form-label">Week Starting</label>
                        <input type="date" class="form-control" id="newScheduleWeek" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Select Crew Members</label>
                        <div class="crew-selector" id="crewSelector">
                            <!-- Crew checkboxes will be generated here -->
                        </div>
                    </div>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-success" onclick="addCrewToSchedule()">
                            <i class="bi bi-plus-circle"></i> Add to Schedule
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="cancelNewSchedule()">
                            <i class="bi bi-x-circle"></i> Cancel
                        </button>
                    </div>
                </div>
                
                <div id="scheduleLoadingContainer" style="display: none;">
                    <div class="loading-container">
                        <div class="spinner"></div>
                        <p class="mt-2">Loading schedule data...</p>
                    </div>
                </div>
                
                <div id="scheduleTableContainer">
                    <div class="table-container">
                        <table class="schedule-table" id="scheduleTable">
                            <thead>
                                <tr>
                                    <th>Crew Name</th>
                                    <th class="day-header">
                                        Sunday
                                        <span class="day-date" id="sundayDate"></span>
                                    </th>
                                    <th class="day-header">
                                        Monday
                                        <span class="day-date" id="mondayDate"></span>
                                    </th>
                                    <th class="day-header">
                                        Tuesday
                                        <span class="day-date" id="tuesdayDate"></span>
                                    </th>
                                    <th class="day-header">
                                        Wednesday
                                        <span class="day-date" id="wednesdayDate"></span>
                                    </th>
                                    <th class="day-header">
                                        Thursday
                                        <span class="day-date" id="thursdayDate"></span>
                                    </th>
                                    <th class="day-header">
                                        Friday
                                        <span class="day-date" id="fridayDate"></span>
                                    </th>
                                    <th class="day-header">
                                        Saturday
                                        <span class="day-date" id="saturdayDate"></span>
                                    </th>
                                    <th>Total Hours</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleTableBody">
                                <!-- Schedule rows will be generated here -->
                            </tbody>
                            <tfoot>
                                <tr>
                                    <td class="total-hours">Daily Total</td>
                                    <td class="total-hours" id="sundayTotal">0</td>
                                    <td class="total-hours" id="mondayTotal">0</td>
                                    <td class="total-hours" id="tuesdayTotal">0</td>
                                    <td class="total-hours" id="wednesdayTotal">0</td>
                                    <td class="total-hours" id="thursdayTotal">0</td>
                                    <td class="total-hours" id="fridayTotal">0</td>
                                    <td class="total-hours" id="saturdayTotal">0</td>
                                    <td class="total-hours" id="weeklyTotal">0</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                
                <div id="noScheduleContainer" style="display: none;">
                    <div class="no-schedule-message">
                        <i class="bi bi-calendar-x" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <h3>No Schedule Found</h3>
                        <p>No schedule exists for the selected week. Please create a new schedule.</p>
                    </div>
                </div>
            </div>

            <!-- Online Order Page -->
            <div class="page" id="onlineOrder">
                <h2 class="mb-4">Online Order Management</h2>
                
                <div id="adminOrderSection" style="display: none;">
                    <div class="form-container">
                        <h4 class="mb-3">Add New Order</h4>
                        <form id="onlineOrderForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Order ID</label>
                                        <input type="text" class="form-control" id="orderId" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-control" id="orderDate" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Customer Name</label>
                                        <input type="text" class="form-control" id="orderCustomerName" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Customer Email</label>
                                        <input type="email" class="form-control" id="orderCustomerEmail" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Customer Phone</label>
                                        <input type="tel" class="form-control" id="orderCustomerPhone" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Assign to Outlet</label>
                                        <select class="form-select" id="orderOutlet" required>
                                            <option value="">Select Outlet</option>
                                            <option value="HQ">HQ</option>
                                            <option value="BLM">Bandar Laguna Merbok</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Order Items</label>
                                <div id="orderItems">
                                    <div class="row mb-2">
                                        <div class="col-md-6">
                                            <input type="text" class="form-control order-item-name" placeholder="Item Name" required>
                                        </div>
                                        <div class="col-md-4">
                                            <input type="number" class="form-control order-item-price" placeholder="Price (RM)" step="0.01" min="0" required>
                                        </div>
                                        <div class="col-md-2">
                                            <button type="button" class="btn btn-danger btn-sm" onclick="removeOrderItem(this)">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-primary btn-sm mt-2" onclick="addOrderItem()">
                                    <i class="bi bi-plus-circle"></i> Add Item
                                </button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Total Amount (RM)</label>
                                <input type="number" class="form-control" id="orderTotal" step="0.01" min="0" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Notes</label>
                                <textarea class="form-control" id="orderNotes" rows="3"></textarea>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-success" onclick="saveOnlineOrder()">
                                    <i class="bi bi-save"></i> Save Order
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div id="onlineOrderSummaryContainer">
                    <div class="cashbill-summary">
                        <h3>Online Order Summary</h3>
                        <div class="total-count" id="onlineOrderTotalCount">0</div>
                        <p>Total Online Orders Created</p>
                    </div>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Online Orders</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Amount (RM)</th>
                                <th>Outlet</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="onlineOrders">
                            <tr>
                                <td colspan="7" class="text-center">No orders found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Crew Management Page -->
            <div class="page" id="crewManagement">
                <h2 class="mb-4">Crew Management</h2>
                
                <div class="form-container">
                    <h4 class="mb-3">Add New Crew</h4>
                    <form id="crewForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control" id="crewName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">ID</label>
                                    <input type="text" class="form-control" id="crewId" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Position</label>
                                    <input type="text" class="form-control" id="crewPosition" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Role</label>
                                    <select class="form-select" id="crewRole" required>
                                        <option value="">Select Role</option>
                                        <option value="Admin">Admin</option>
                                        <option value="Supervisor">Supervisor</option>
                                        <option value="Crew">Crew</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Outlet</label>
                            <select class="form-select" id="crewOutlet" required>
                                <option value="">Select Outlet</option>
                                <option value="HQ">HQ</option>
                                <option value="BLM">Bandar Laguna Merbok</option>
                            </select>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-success" onclick="saveCrew()">
                                <i class="bi bi-save"></i> Save Crew
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetCrewForm()">
                                <i class="bi bi-arrow-clockwise"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Crew List</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Role</th>
                                <th>Outlet</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="crewList">
                            <tr>
                                <td>0001</td>
                                <td>Danial Danish</td>
                                <td>Head IT</td>
                                <td>Admin</td>
                                <td>HQ</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="editCrew('0001')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCrew('0001')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>0002</td>
                                <td>Aida</td>
                                <td>Director/Business Manager</td>
                                <td>Supervisor</td>
                                <td>HQ</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="editCrew('0002')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCrew('0002')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>0003</td>
                                <td>Putri Erinna</td>
                                <td>Business Development Manager</td>
                                <td>Crew</td>
                                <td>HQ</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="editCrew('0003')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCrew('0003')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>0004</td>
                                <td>Putri Farah</td>
                                <td>Business Marketing Manager</td>
                                <td>Crew</td>
                                <td>HQ</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="editCrew('0004')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCrew('0004')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Stock Management Page -->
            <div class="page" id="stockManagement">
                <h2 class="mb-4">Stock Management</h2>
                
                <div class="form-container" id="stockFormContainer" style="display: none;">
                    <h4 class="mb-3">Add New Stock Item</h4>
                    <form id="stockForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Item Name</label>
                                    <input type="text" class="form-control" id="stockItemName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">SKU</label>
                                    <input type="text" class="form-control" id="stockSku" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <select class="form-select" id="stockCategory" required>
                                        <option value="">Select Category</option>
                                        <option value="Electronics">Electronics</option>
                                        <option value="Clothing">Clothing</option>
                                        <option value="Food & Beverage">Food & Beverage</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Price (RM)</label>
                                    <input type="number" class="form-control" id="stockPrice" step="0.01" min="0" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="stockQuantity" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Outlet</label>
                                    <select class="form-select" id="stockOutlet" required>
                                        <option value="">Select Outlet</option>
                                        <option value="HQ">HQ</option>
                                        <option value="BLM">Bandar Laguna Merbok</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="stockDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-success" onclick="saveStock()">
                                <i class="bi bi-save"></i> Save Stock
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetStockForm()">
                                <i class="bi bi-arrow-clockwise"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Stock List</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>SKU</th>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Price (RM)</th>
                                <th>Quantity</th>
                                <th>Outlet</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="stockList">
                            <tr>
                                <td colspan="7" class="text-center">No stock items found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Time Tracking Page -->
            <div class="page" id="timeTracking">
                <h2 class="mb-4">Time Tracking</h2>
                
                <div class="time-tracking-container">
                    <div class="time-status" id="timeStatus">
                        You are not punched in
                    </div>
                    <div class="time-actions">
                        <button class="btn btn-success" id="punchInBtn" onclick="punchIn()">
                            <i class="bi bi-play-circle"></i> Punch In
                        </button>
                        <button class="btn btn-warning" id="breakBtn" onclick="takeBreak()" disabled>
                            <i class="bi bi-pause-circle"></i> Break
                        </button>
                        <button class="btn btn-danger" id="punchOutBtn" onclick="punchOut()" disabled>
                            <i class="bi bi-stop-circle"></i> Punch Out
                        </button>
                    </div>
                </div>
                
                <div class="time-record">
                    <h4>Today's Time Record</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Action</th>
                                <th>Time</th>
                                <th>Duration</th>
                            </tr>
                        </thead>
                        <tbody id="timeRecordTable">
                            <tr>
                                <td colspan="3" class="text-center">No time records for today</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Create Cashbill Button -->
        <button class="create-cashbill-btn" id="createCashbillBtn" onclick="toggleCashbillForm()" style="display: none;">
            <i class="bi bi-plus-lg"></i> Create Cashbill
        </button>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal for Schedule Edit -->
    <div class="modal" id="scheduleEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Schedule</h5>
                <button class="modal-close" onclick="closeModal('scheduleEditModal')">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="scheduleEditForm">
                    <div class="form-group">
                        <label class="form-label">Crew Member</label>
                        <input type="text" class="form-control" id="editCrewName" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Day</label>
                        <input type="text" class="form-control" id="editDay" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="editStatus">
                            <option value="working">Working</option>
                            <option value="off-day">Off Day</option>
                            <option value="annual-leave">Annual Leave</option>
                        </select>
                    </div>
                    <div class="form-group" id="editHoursGroup">
                        <label class="form-label">Hours</label>
                        <input type="text" class="form-control" id="editHours" placeholder="e.g., 9:00 AM - 5:00 PM">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('scheduleEditModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveScheduleEdit()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Modal for Confirmation -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationTitle">Confirmation</h5>
                <button class="modal-close" onclick="closeModal('confirmationModal')">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('confirmationModal')">Cancel</button>
                <button class="btn btn-primary" id="confirmButton">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = {
            id: '0001',
            name: 'Danial Danish',
            role: 'Admin',
            outlet: 'HQ'
        };

        let cashbills = [];
        let logEntries = [];
        let quotations = [];
        let onlineOrders = [];
        let crews = [
            { id: '0001', name: 'Danial Danish', position: 'Head IT', role: 'Admin', outlet: 'HQ' },
            { id: '0002', name: 'Aida', position: 'Director/Business Manager', role: 'Supervisor', outlet: 'HQ' },
            { id: '0003', name: 'Putri Erinna', position: 'Business Development Manager', role: 'Crew', outlet: 'HQ' },
            { id: '0004', name: 'Putri Farah', position: 'Business Marketing Manager', role: 'Crew', outlet: 'HQ' }
        ];
        let stockItems = [
            { sku: 'SKU001', name: 'Laptop', category: 'Electronics', price: 2500, quantity: 10, outlet: 'HQ' },
            { sku: 'SKU002', name: 'Mouse', category: 'Electronics', price: 50, quantity: 25, outlet: 'HQ' },
            { sku: 'SKU003', name: 'Keyboard', category: 'Electronics', price: 100, quantity: 15, outlet: 'HQ' },
            { sku: 'SKU004', name: 'T-Shirt', category: 'Clothing', price: 30, quantity: 50, outlet: 'HQ' }
        ];

        let currentCashbillItems = [];
        let currentQuotationServices = [];
        let currentOrderItems = [];
        let invoiceCounter = 1;
        let orderCounter = 1;
        let quotationCounter = 1;
        
        // Schedule data
        let scheduleData = [
            {
                crewId: '0001',
                crewName: 'Danial Danish',
                sunday: { status: 'off-day', hours: '' },
                monday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                tuesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                wednesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                thursday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                friday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                saturday: { status: 'off-day', hours: '' }
            },
            {
                crewId: '0002',
                crewName: 'Aida',
                sunday: { status: 'off-day', hours: '' },
                monday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                tuesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                wednesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                thursday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                friday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                saturday: { status: 'off-day', hours: '' }
            },
            {
                crewId: '0003',
                crewName: 'Putri Erinna',
                sunday: { status: 'off-day', hours: '' },
                monday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                tuesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                wednesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                thursday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                friday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                saturday: { status: 'off-day', hours: '' }
            },
            {
                crewId: '0004',
                crewName: 'Putri Farah',
                sunday: { status: 'off-day', hours: '' },
                monday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                tuesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                wednesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                thursday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                friday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                saturday: { status: 'off-day', hours: '' }
            }
        ];
        
        // Time tracking data
        let timeRecords = [];
        let currentTimeStatus = 'out'; // 'in', 'break', 'out'
        let currentScheduleEdit = {
            crewId: '',
            crewName: '',
            day: '',
            status: '',
            hours: ''
        };
        let isEditMode = false;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            checkLoginStatus();
            
            // Set current date to all date fields
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('cashbillDate').value = today;
            document.getElementById('logDate').value = today;
            document.getElementById('quotationDate').value = today;
            document.getElementById('orderDate').value = today;
            document.getElementById('scheduleDate').value = today;

            // Generate initial numbers
            document.getElementById('invoiceNumber').value = `INV-${String(invoiceCounter).padStart(4, '0')}`;
            document.getElementById('orderId').value = `ORD-${String(orderCounter).padStart(4, '0')}`;
            document.getElementById('quotationNumber').value = `QTN-${String(quotationCounter).padStart(4, '0')}`;

            // Populate stock items dropdown
            populateStockItemsDropdown();

            // Check user role and show/hide admin features
            checkUserRole();

            // Load data from localStorage if available
            loadDataFromStorage();

            // Update dashboard
            updateDashboard();

            // Set up sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);

            // Set up event listeners for dynamic calculations
            document.getElementById('itemQuantity').addEventListener('input', calculateCashbillTotal);
            document.getElementById('itemPrice').addEventListener('input', calculateCashbillTotal);
            
            document.getElementById('cashbillItem').addEventListener('change', function() {
                const selectedItem = stockItems.find(item => item.name === this.value);
                if (selectedItem) {
                    document.getElementById('itemPrice').value = selectedItem.price;
                    calculateCashbillTotal();
                }
            });

            // Set up event listeners for quotation services
            document.querySelectorAll('.service-price').forEach(input => {
                input.addEventListener('input', calculateQuotationTotal);
            });

            // Set up event listeners for order items
            document.querySelectorAll('.order-item-price').forEach(input => {
                input.addEventListener('input', calculateOrderTotal);
            });

            // Set up login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });

            // Set up schedule edit form
            document.getElementById('editStatus').addEventListener('change', function() {
                const hoursGroup = document.getElementById('editHoursGroup');
                if (this.value === 'working') {
                    hoursGroup.style.display = 'block';
                } else {
                    hoursGroup.style.display = 'none';
                }
            });

            // Load schedule
            loadSchedule();
            
            // Load time records for today
            loadTimeRecords();
        });

        // Check login status
        function checkLoginStatus() {
            const loggedInUser = localStorage.getItem('loggedInUser');
            
            if (loggedInUser) {
                currentUser = JSON.parse(loggedInUser);
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                checkUserRole();
            } else {
                document.getElementById('loginContainer').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
            }
        }

        // Login function
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Check if username matches any crew ID
            const crew = crews.find(c => c.id === username);
            
            if (crew && password === '0000') {
                currentUser = {
                    id: crew.id,
                    name: crew.name,
                    role: crew.role,
                    outlet: crew.outlet
                };
                
                // Save to localStorage
                localStorage.setItem('loggedInUser', JSON.stringify(currentUser));
                
                // Show app and hide login
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                
                // Update UI
                checkUserRole();
                updateDashboard();
                
                showToast('Login successful', 'success');
            } else {
                showToast('Invalid Staff ID or password', 'error');
            }
        }

        // Logout function
        function logout() {
            showConfirmation('Are you sure you want to logout?', function() {
                localStorage.removeItem('loggedInUser');
                document.getElementById('loginContainer').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
                
                // Reset login form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                showToast('Logged out successfully', 'success');
            });
        }

        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const toggleBtn = document.getElementById('sidebarToggle');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            
            if (sidebar.classList.contains('collapsed')) {
                toggleBtn.innerHTML = '<i class="bi bi-chevron-left"></i>';
            } else {
                toggleBtn.innerHTML = '<i class="bi bi-chevron-right"></i>';
            }
        }

        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update active menu item
            document.querySelectorAll('.sidebar-menu a').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('a').classList.add('active');
            
            // Show/hide create cashbill button based on page
            const createCashbillBtn = document.getElementById('createCashbillBtn');
            if (pageId === 'cashbill' || pageId === 'logbook' || pageId === 'quotation' || pageId === 'onlineOrder') {
                createCashbillBtn.style.display = 'flex';
            } else {
                createCashbillBtn.style.display = 'none';
            }
            
            // Update page-specific content
            if (pageId === 'dashboard') {
                updateDashboard();
            } else if (pageId === 'cashbill') {
                updateCashbillHistory();
            } else if (pageId === 'logbook') {
                updateLogbookEntries();
            } else if (pageId === 'quotation') {
                updateQuotationHistory();
            } else if (pageId === 'onlineOrder') {
                updateOnlineOrders();
            } else if (pageId === 'crewManagement') {
                updateCrewList();
            } else if (pageId === 'stockManagement') {
                updateStockList();
            } else if (pageId === 'timeTracking') {
                loadTimeRecords();
            } else if (pageId === 'schedule') {
                loadSchedule();
            }
        }

        // Check user role and show/hide admin features
        function checkUserRole() {
            const userRoleElement = document.getElementById('userRole');
            const crewManagementLink = document.getElementById('crewManagementLink');
            const adminOrderSection = document.getElementById('adminOrderSection');
            const stockFormContainer = document.getElementById('stockFormContainer');
            const editScheduleBtn = document.getElementById('editScheduleBtn');
            
            userRoleElement.textContent = currentUser.role;
            
            if (currentUser.role === 'Admin' || currentUser.role === 'Supervisor') {
                crewManagementLink.style.display = 'block';
                adminOrderSection.style.display = 'block';
                stockFormContainer.style.display = 'block';
                editScheduleBtn.style.display = 'inline-block';
            } else {
                crewManagementLink.style.display = 'none';
                adminOrderSection.style.display = 'none';
                stockFormContainer.style.display = 'none';
                editScheduleBtn.style.display = 'none';
            }
        }

        // Toggle cashbill form
        function toggleCashbillForm() {
            const currentPage = document.querySelector('.page.active').id;
            let formContainer, summaryContainer;
            
            switch(currentPage) {
                case 'cashbill':
                    formContainer = document.getElementById('cashbillFormContainer');
                    summaryContainer = document.getElementById('cashbillSummaryContainer');
                    break;
                case 'logbook':
                    formContainer = document.getElementById('logbookFormContainer');
                    summaryContainer = document.getElementById('logbookSummaryContainer');
                    break;
                case 'quotation':
                    formContainer = document.getElementById('quotationFormContainer');
                    summaryContainer = document.getElementById('quotationSummaryContainer');
                    break;
                case 'onlineOrder':
                    formContainer = document.getElementById('adminOrderSection');
                    summaryContainer = document.getElementById('onlineOrderSummaryContainer');
                    break;
            }
            
            if (formContainer && summaryContainer) {
                if (formContainer.style.display === 'none') {
                    formContainer.style.display = 'block';
                    summaryContainer.style.display = 'none';
                } else {
                    formContainer.style.display = 'none';
                    summaryContainer.style.display = 'block';
                }
            }
        }

        // Populate stock items dropdown
        function populateStockItemsDropdown() {
            const dropdown = document.getElementById('cashbillItem');
            dropdown.innerHTML = '<option value="">Select Item</option>';
            
            stockItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item.name;
                option.textContent = `${item.name} (RM ${item.price})`;
                dropdown.appendChild(option);
            });
        }

        // Calculate cashbill total
        function calculateCashbillTotal() {
            const quantity = parseFloat(document.getElementById('itemQuantity').value) || 0;
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;
            const total = quantity * price;
            
            document.getElementById('totalAmount').value = total.toFixed(2);
        }

        // Add item to cashbill
        function addItemToCashbill() {
            const itemName = document.getElementById('cashbillItem').value;
            const quantity = parseInt(document.getElementById('itemQuantity').value) || 0;
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;
            
            if (!itemName || quantity <= 0 || price <= 0) {
                showToast('Please fill in all item fields correctly', 'error');
                return;
            }
            
            const total = quantity * price;
            
            currentCashbillItems.push({
                name: itemName,
                quantity: quantity,
                price: price,
                total: total
            });
            
            updateCashbillItemsTable();
            resetCashbillItemForm();
        }

        // Update cashbill items table
        function updateCashbillItemsTable() {
            const tableBody = document.getElementById('cashbillItems');
            
            if (currentCashbillItems.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center">No items added</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            let grandTotal = 0;
            
            currentCashbillItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>RM ${item.price.toFixed(2)}</td>
                    <td>RM ${item.total.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="removeCashbillItem(${index})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
                
                grandTotal += item.total;
            });
            
            // Add grand total row
            const totalRow = document.createElement('tr');
            totalRow.innerHTML = `
                <td colspan="3" class="text-end fw-bold">Grand Total</td>
                <td class="fw-bold">RM ${grandTotal.toFixed(2)}</td>
                <td></td>
            `;
            tableBody.appendChild(totalRow);
            
            // Update total amount field
            document.getElementById('totalAmount').value = grandTotal.toFixed(2);
        }

        // Remove item from cashbill
        function removeCashbillItem(index) {
            currentCashbillItems.splice(index, 1);
            updateCashbillItemsTable();
        }

        // Reset cashbill item form
        function resetCashbillItemForm() {
            document.getElementById('cashbillItem').value = '';
            document.getElementById('itemQuantity').value = '1';
            document.getElementById('itemPrice').value = '';
        }

        // Save cashbill
        function saveCashbill(status) {
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const date = document.getElementById('cashbillDate').value;
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const outlet = document.getElementById('cashbillOutlet').value;
            const notes = document.getElementById('cashbillNotes').value;
            const totalAmount = parseFloat(document.getElementById('totalAmount').value) || 0;
            
            if (!date || !customerName || !customerPhone || !outlet || currentCashbillItems.length === 0) {
                showToast('Please fill in all required fields and add at least one item', 'error');
                return;
            }
            
            const cashbill = {
                id: invoiceNumber,
                date: date,
                customerName: customerName,
                customerPhone: customerPhone,
                outlet: outlet,
                items: [...currentCashbillItems],
                totalAmount: totalAmount,
                notes: notes,
                status: status,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            cashbills.push(cashbill);
            saveDataToStorage();
            
            showToast(`Cashbill ${invoiceNumber} saved as ${status}`, 'success');
            
            // Reset form
            resetCashbillForm();
            
            // Update counters and displays
            invoiceCounter++;
            document.getElementById('invoiceNumber').value = `INV-${String(invoiceCounter).padStart(4, '0')}`;
            updateCashbillHistory();
            updateDashboard();
            
            // Switch to summary view
            document.getElementById('cashbillFormContainer').style.display = 'none';
            document.getElementById('cashbillSummaryContainer').style.display = 'block';
        }

        // Reset cashbill form
        function resetCashbillForm() {
            document.getElementById('cashbillDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('cashbillOutlet').value = '';
            document.getElementById('cashbillNotes').value = '';
            document.getElementById('totalAmount').value = '';
            
            currentCashbillItems = [];
            updateCashbillItemsTable();
            resetCashbillItemForm();
        }

        // Update cashbill history
        function updateCashbillHistory() {
            const tableBody = document.getElementById('cashbillHistory');
            const totalCountElement = document.getElementById('cashbillTotalCount');
            
            totalCountElement.textContent = cashbills.length;
            
            if (cashbills.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No cashbills found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort cashbills by date (newest first)
            const sortedCashbills = [...cashbills].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedCashbills.forEach(cashbill => {
                const row = document.createElement('tr');
                
                let actionButtons = `
                    <button class="btn btn-sm btn-secondary" onclick="viewCashbill('${cashbill.id}')">
                        <i class="bi bi-eye"></i>
                    </button>
                `;
                
                if (currentUser.role === 'Admin') {
                    actionButtons += `
                        <button class="btn btn-sm btn-warning" onclick="uncommitCashbill('${cashbill.id}')">
                            <i class="bi bi-arrow-counterclockwise"></i>
                        </button>
                    `;
                } else if (cashbill.status === 'committed') {
                    actionButtons += `
                        <button class="btn btn-sm btn-warning" onclick="requestAdjustment('${cashbill.id}')">
                            <i class="bi bi-exclamation-triangle"></i>
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td>${cashbill.id}</td>
                    <td>${cashbill.date}</td>
                    <td>${cashbill.customerName}</td>
                    <td>RM ${cashbill.totalAmount.toFixed(2)}</td>
                    <td><span class="badge badge-${cashbill.status}">${cashbill.status}</span></td>
                    <td>${actionButtons}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // View cashbill details
        function viewCashbill(id) {
            const cashbill = cashbills.find(c => c.id === id);
            if (!cashbill) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing cashbill ${id}`, 'success');
        }

        // Uncommit cashbill (admin only)
        function uncommitCashbill(id) {
            const cashbill = cashbills.find(c => c.id === id);
            if (!cashbill) return;
            
            cashbill.status = 'draft';
            saveDataToStorage();
            updateCashbillHistory();
            
            showToast(`Cashbill ${id} has been uncommitted`, 'success');
        }

        // Request adjustment for cashbill
        function requestAdjustment(id) {
            const cashbill = cashbills.find(c => c.id === id);
            if (!cashbill) return;
            
            // In a real application, this would send a request to the admin
            showToast(`Adjustment request for cashbill ${id} has been submitted`, 'success');
        }

        // Print cashbill
        function printCashbill() {
            if (currentCashbillItems.length === 0) {
                showToast('Please add items to the cashbill before printing', 'error');
                return;
            }
            
            window.print();
        }

        // Download cashbill as PDF
        function downloadCashbill() {
            if (currentCashbillItems.length === 0) {
                showToast('Please add items to the cashbill before downloading', 'error');
                return;
            }
            
            // In a real application, this would generate and download a PDF
            showToast('Cashbill PDF download started', 'success');
        }

        // Save log entry
        function saveLogEntry(status) {
            const date = document.getElementById('logDate').value;
            const crew = document.getElementById('logCrew').value;
            const description = document.getElementById('logDescription').value;
            const price = parseFloat(document.getElementById('logPrice').value) || 0;
            
            if (!date || !crew || !description) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const logEntry = {
                id: `LOG-${Date.now()}`,
                date: date,
                crew: crew,
                description: description,
                price: price,
                status: status,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            logEntries.push(logEntry);
            saveDataToStorage();
            
            showToast(`Log entry saved as ${status}`, 'success');
            
            // Reset form
            document.getElementById('logDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('logCrew').value = '';
            document.getElementById('logDescription').value = '';
            document.getElementById('logPrice').value = '';
            
            // Update displays
            updateLogbookEntries();
            updateDashboard();
            
            // Switch to summary view
            document.getElementById('logbookFormContainer').style.display = 'none';
            document.getElementById('logbookSummaryContainer').style.display = 'block';
        }

        // Update logbook entries
        function updateLogbookEntries() {
            const tableBody = document.getElementById('logbookEntries');
            const totalCountElement = document.getElementById('logbookTotalCount');
            
            totalCountElement.textContent = logEntries.length;
            
            if (logEntries.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No log entries found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort log entries by date (newest first)
            const sortedLogEntries = [...logEntries].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedLogEntries.forEach(entry => {
                const row = document.createElement('tr');
                
                let actionButtons = `
                    <button class="btn btn-sm btn-secondary" onclick="viewLogEntry('${entry.id}')">
                        <i class="bi bi-eye"></i>
                    </button>
                `;
                
                if (currentUser.role === 'Admin') {
                    actionButtons += `
                        <button class="btn btn-sm btn-warning" onclick="uncommitLogEntry('${entry.id}')">
                            <i class="bi bi-arrow-counterclockwise"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteLogEntry('${entry.id}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    `;
                } else if (entry.status === 'committed') {
                    actionButtons += `
                        <button class="btn btn-sm btn-warning" onclick="requestLogAdjustment('${entry.id}')">
                            <i class="bi bi-exclamation-triangle"></i>
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td>${entry.date}</td>
                    <td>${entry.description}</td>
                    <td>${entry.crew}</td>
                    <td>${entry.price > 0 ? `RM ${entry.price.toFixed(2)}` : '-'}</td>
                    <td><span class="badge badge-${entry.status}">${entry.status}</span></td>
                    <td>${actionButtons}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // View log entry details
        function viewLogEntry(id) {
            const entry = logEntries.find(e => e.id === id);
            if (!entry) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing log entry ${id}`, 'success');
        }

        // Uncommit log entry (admin only)
        function uncommitLogEntry(id) {
            const entry = logEntries.find(e => e.id === id);
            if (!entry) return;
            
            entry.status = 'draft';
            saveDataToStorage();
            updateLogbookEntries();
            
            showToast(`Log entry ${id} has been uncommitted`, 'success');
        }

        // Delete log entry (admin only)
        function deleteLogEntry(id) {
            showConfirmation('Are you sure you want to delete this log entry?', function() {
                logEntries = logEntries.filter(e => e.id !== id);
                saveDataToStorage();
                updateLogbookEntries();
                updateDashboard();
                
                showToast('Log entry deleted successfully', 'success');
            });
        }

        // Request adjustment for log entry
        function requestLogAdjustment(id) {
            const entry = logEntries.find(e => e.id === id);
            if (!entry) return;
            
            // In a real application, this would send a request to the admin
            showToast(`Adjustment request for log entry ${id} has been submitted`, 'success');
        }

        // Add quotation service
        function addQuotationService() {
            const servicesContainer = document.getElementById('quotationServices');
            const serviceRow = document.createElement('div');
            serviceRow.className = 'row mb-2';
            serviceRow.innerHTML = `
                <div class="col-md-6">
                    <input type="text" class="form-control service-name" placeholder="Service Name" required>
                </div>
                <div class="col-md-4">
                    <input type="number" class="form-control service-price" placeholder="Price (RM)" step="0.01" min="0" required>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeQuotationService(this)">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;
            servicesContainer.appendChild(serviceRow);
            
            // Add event listener to the new price input
            serviceRow.querySelector('.service-price').addEventListener('input', calculateQuotationTotal);
        }

        // Remove quotation service
        function removeQuotationService(button) {
            button.closest('.row').remove();
            calculateQuotationTotal();
        }

        // Calculate quotation total
        function calculateQuotationTotal() {
            const priceInputs = document.querySelectorAll('.service-price');
            let total = 0;
            
            priceInputs.forEach(input => {
                const price = parseFloat(input.value) || 0;
                total += price;
            });
            
            document.getElementById('quotationTotal').value = total.toFixed(2);
        }

        // Save quotation
        function saveQuotation() {
            const quotationNumber = document.getElementById('quotationNumber').value;
            const date = document.getElementById('quotationDate').value;
            const clientName = document.getElementById('clientName').value;
            const clientEmail = document.getElementById('clientEmail').value;
            const clientPhone = document.getElementById('clientPhone').value;
            const clientCompany = document.getElementById('clientCompany').value;
            const notes = document.getElementById('quotationNotes').value;
            const template = document.getElementById('quotationTemplate').value;
            const totalAmount = parseFloat(document.getElementById('quotationTotal').value) || 0;
            
            if (!date || !clientName || !clientEmail || !clientPhone) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Collect services
            const services = [];
            const serviceNames = document.querySelectorAll('.service-name');
            const servicePrices = document.querySelectorAll('.service-price');
            
            for (let i = 0; i < serviceNames.length; i++) {
                const name = serviceNames[i].value.trim();
                const price = parseFloat(servicePrices[i].value) || 0;
                
                if (name && price > 0) {
                    services.push({
                        name: name,
                        price: price
                    });
                }
            }
            
            if (services.length === 0) {
                showToast('Please add at least one service', 'error');
                return;
            }
            
            const quotation = {
                id: quotationNumber,
                date: date,
                clientName: clientName,
                clientEmail: clientEmail,
                clientPhone: clientPhone,
                clientCompany: clientCompany,
                services: services,
                totalAmount: totalAmount,
                notes: notes,
                template: template,
                status: 'pending',
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            quotations.push(quotation);
            saveDataToStorage();
            
            showToast(`Quotation ${quotationNumber} saved successfully`, 'success');
            
            // Reset form
            resetQuotationForm();
            
            // Update counters and displays
            quotationCounter++;
            document.getElementById('quotationNumber').value = `QTN-${String(quotationCounter).padStart(4, '0')}`;
            updateQuotationHistory();
            
            // Switch to summary view
            document.getElementById('quotationFormContainer').style.display = 'none';
            document.getElementById('quotationSummaryContainer').style.display = 'block';
        }

        // Reset quotation form
        function resetQuotationForm() {
            document.getElementById('quotationDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('clientName').value = '';
            document.getElementById('clientEmail').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('clientCompany').value = '';
            document.getElementById('quotationNotes').value = '';
            document.getElementById('quotationTemplate').value = '';
            document.getElementById('quotationTotal').value = '';
            
            // Reset services
            const servicesContainer = document.getElementById('quotationServices');
            servicesContainer.innerHTML = `
                <div class="row mb-2">
                    <div class="col-md-6">
                        <input type="text" class="form-control service-name" placeholder="Service Name" required>
                    </div>
                    <div class="col-md-4">
                        <input type="number" class="form-control service-price" placeholder="Price (RM)" step="0.01" min="0" required>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeQuotationService(this)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listener to the price input
            servicesContainer.querySelector('.service-price').addEventListener('input', calculateQuotationTotal);
        }

        // Update quotation history
        function updateQuotationHistory() {
            const tableBody = document.getElementById('quotationHistory');
            const totalCountElement = document.getElementById('quotationTotalCount');
            
            totalCountElement.textContent = quotations.length;
            
            if (quotations.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No quotations found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort quotations by date (newest first)
            const sortedQuotations = [...quotations].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedQuotations.forEach(quotation => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${quotation.id}</td>
                    <td>${quotation.date}</td>
                    <td>${quotation.clientName}</td>
                    <td>RM ${quotation.totalAmount.toFixed(2)}</td>
                    <td><span class="badge badge-${quotation.status}">${quotation.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewQuotation('${quotation.id}')">
                            <i class="bi bi-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="downloadQuotationById('${quotation.id}')">
                            <i class="bi bi-download"></i>
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="emailQuotationById('${quotation.id}')">
                            <i class="bi bi-envelope"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // View quotation details
        function viewQuotation(id) {
            const quotation = quotations.find(q => q.id === id);
            if (!quotation) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing quotation ${id}`, 'success');
        }

        // Download quotation
        function downloadQuotation() {
            // In a real application, this would generate and download a PDF
            showToast('Quotation PDF download started', 'success');
        }

        // Download quotation by ID
        function downloadQuotationById(id) {
            const quotation = quotations.find(q => q.id === id);
            if (!quotation) return;
            
            // In a real application, this would generate and download a PDF
            showToast(`Quotation ${id} PDF download started`, 'success');
        }

        // Email quotation
        function emailQuotation() {
            const clientEmail = document.getElementById('clientEmail').value;
            
            if (!clientEmail) {
                showToast('Please enter a client email address', 'error');
                return;
            }
            
            // In a real application, this would send an email
            showToast(`Quotation email sent to ${clientEmail}`, 'success');
        }

        // Email quotation by ID
        function emailQuotationById(id) {
            const quotation = quotations.find(q => q.id === id);
            if (!quotation) return;
            
            // In a real application, this would send an email
            showToast(`Quotation ${id} email sent to ${quotation.clientEmail}`, 'success');
        }

        // Load schedule
        function loadSchedule() {
            const scheduleDate = document.getElementById('scheduleDate').value;
            if (!scheduleDate) {
                const today = new Date();
                document.getElementById('scheduleDate').value = today.toISOString().split('T')[0];
                loadSchedule();
                return;
            }
            
            // Show loading animation
            document.getElementById('scheduleLoadingContainer').style.display = 'block';
            document.getElementById('scheduleTableContainer').style.display = 'none';
            document.getElementById('noScheduleContainer').style.display = 'none';
            
            // Simulate loading delay
            setTimeout(() => {
                // Calculate the week dates
                const selectedDate = new Date(scheduleDate);
                const dayOfWeek = selectedDate.getDay(); // 0 = Sunday, 1 = Monday, etc.
                
                // Calculate the start of the week (Sunday)
                const startDate = new Date(selectedDate);
                startDate.setDate(selectedDate.getDate() - dayOfWeek);
                
                // Calculate the end of the week (Saturday)
                const endDate = new Date(startDate);
                endDate.setDate(startDate.getDate() + 6);
                
                // Update the date displays
                const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                
                for (let i = 0; i < 7; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    document.getElementById(`${days[i]}Date`).textContent = dateStr;
                }
                
                // Check if schedule exists for the selected week
                const scheduleExists = scheduleData.length > 0;
                
                if (scheduleExists) {
                    // Hide loading and no schedule messages
                    document.getElementById('scheduleLoadingContainer').style.display = 'none';
                    document.getElementById('noScheduleContainer').style.display = 'none';
                    document.getElementById('scheduleTableContainer').style.display = 'block';
                    
                    const scheduleTableBody = document.getElementById('scheduleTableBody');
                    scheduleTableBody.innerHTML = '';
                    
                    // Calculate day totals
                    const dayTotals = {
                        sunday: 0,
                        monday: 0,
                        tuesday: 0,
                        wednesday: 0,
                        thursday: 0,
                        friday: 0,
                        saturday: 0
                    };
                    
                    scheduleData.forEach(crew => {
                        const row = document.createElement('tr');
                        
                        let crewTotal = 0;
                        
                        // Create cells for each day
                        let dayCells = '';
                        
                        days.forEach(day => {
                            const dayData = crew[day];
                            let cellClass = 'schedule-cell';
                            let cellContent = '';
                            let editButton = '';
                            
                            if (dayData.status === 'off-day') {
                                cellClass += ' off-day';
                                cellContent = 'Off Day';
                            } else if (dayData.status === 'annual-leave') {
                                cellClass += ' annual-leave';
                                cellContent = 'Annual Leave';
                            } else if (dayData.status === 'working') {
                                cellClass += ' working';
                                cellContent = dayData.hours;
                                
                                // Calculate hours (simplified)
                                const hours = dayData.hours;
                                if (hours.includes('AM') && hours.includes('PM')) {
                                    const parts = hours.split(' - ');
                                    if (parts.length === 2) {
                                        const startPart = parts[0].trim();
                                        const endPart = parts[1].trim();
                                        
                                        let startHour = parseInt(startPart.split(':')[0]);
                                        const startAmPm = startPart.includes('AM') ? 'AM' : 'PM';
                                        
                                        let endHour = parseInt(endPart.split(':')[0]);
                                        const endAmPm = endPart.includes('AM') ? 'AM' : 'PM';
                                        
                                        // Convert to 24-hour format for calculation
                                        if (startAmPm === 'PM' && startHour !== 12) {
                                            startHour += 12;
                                        }
                                        if (endAmPm === 'PM' && endHour !== 12) {
                                            endHour += 12;
                                        }
                                        
                                        const hoursWorked = endHour - startHour;
                                        crewTotal += hoursWorked;
                                        dayTotals[day] += hoursWorked;
                                    }
                                }
                            }
                            
                            // Add edit button for admin or supervisor
                            if ((currentUser.role === 'Admin' || currentUser.role === 'Supervisor') && isEditMode) {
                                editButton = `<button class="edit-schedule-btn" onclick="editScheduleInline('${crew.crewId}', '${crew.crewName}', '${day}')">
                                    <i class="bi bi-pencil"></i>
                                </button>`;
                            }
                            
                            dayCells += `<td class="${cellClass}" data-crew-id="${crew.crewId}" data-day="${day}">${cellContent} ${editButton}</td>`;
                        });
                        
                        // Get crew role
                        const crewInfo = crews.find(c => c.id === crew.crewId);
                        const crewRole = crewInfo ? crewInfo.role : '';
                        
                        row.innerHTML = `
                            <td class="crew-name">
                                <div>${crew.crewName} (${crew.crewId})</div>
                                <div style="font-size: 12px; color: #7f8c8d;">${crewRole}</div>
                            </td>
                            ${dayCells}
                            <td class="total-hours">${crewTotal} hrs</td>
                        `;
                        
                        scheduleTableBody.appendChild(row);
                    });
                    
                    // Update day totals in footer
                    document.getElementById('sundayTotal').textContent = dayTotals.sunday + ' hrs';
                    document.getElementById('mondayTotal').textContent = dayTotals.monday + ' hrs';
                    document.getElementById('tuesdayTotal').textContent = dayTotals.tuesday + ' hrs';
                    document.getElementById('wednesdayTotal').textContent = dayTotals.wednesday + ' hrs';
                    document.getElementById('thursdayTotal').textContent = dayTotals.thursday + ' hrs';
                    document.getElementById('fridayTotal').textContent = dayTotals.friday + ' hrs';
                    document.getElementById('saturdayTotal').textContent = dayTotals.saturday + ' hrs';
                    
                    const weeklyTotal = Object.values(dayTotals).reduce((sum, hours) => sum + hours, 0);
                    document.getElementById('weeklyTotal').textContent = weeklyTotal + ' hrs';
                    
                    // If in edit mode, make cells editable
                    if (isEditMode) {
                        document.querySelectorAll('.schedule-cell').forEach(cell => {
                            cell.classList.add('editable');
                            cell.addEventListener('click', function() {
                                if (!this.classList.contains('editing')) {
                                    makeCellEditable(this);
                                }
                            });
                        });
                    }
                } else {
                    // Hide loading and table, show no schedule message
                    document.getElementById('scheduleLoadingContainer').style.display = 'none';
                    document.getElementById('scheduleTableContainer').style.display = 'none';
                    document.getElementById('noScheduleContainer').style.display = 'block';
                }
            }, 500); // Simulate loading time
        }

        // Set today's date in schedule
        function setTodaySchedule() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('scheduleDate').value = today;
            loadSchedule();
        }

        // Toggle edit mode
        function toggleEditMode() {
            if (currentUser.role !== 'Admin' && currentUser.role !== 'Supervisor') {
                showToast('Only Admin or Supervisor can edit schedules', 'error');
                return;
            }
            
            isEditMode = !isEditMode;
            
            const editBtn = document.getElementById('editScheduleBtn');
            const saveBtn = document.getElementById('saveScheduleChangesBtn');
            
            if (isEditMode) {
                editBtn.style.display = 'none';
                saveBtn.style.display = 'inline-block';
                showToast('Edit mode enabled. Click on a cell to edit.', 'success');
            } else {
                editBtn.style.display = 'inline-block';
                saveBtn.style.display = 'none';
                showToast('Edit mode disabled.', 'warning');
            }
            
            // Reload schedule to apply edit mode
            loadSchedule();
        }

        // Make cell editable
        function makeCellEditable(cell) {
            if (!isEditMode) return;
            
            const crewId = cell.getAttribute('data-crew-id');
            const day = cell.getAttribute('data-day');
            
            // Find the schedule data
            const crewIndex = scheduleData.findIndex(c => c.crewId === crewId);
            if (crewIndex === -1) return;
            
            const dayData = scheduleData[crewIndex][day];
            
            // Create edit form
            const statusSelect = document.createElement('select');
            statusSelect.className = 'status-select';
            statusSelect.innerHTML = `
                <option value="working" ${dayData.status === 'working' ? 'selected' : ''}>Working</option>
                <option value="off-day" ${dayData.status === 'off-day' ? 'selected' : ''}>Off Day</option>
                <option value="annual-leave" ${dayData.status === 'annual-leave' ? 'selected' : ''}>Annual Leave</option>
            `;
            
            const hoursInput = document.createElement('input');
            hoursInput.type = 'text';
            hoursInput.className = 'edit-input';
            hoursInput.placeholder = 'e.g., 9:00 AM - 5:00 PM';
            hoursInput.value = dayData.hours;
            
            // Clear cell content
            cell.innerHTML = '';
            cell.classList.add('editing');
            
            // Add elements to cell
            cell.appendChild(statusSelect);
            
            if (statusSelect.value === 'working') {
                cell.appendChild(hoursInput);
            }
            
            // Handle status change
            statusSelect.addEventListener('change', function() {
                if (this.value === 'working') {
                    if (!cell.contains(hoursInput)) {
                        cell.appendChild(hoursInput);
                    }
                } else {
                    if (cell.contains(hoursInput)) {
                        cell.removeChild(hoursInput);
                    }
                }
            });
            
            // Save on blur
            const saveCellEdit = function() {
                const newStatus = statusSelect.value;
                const newHours = hoursInput.value || '';
                
                // Update schedule data
                scheduleData[crewIndex][day] = {
                    status: newStatus,
                    hours: newHours
                };
                
                // Reload schedule to show changes
                loadSchedule();
            };
            
            hoursInput.addEventListener('blur', saveCellEdit);
            statusSelect.addEventListener('blur', saveCellEdit);
            
            // Focus on the status select
            statusSelect.focus();
        }

        // Create new schedule
        function createNewSchedule() {
            if (currentUser.role !== 'Admin') {
                showToast('Only admin can create new schedules', 'error');
                return;
            }
            
            // Show the schedule form
            document.getElementById('scheduleFormContainer').style.display = 'block';
            
            // Set the default week to next week
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('newScheduleWeek').value = nextWeek.toISOString().split('T')[0];
            
            // Generate crew checkboxes
            const crewSelector = document.getElementById('crewSelector');
            crewSelector.innerHTML = '';
            
            crews.forEach(crew => {
                const checkbox = document.createElement('div');
                checkbox.className = 'crew-checkbox';
                checkbox.innerHTML = `
                    <input type="checkbox" id="crew-${crew.id}" value="${crew.id}">
                    <label for="crew-${crew.id}">${crew.name} (${crew.id})</label>
                `;
                crewSelector.appendChild(checkbox);
            });
        }

        // Add crew to schedule
        function addCrewToSchedule() {
            const weekStart = document.getElementById('newScheduleWeek').value;
            if (!weekStart) {
                showToast('Please select a week', 'error');
                return;
            }
            
            // Get selected crew
            const selectedCrew = [];
            document.querySelectorAll('#crewSelector input:checked').forEach(checkbox => {
                const crewId = checkbox.value;
                const crew = crews.find(c => c.id === crewId);
                if (crew) {
                    selectedCrew.push(crew);
                }
            });
            
            if (selectedCrew.length === 0) {
                showToast('Please select at least one crew member', 'error');
                return;
            }
            
            // Add crew to schedule data
            selectedCrew.forEach(crew => {
                // Check if crew already exists in schedule data
                const existingCrew = scheduleData.find(s => s.crewId === crew.id);
                if (!existingCrew) {
                    scheduleData.push({
                        crewId: crew.id,
                        crewName: crew.name,
                        sunday: { status: 'off-day', hours: '' },
                        monday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                        tuesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                        wednesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                        thursday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                        friday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                        saturday: { status: 'off-day', hours: '' }
                    });
                }
            });
            
            // Hide the form and reload schedule
            document.getElementById('scheduleFormContainer').style.display = 'none';
            loadSchedule();
            
            showToast('Crew added to schedule successfully', 'success');
        }

        // Cancel new schedule
        function cancelNewSchedule() {
            document.getElementById('scheduleFormContainer').style.display = 'none';
        }

        // Save schedule
        function saveSchedule() {
            if (currentUser.role !== 'Admin') {
                showToast('Only admin can save schedules', 'error');
                return;
            }
            
            saveDataToStorage();
            showToast('Schedule saved successfully', 'success');
        }

        // Save schedule changes
        function saveScheduleChanges() {
            if (currentUser.role !== 'Admin' && currentUser.role !== 'Supervisor') {
                showToast('Only Admin or Supervisor can save schedule changes', 'error');
                return;
            }
            
            saveDataToStorage();
            toggleEditMode();
            showToast('Schedule changes saved successfully', 'success');
        }

        // Edit schedule
        function editSchedule(crewId, crewName, day, status, hours) {
            currentScheduleEdit = {
                crewId: crewId,
                crewName: crewName,
                day: day,
                status: status,
                hours: hours
            };
            
            document.getElementById('editCrewName').value = crewName;
            document.getElementById('editDay').value = day.charAt(0).toUpperCase() + day.slice(1);
            document.getElementById('editStatus').value = status;
            document.getElementById('editHours').value = hours;
            
            // Show/hide hours field based on status
            const hoursGroup = document.getElementById('editHoursGroup');
            if (status === 'working') {
                hoursGroup.style.display = 'block';
            } else {
                hoursGroup.style.display = 'none';
            }
            
            // Show modal
            document.getElementById('scheduleEditModal').classList.add('active');
        }

        // Edit schedule inline
        function editScheduleInline(crewId, crewName, day) {
            if (!isEditMode) return;
            
            const crewIndex = scheduleData.findIndex(c => c.crewId === crewId);
            if (crewIndex === -1) return;
            
            const dayData = scheduleData[crewIndex][day];
            
            currentScheduleEdit = {
                crewId: crewId,
                crewName: crewName,
                day: day,
                status: dayData.status,
                hours: dayData.hours
            };
            
            document.getElementById('editCrewName').value = crewName;
            document.getElementById('editDay').value = day.charAt(0).toUpperCase() + day.slice(1);
            document.getElementById('editStatus').value = dayData.status;
            document.getElementById('editHours').value = dayData.hours;
            
            // Show/hide hours field based on status
            const hoursGroup = document.getElementById('editHoursGroup');
            if (dayData.status === 'working') {
                hoursGroup.style.display = 'block';
            } else {
                hoursGroup.style.display = 'none';
            }
            
            // Show modal
            document.getElementById('scheduleEditModal').classList.add('active');
        }

        // Save schedule edit
        function saveScheduleEdit() {
            const crewId = currentScheduleEdit.crewId;
            const day = currentScheduleEdit.day;
            const status = document.getElementById('editStatus').value;
            const hours = document.getElementById('editHours').value;
            
            // Find and update the schedule data
            const crewIndex = scheduleData.findIndex(c => c.crewId === crewId);
            if (crewIndex !== -1) {
                scheduleData[crewIndex][day] = {
                    status: status,
                    hours: status === 'working' ? hours : ''
                };
                
                saveDataToStorage();
                loadSchedule();
                closeModal('scheduleEditModal');
                
                showToast('Schedule updated successfully', 'success');
            }
        }

        // Add order item
        function addOrderItem() {
            const itemsContainer = document.getElementById('orderItems');
            const itemRow = document.createElement('div');
            itemRow.className = 'row mb-2';
            itemRow.innerHTML = `
                <div class="col-md-6">
                    <input type="text" class="form-control order-item-name" placeholder="Item Name" required>
                </div>
                <div class="col-md-4">
                    <input type="number" class="form-control order-item-price" placeholder="Price (RM)" step="0.01" min="0" required>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeOrderItem(this)">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;
            itemsContainer.appendChild(itemRow);
            
            // Add event listener to the new price input
            itemRow.querySelector('.order-item-price').addEventListener('input', calculateOrderTotal);
        }

        // Remove order item
        function removeOrderItem(button) {
            button.closest('.row').remove();
            calculateOrderTotal();
        }

        // Calculate order total
        function calculateOrderTotal() {
            const priceInputs = document.querySelectorAll('.order-item-price');
            let total = 0;
            
            priceInputs.forEach(input => {
                const price = parseFloat(input.value) || 0;
                total += price;
            });
            
            document.getElementById('orderTotal').value = total.toFixed(2);
        }

        // Save online order
        function saveOnlineOrder() {
            const orderId = document.getElementById('orderId').value;
            const date = document.getElementById('orderDate').value;
            const customerName = document.getElementById('orderCustomerName').value;
            const customerEmail = document.getElementById('orderCustomerEmail').value;
            const customerPhone = document.getElementById('orderCustomerPhone').value;
            const outlet = document.getElementById('orderOutlet').value;
            const notes = document.getElementById('orderNotes').value;
            const totalAmount = parseFloat(document.getElementById('orderTotal').value) || 0;
            
            if (!date || !customerName || !customerEmail || !customerPhone || !outlet) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Collect order items
            const items = [];
            const itemNames = document.querySelectorAll('.order-item-name');
            const itemPrices = document.querySelectorAll('.order-item-price');
            
            for (let i = 0; i < itemNames.length; i++) {
                const name = itemNames[i].value.trim();
                const price = parseFloat(itemPrices[i].value) || 0;
                
                if (name && price > 0) {
                    items.push({
                        name: name,
                        price: price
                    });
                }
            }
            
            if (items.length === 0) {
                showToast('Please add at least one item', 'error');
                return;
            }
            
            const order = {
                id: orderId,
                date: date,
                customerName: customerName,
                customerEmail: customerEmail,
                customerPhone: customerPhone,
                outlet: outlet,
                items: items,
                totalAmount: totalAmount,
                notes: notes,
                status: 'pending',
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            onlineOrders.push(order);
            saveDataToStorage();
            
            showToast(`Order ${orderId} saved successfully`, 'success');
            
            // Reset form
            resetOrderForm();
            
            // Update counters and displays
            orderCounter++;
            document.getElementById('orderId').value = `ORD-${String(orderCounter).padStart(4, '0')}`;
            updateOnlineOrders();
            updateDashboard();
            
            // Switch to summary view
            document.getElementById('adminOrderSection').style.display = 'none';
            document.getElementById('onlineOrderSummaryContainer').style.display = 'block';
        }

        // Reset order form
        function resetOrderForm() {
            document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('orderCustomerName').value = '';
            document.getElementById('orderCustomerEmail').value = '';
            document.getElementById('orderCustomerPhone').value = '';
            document.getElementById('orderOutlet').value = '';
            document.getElementById('orderNotes').value = '';
            document.getElementById('orderTotal').value = '';
            
            // Reset order items
            const itemsContainer = document.getElementById('orderItems');
            itemsContainer.innerHTML = `
                <div class="row mb-2">
                    <div class="col-md-6">
                        <input type="text" class="form-control order-item-name" placeholder="Item Name" required>
                    </div>
                    <div class="col-md-4">
                        <input type="number" class="form-control order-item-price" placeholder="Price (RM)" step="0.01" min="0" required>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeOrderItem(this)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listener to the price input
            itemsContainer.querySelector('.order-item-price').addEventListener('input', calculateOrderTotal);
        }

        // Update online orders
        function updateOnlineOrders() {
            const tableBody = document.getElementById('onlineOrders');
            const totalCountElement = document.getElementById('onlineOrderTotalCount');
            
            totalCountElement.textContent = onlineOrders.length;
            
            if (onlineOrders.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">No orders found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort orders by date (newest first)
            const sortedOrders = [...onlineOrders].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedOrders.forEach(order => {
                const row = document.createElement('tr');
                
                let actionButtons = `
                    <button class="btn btn-sm btn-secondary" onclick="viewOrder('${order.id}')">
                        <i class="bi bi-eye"></i>
                    </button>
                `;
                
                if (currentUser.role === 'Admin') {
                    actionButtons += `
                        <button class="btn btn-sm btn-danger" onclick="deleteOrder('${order.id}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    `;
                } else if (order.status === 'pending') {
                    actionButtons += `
                        <button class="btn btn-sm btn-success" onclick="fulfillOrder('${order.id}')">
                            <i class="bi bi-check-circle"></i>
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="createCashbillFromOrder('${order.id}')">
                            <i class="bi bi-receipt"></i>
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.date}</td>
                    <td>${order.customerName}</td>
                    <td>RM ${order.totalAmount.toFixed(2)}</td>
                    <td>${order.outlet}</td>
                    <td><span class="badge badge-${order.status}">${order.status}</span></td>
                    <td>${actionButtons}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // View order details
        function viewOrder(id) {
            const order = onlineOrders.find(o => o.id === id);
            if (!order) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing order ${id}`, 'success');
        }

        // Delete order (admin only)
        function deleteOrder(id) {
            showConfirmation('Are you sure you want to delete this order?', function() {
                onlineOrders = onlineOrders.filter(o => o.id !== id);
                saveDataToStorage();
                updateOnlineOrders();
                updateDashboard();
                
                showToast('Order deleted successfully', 'success');
            });
        }

        // Fulfill order
        function fulfillOrder(id) {
            const order = onlineOrders.find(o => o.id === id);
            if (!order) return;
            
            order.status = 'fulfilled';
            saveDataToStorage();
            updateOnlineOrders();
            updateDashboard();
            
            showToast(`Order ${id} has been fulfilled`, 'success');
        }

        // Create cashbill from order
        function createCashbillFromOrder(id) {
            const order = onlineOrders.find(o => o.id === id);
            if (!order) return;
            
            // Switch to cashbill page
            showPage('cashbill');
            
            // Show cashbill form
            document.getElementById('cashbillFormContainer').style.display = 'block';
            document.getElementById('cashbillSummaryContainer').style.display = 'none';
            
            // Pre-fill cashbill form with order details
            document.getElementById('customerName').value = order.customerName;
            document.getElementById('customerPhone').value = order.customerPhone;
            document.getElementById('cashbillOutlet').value = order.outlet;
            
            // Add order items to cashbill
            currentCashbillItems = order.items.map(item => ({
                name: item.name,
                quantity: 1,
                price: item.price,
                total: item.price
            }));
            
            updateCashbillItemsTable();
            
            showToast(`Cashbill form pre-filled with order ${id} details`, 'success');
        }

        // Save crew
        function saveCrew() {
            const name = document.getElementById('crewName').value;
            const id = document.getElementById('crewId').value;
            const position = document.getElementById('crewPosition').value;
            const role = document.getElementById('crewRole').value;
            const outlet = document.getElementById('crewOutlet').value;
            
            if (!name || !id || !position || !role || !outlet) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            // Check if crew ID already exists
            const existingCrewIndex = crews.findIndex(c => c.id === id);
            
            if (existingCrewIndex !== -1) {
                // Update existing crew
                crews[existingCrewIndex] = {
                    id: id,
                    name: name,
                    position: position,
                    role: role,
                    outlet: outlet
                };
                
                showToast(`Crew ${name} updated successfully`, 'success');
            } else {
                // Add new crew
                crews.push({
                    id: id,
                    name: name,
                    position: position,
                    role: role,
                    outlet: outlet
                });
                
                // Add to schedule data
                scheduleData.push({
                    crewId: id,
                    crewName: name,
                    sunday: { status: 'off-day', hours: '' },
                    monday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                    tuesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                    wednesday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                    thursday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                    friday: { status: 'working', hours: '9:00 AM - 5:00 PM' },
                    saturday: { status: 'off-day', hours: '' }
                });
                
                showToast(`Crew ${name} added successfully`, 'success');
            }
            
            saveDataToStorage();
            resetCrewForm();
            updateCrewList();
            loadSchedule();
        }

        // Reset crew form
        function resetCrewForm() {
            document.getElementById('crewName').value = '';
            document.getElementById('crewId').value = '';
            document.getElementById('crewPosition').value = '';
            document.getElementById('crewRole').value = '';
            document.getElementById('crewOutlet').value = '';
        }

        // Update crew list
        function updateCrewList() {
            const tableBody = document.getElementById('crewList');
            
            if (crews.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No crew members found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort crews by ID
            const sortedCrews = [...crews].sort((a, b) => a.id.localeCompare(b.id));
            
            sortedCrews.forEach(crew => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${crew.id}</td>
                    <td>${crew.name}</td>
                    <td>${crew.position}</td>
                    <td>${crew.role}</td>
                    <td>${crew.outlet}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editCrew('${crew.id}')">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCrew('${crew.id}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Edit crew
        function editCrew(id) {
            const crew = crews.find(c => c.id === id);
            if (!crew) return;
            
            document.getElementById('crewName').value = crew.name;
            document.getElementById('crewId').value = crew.id;
            document.getElementById('crewPosition').value = crew.position;
            document.getElementById('crewRole').value = crew.role;
            document.getElementById('crewOutlet').value = crew.outlet;
        }

        // Delete crew
        function deleteCrew(id) {
            showConfirmation('Are you sure you want to delete this crew member?', function() {
                crews = crews.filter(c => c.id !== id);
                scheduleData = scheduleData.filter(s => s.crewId !== id);
                saveDataToStorage();
                updateCrewList();
                loadSchedule();
                
                showToast('Crew member deleted successfully', 'success');
            });
        }

        // Save stock
        function saveStock() {
            const itemName = document.getElementById('stockItemName').value;
            const sku = document.getElementById('stockSku').value;
            const category = document.getElementById('stockCategory').value;
            const price = parseFloat(document.getElementById('stockPrice').value) || 0;
            const quantity = parseInt(document.getElementById('stockQuantity').value) || 0;
            const outlet = document.getElementById('stockOutlet').value;
            const description = document.getElementById('stockDescription').value;
            
            if (!itemName || !sku || !category || price <= 0 || quantity < 0 || !outlet) {
                showToast('Please fill in all required fields with valid values', 'error');
                return;
            }
            
            // Check if SKU already exists
            const existingStockIndex = stockItems.findIndex(s => s.sku === sku);
            
            if (existingStockIndex !== -1) {
                // Update existing stock item
                stockItems[existingStockIndex] = {
                    sku: sku,
                    name: itemName,
                    category: category,
                    price: price,
                    quantity: quantity,
                    outlet: outlet,
                    description: description
                };
                
                showToast(`Stock item ${itemName} updated successfully`, 'success');
            } else {
                // Add new stock item
                stockItems.push({
                    sku: sku,
                    name: itemName,
                    category: category,
                    price: price,
                    quantity: quantity,
                    outlet: outlet,
                    description: description
                });
                
                showToast(`Stock item ${itemName} added successfully`, 'success');
            }
            
            saveDataToStorage();
            resetStockForm();
            updateStockList();
            populateStockItemsDropdown();
        }

        // Reset stock form
        function resetStockForm() {
            document.getElementById('stockItemName').value = '';
            document.getElementById('stockSku').value = '';
            document.getElementById('stockCategory').value = '';
            document.getElementById('stockPrice').value = '';
            document.getElementById('stockQuantity').value = '';
            document.getElementById('stockOutlet').value = '';
            document.getElementById('stockDescription').value = '';
        }

        // Update stock list
        function updateStockList() {
            const tableBody = document.getElementById('stockList');
            
            if (stockItems.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">No stock items found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort stock items by SKU
            const sortedStockItems = [...stockItems].sort((a, b) => a.sku.localeCompare(b.sku));
            
            sortedStockItems.forEach(item => {
                const row = document.createElement('tr');
                
                let actionButtons = '';
                if (currentUser.role === 'Admin') {
                    actionButtons = `
                        <button class="btn btn-sm btn-primary" onclick="editStock('${item.sku}')">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteStock('${item.sku}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td>${item.sku}</td>
                    <td>${item.name}</td>
                    <td>${item.category}</td>
                    <td>RM ${item.price.toFixed(2)}</td>
                    <td>${item.quantity}</td>
                    <td>${item.outlet}</td>
                    <td>${actionButtons}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Edit stock
        function editStock(sku) {
            const stock = stockItems.find(s => s.sku === sku);
            if (!stock) return;
            
            document.getElementById('stockItemName').value = stock.name;
            document.getElementById('stockSku').value = stock.sku;
            document.getElementById('stockCategory').value = stock.category;
            document.getElementById('stockPrice').value = stock.price;
            document.getElementById('stockQuantity').value = stock.quantity;
            document.getElementById('stockOutlet').value = stock.outlet;
            document.getElementById('stockDescription').value = stock.description;
        }

        // Delete stock
        function deleteStock(sku) {
            showConfirmation('Are you sure you want to delete this stock item?', function() {
                stockItems = stockItems.filter(s => s.sku !== sku);
                saveDataToStorage();
                updateStockList();
                populateStockItemsDropdown();
                
                showToast('Stock item deleted successfully', 'success');
            });
        }

        // Time tracking functions
        function punchIn() {
            // Check if user is scheduled today
            const today = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            const todayDay = days[today];
            
            const crewSchedule = scheduleData.find(s => s.crewId === currentUser.id);
            if (!crewSchedule || crewSchedule[todayDay].status !== 'working') {
                showToast('You are not scheduled to work today', 'error');
                return;
            }
            
            // Record punch in time
            const now = new Date();
            const timeRecord = {
                id: Date.now(),
                crewId: currentUser.id,
                action: 'punch-in',
                time: now.toISOString(),
                date: now.toISOString().split('T')[0]
            };
            
            timeRecords.push(timeRecord);
            saveDataToStorage();
            
            // Update UI
            currentTimeStatus = 'in';
            updateTimeStatus();
            loadTimeRecords();
            
            showToast('Punched in successfully', 'success');
        }

        function takeBreak() {
            if (currentTimeStatus !== 'in') {
                showToast('You need to be punched in to take a break', 'error');
                return;
            }
            
            // Record break time
            const now = new Date();
            const timeRecord = {
                id: Date.now(),
                crewId: currentUser.id,
                action: 'break',
                time: now.toISOString(),
                date: now.toISOString().split('T')[0]
            };
            
            timeRecords.push(timeRecord);
            saveDataToStorage();
            
            // Update UI
            currentTimeStatus = 'break';
            updateTimeStatus();
            loadTimeRecords();
            
            showToast('Break started', 'success');
        }

        function punchOut() {
            if (currentTimeStatus === 'out') {
                showToast('You are not punched in', 'error');
                return;
            }
            
            // Record punch out time
            const now = new Date();
            const timeRecord = {
                id: Date.now(),
                crewId: currentUser.id,
                action: 'punch-out',
                time: now.toISOString(),
                date: now.toISOString().split('T')[0]
            };
            
            timeRecords.push(timeRecord);
            saveDataToStorage();
            
            // Update UI
            currentTimeStatus = 'out';
            updateTimeStatus();
            loadTimeRecords();
            
            showToast('Punched out successfully', 'success');
        }

        function updateTimeStatus() {
            const statusElement = document.getElementById('timeStatus');
            const punchInBtn = document.getElementById('punchInBtn');
            const breakBtn = document.getElementById('breakBtn');
            const punchOutBtn = document.getElementById('punchOutBtn');
            
            if (currentTimeStatus === 'in') {
                statusElement.textContent = 'You are punched in';
                punchInBtn.disabled = true;
                breakBtn.disabled = false;
                punchOutBtn.disabled = false;
            } else if (currentTimeStatus === 'break') {
                statusElement.textContent = 'You are on break';
                punchInBtn.disabled = true;
                breakBtn.disabled = true;
                punchOutBtn.disabled = false;
            } else {
                statusElement.textContent = 'You are not punched in';
                punchInBtn.disabled = false;
                breakBtn.disabled = true;
                punchOutBtn.disabled = true;
            }
        }

        function loadTimeRecords() {
            const tableBody = document.getElementById('timeRecordTable');
            const today = new Date().toISOString().split('T')[0];
            
            // Get today's records for current user
            const todayRecords = timeRecords.filter(r => 
                r.date === today && r.crewId === currentUser.id
            );
            
            if (todayRecords.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="3" class="text-center">No time records for today</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort records by time
            const sortedRecords = [...todayRecords].sort((a, b) => new Date(a.time) - new Date(b.time));
            
            // Calculate durations
            for (let i = 0; i < sortedRecords.length; i++) {
                const record = sortedRecords[i];
                let duration = '';
                
                if (i > 0 && record.action === 'punch-out' && sortedRecords[i-1].action === 'punch-in') {
                    const startTime = new Date(sortedRecords[i-1].time);
                    const endTime = new Date(record.time);
                    const diffMs = endTime - startTime;
                    const diffHrs = Math.floor(diffMs / 3600000);
                    const diffMins = Math.floor((diffMs % 3600000) / 60000);
                    duration = `${diffHrs}h ${diffMins}m`;
                } else if (i > 0 && record.action === 'break' && sortedRecords[i-1].action === 'punch-in') {
                    const startTime = new Date(sortedRecords[i-1].time);
                    const endTime = new Date(record.time);
                    const diffMs = endTime - startTime;
                    const diffHrs = Math.floor(diffMs / 3600000);
                    const diffMins = Math.floor((diffMs % 3600000) / 60000);
                    duration = `${diffHrs}h ${diffMins}m`;
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.action.replace('-', ' ').toUpperCase()}</td>
                    <td>${new Date(record.time).toLocaleTimeString()}</td>
                    <td>${duration}</td>
                `;
                tableBody.appendChild(row);
            }
            
            // Update current status based on last record
            if (sortedRecords.length > 0) {
                const lastRecord = sortedRecords[sortedRecords.length - 1];
                if (lastRecord.action === 'punch-in') {
                    currentTimeStatus = 'in';
                } else if (lastRecord.action === 'break') {
                    currentTimeStatus = 'break';
                } else {
                    currentTimeStatus = 'out';
                }
                updateTimeStatus();
            }
        }

        // Update dashboard
        function updateDashboard() {
            // Update dashboard cards
            document.getElementById('totalCashbills').textContent = cashbills.length;
            
            const totalRevenue = cashbills.reduce((sum, cashbill) => sum + cashbill.totalAmount, 0);
            document.getElementById('totalRevenue').textContent = `RM ${totalRevenue.toFixed(2)}`;
            
            document.getElementById('totalLogEntries').textContent = logEntries.length;
            
            const pendingOrdersCount = onlineOrders.filter(order => order.status === 'pending').length;
            document.getElementById('pendingOrders').textContent = pendingOrdersCount;
            
            // Update recent cashbills
            const recentCashbillsTable = document.getElementById('recentCashbills');
            recentCashbillsTable.innerHTML = '';
            
            if (cashbills.length === 0) {
                recentCashbillsTable.innerHTML = '<tr><td colspan="5" class="text-center">No cashbills found</td></tr>';
            } else {
                // Sort cashbills by date (newest first) and take the first 5
                const recentCashbills = [...cashbills]
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 5);
                
                recentCashbills.forEach(cashbill => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${cashbill.id}</td>
                        <td>${cashbill.customerName}</td>
                        <td>${cashbill.date}</td>
                        <td>RM ${cashbill.totalAmount.toFixed(2)}</td>
                        <td><span class="badge badge-${cashbill.status}">${cashbill.status}</span></td>
                    `;
                    recentCashbillsTable.appendChild(row);
                });
            }
            
            // Update recent log entries
            const recentLogEntriesTable = document.getElementById('recentLogEntries');
            recentLogEntriesTable.innerHTML = '';
            
            if (logEntries.length === 0) {
                recentLogEntriesTable.innerHTML = '<tr><td colspan="4" class="text-center">No log entries found</td></tr>';
            } else {
                // Sort log entries by date (newest first) and take the first 5
                const recentLogEntries = [...logEntries]
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 5);
                
                recentLogEntries.forEach(entry => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${entry.date}</td>
                        <td>${entry.description.length > 50 ? entry.description.substring(0, 50) + '...' : entry.description}</td>
                        <td>${entry.crew}</td>
                        <td><span class="badge badge-${entry.status}">${entry.status}</span></td>
                    `;
                    recentLogEntriesTable.appendChild(row);
                });
            }
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            let icon = '';
            if (type === 'success') {
                icon = '<i class="bi bi-check-circle-fill toast-icon"></i>';
            } else if (type === 'error') {
                icon = '<i class="bi bi-x-circle-fill toast-icon"></i>';
            } else if (type === 'warning') {
                icon = '<i class="bi bi-exclamation-triangle-fill toast-icon"></i>';
            }
            
            toast.innerHTML = `
                ${icon}
                <div>${message}</div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove toast after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Show confirmation modal
        function showConfirmation(message, callback) {
            const modal = document.getElementById('confirmationModal');
            const messageElement = document.getElementById('confirmationMessage');
            const confirmButton = document.getElementById('confirmButton');
            
            messageElement.textContent = message;
            modal.classList.add('active');
            
            // Set up confirmation button
            confirmButton.onclick = function() {
                callback();
                closeModal('confirmationModal');
            };
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Save data to localStorage
        function saveDataToStorage() {
            localStorage.setItem('pneArenaData', JSON.stringify({
                cashbills: cashbills,
                logEntries: logEntries,
                quotations: quotations,
                onlineOrders: onlineOrders,
                crews: crews,
                stockItems: stockItems,
                scheduleData: scheduleData,
                timeRecords: timeRecords,
                invoiceCounter: invoiceCounter,
                orderCounter: orderCounter,
                quotationCounter: quotationCounter
            }));
        }

        // Load data from localStorage
        function loadDataFromStorage() {
            const savedData = localStorage.getItem('pneArenaData');
            
            if (savedData) {
                const data = JSON.parse(savedData);
                
                if (data.cashbills) cashbills = data.cashbills;
                if (data.logEntries) logEntries = data.logEntries;
                if (data.quotations) quotations = data.quotations;
                if (data.onlineOrders) onlineOrders = data.onlineOrders;
                if (data.crews) crews = data.crews;
                if (data.stockItems) stockItems = data.stockItems;
                if (data.scheduleData) scheduleData = data.scheduleData;
                if (data.timeRecords) timeRecords = data.timeRecords;
                if (data.invoiceCounter) invoiceCounter = data.invoiceCounter;
                if (data.orderCounter) orderCounter = data.orderCounter;
                if (data.quotationCounter) quotationCounter = data.quotationCounter;
            }
        }
    </script>
</body>
</html>
