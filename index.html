<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNE ARENA - Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --sidebar-width: 250px;
            --sidebar-collapsed-width: 0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            overflow-x: hidden;
        }

        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .login-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 40px;
            width: 100%;
            max-width: 400px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header .logo {
            font-size: 36px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .login-header .tagline {
            color: #7f8c8d;
            font-size: 14px;
        }

        /* Main App (hidden by default) */
        .main-app {
            display: none;
        }

        /* Top Navigation Bar */
        .top-navbar {
            background-color: white;
            color: var(--dark-color);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 60px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            color: var(--primary-color);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-role {
            background-color: var(--light-color);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            color: var(--dark-color);
        }

        .logout-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .logout-btn:hover {
            background-color: #c0392b;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: var(--sidebar-width);
            height: calc(100vh - 60px);
            background-color: white;
            color: var(--dark-color);
            transition: width 0.3s ease;
            overflow-x: hidden;
            z-index: 999;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar-toggle {
            position: absolute;
            top: 15px;
            right: 10px;
            background: var(--primary-color);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .sidebar.collapsed .sidebar-toggle {
            right: -40px;
            top: 15px;
        }

        .sidebar-menu {
            margin-top: 50px;
            list-style: none;
            padding-left: 0;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--dark-color);
            text-decoration: none;
            transition: background-color 0.3s;
            white-space: nowrap;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: var(--light-color);
            color: var(--primary-color);
        }

        .sidebar-menu i {
            margin-right: 10px;
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        .sidebar.collapsed .sidebar-menu span {
            display: none;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: 60px;
            padding: 20px;
            transition: margin-left 0.3s ease;
            min-height: calc(100vh - 60px);
        }

        .main-content.expanded {
            margin-left: var(--sidebar-collapsed-width);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Dashboard */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-icon {
            font-size: 30px;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .card-value {
            font-size: 24px;
            font-weight: bold;
        }

        /* Forms */
        .form-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .form-control, .form-select {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px 12px;
            width: 100%;
            transition: border-color 0.3s;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        /* Tables */
        .table-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .table tr:hover {
            background-color: #f8f9fa;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #e67e22;
        }

        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        .btn-outline-primary {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-outline-primary:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Status badges */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-draft {
            background-color: #f39c12;
            color: white;
        }

        .badge-committed {
            background-color: var(--success-color);
            color: white;
        }

        .badge-pending {
            background-color: var(--primary-color);
            color: white;
        }

        .badge-fulfilled {
            background-color: var(--success-color);
            color: white;
        }

        /* Schedule Timetable */
        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .schedule-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
        }

        .schedule-table th, .schedule-table td {
            border: 1px solid #eee;
            padding: 12px;
            text-align: center;
        }

        .schedule-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .schedule-table .time-column {
            width: 100px;
            background-color: #f8f9fa;
            font-weight: 600;
        }

        .schedule-cell {
            min-height: 60px;
            position: relative;
        }

        .schedule-cell.has-shift {
            background-color: rgba(52, 152, 219, 0.1);
        }

        .shift-details {
            font-size: 12px;
            padding: 5px;
            border-radius: 4px;
            background-color: rgba(52, 152, 219, 0.2);
            margin-bottom: 5px;
        }

        .shift-crew {
            font-weight: 600;
            color: var(--primary-color);
        }

        .add-shift-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .schedule-cell:hover .add-shift-btn {
            opacity: 1;
        }

        /* Crew Schedule */
        .crew-schedule {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .crew-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 15px;
        }

        .crew-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .crew-name {
            font-weight: bold;
            font-size: 16px;
        }

        .crew-id {
            color: #7f8c8d;
            font-size: 14px;
        }

        .crew-position {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .crew-outlet {
            background-color: #f8f9fa;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
            display: inline-block;
        }

        /* Time Tracking */
        .time-tracking-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            margin-bottom: 20px;
        }

        .time-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #e74c3c;
        }

        .status-dot.active {
            background-color: var(--success-color);
        }

        .status-dot.break {
            background-color: var(--warning-color);
        }

        .time-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .schedule-today {
            margin-top: 20px;
        }

        .schedule-today h5 {
            margin-bottom: 15px;
        }

        .today-shift {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 3000;
        }

        .toast {
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            min-width: 250px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-success {
            border-left: 4px solid var(--success-color);
        }

        .toast-error {
            border-left: 4px solid var(--danger-color);
        }

        .toast-warning {
            border-left: 4px solid var(--warning-color);
        }

        .toast-icon {
            margin-right: 10px;
            font-size: 20px;
        }

        .toast-success .toast-icon {
            color: var(--success-color);
        }

        .toast-error .toast-icon {
            color: var(--danger-color);
        }

        .toast-warning .toast-icon {
            color: var(--warning-color);
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Print Styles */
        @media print {
            .top-navbar, .sidebar, .btn, .modal, .toast-container {
                display: none !important;
            }
            
            .main-content {
                margin-left: 0 !important;
                margin-top: 0 !important;
                padding: 0 !important;
            }
            
            .page {
                display: block !important;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: var(--sidebar-collapsed-width);
            }
            
            .sidebar .sidebar-menu span {
                display: none;
            }
            
            .main-content {
                margin-left: var(--sidebar-collapsed-width);
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .schedule-table {
                font-size: 12px;
            }
            
            .schedule-table th, .schedule-table td {
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-card">
            <div class="login-header">
                <div class="logo">PNE ARENA</div>
                <div class="tagline">Management System</div>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">User ID</label>
                    <input type="text" class="form-control" id="loginUserId" placeholder="Enter your ID" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required>
                </div>
                <button type="button" class="btn btn-primary w-100" onclick="login()">Login</button>
            </form>
        </div>
    </div>

    <!-- Main Application (hidden by default) -->
    <div class="main-app" id="mainApp">
        <!-- Top Navigation Bar -->
        <div class="top-navbar">
            <div class="logo">
                <i class="bi bi-building"></i> PNE ARENA
            </div>
            <div class="user-info">
                <div class="user-role" id="userRole">Admin</div>
                <button class="logout-btn" onclick="logout()">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </button>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="bi bi-chevron-left"></i>
            </button>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" onclick="showPage('dashboard')"><i class="bi bi-speedometer2"></i> <span>Dashboard</span></a></li>
                <li><a href="#" onclick="showPage('cashbill')"><i class="bi bi-receipt"></i> <span>Cashbill</span></a></li>
                <li><a href="#" onclick="showPage('logbook')"><i class="bi bi-journal-text"></i> <span>Logbook</span></a></li>
                <li><a href="#" onclick="showPage('quotation')"><i class="bi bi-file-earmark-text"></i> <span>Quotation</span></a></li>
                <li><a href="#" onclick="showPage('schedule')"><i class="bi bi-calendar3"></i> <span>Schedule Timetable</span></a></li>
                <li><a href="#" onclick="showPage('onlineOrder')"><i class="bi bi-cart3"></i> <span>Online Order</span></a></li>
                <li><a href="#" onclick="showPage('crewManagement')" id="crewManagementLink" style="display: none;"><i class="bi bi-people"></i> <span>Crew Management</span></a></li>
                <li><a href="#" onclick="showPage('stockManagement')"><i class="bi bi-box-seam"></i> <span>Stock Management</span></a></li>
                <li><a href="#" onclick="showPage('timeTracking')"><i class="bi bi-clock-history"></i> <span>Time Tracking</span></a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboard">
                <h2 class="mb-4">Dashboard</h2>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-icon text-primary">
                            <i class="bi bi-receipt"></i>
                        </div>
                        <div class="card-title">Total Cashbills</div>
                        <div class="card-value" id="totalCashbills">0</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon text-success">
                            <i class="bi bi-cash-stack"></i>
                        </div>
                        <div class="card-title">Total Revenue</div>
                        <div class="card-value" id="totalRevenue">RM 0.00</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon text-info">
                            <i class="bi bi-journal-text"></i>
                        </div>
                        <div class="card-title">Log Entries</div>
                        <div class="card-value" id="totalLogEntries">0</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-icon text-warning">
                            <i class="bi bi-cart3"></i>
                        </div>
                        <div class="card-title">Pending Orders</div>
                        <div class="card-value" id="pendingOrders">0</div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="table-container">
                            <h4 class="mb-3">Recent Cashbills</h4>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Invoice #</th>
                                        <th>Customer</th>
                                        <th>Date</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentCashbills">
                                    <tr>
                                        <td colspan="5" class="text-center">No cashbills found</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="table-container">
                            <h4 class="mb-3">Recent Log Entries</h4>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Crew</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="recentLogEntries">
                                    <tr>
                                        <td colspan="4" class="text-center">No log entries found</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cashbill Page -->
            <div class="page" id="cashbill">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Cashbill Management</h2>
                    <button class="btn btn-primary" id="createCashbillBtn" onclick="toggleCashbillForm()">
                        <i class="bi bi-plus-circle"></i> Create Cashbill
                    </button>
                </div>
                
                <div class="form-container" id="cashbillFormContainer" style="display: none;">
                    <h4 class="mb-3">Create New Cashbill</h4>
                    <form id="cashbillForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Invoice Number</label>
                                    <input type="text" class="form-control" id="invoiceNumber" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="cashbillDate" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Customer Name</label>
                                    <input type="text" class="form-control" id="customerName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" id="customerPhone" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Outlet</label>
                                    <select class="form-select" id="cashbillOutlet" required>
                                        <option value="">Select Outlet</option>
                                        <option value="HQ">HQ</option>
                                        <option value="BLM">Bandar Laguna Merbok</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Item</label>
                                    <select class="form-select" id="cashbillItem" required>
                                        <option value="">Select Item</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="itemQuantity" min="1" value="1" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Price (RM)</label>
                                    <input type="number" class="form-control" id="itemPrice" step="0.01" min="0" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Total Amount (RM)</label>
                            <input type="number" class="form-control" id="totalAmount" step="0.01" min="0" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="cashbillNotes" rows="3"></textarea>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-primary" onclick="addItemToCashbill()">
                                <i class="bi bi-plus-circle"></i> Add Item
                            </button>
                            <button type="button" class="btn btn-success" onclick="saveCashbill('draft')">
                                <i class="bi bi-save"></i> Save as Draft
                            </button>
                            <button type="button" class="btn btn-success" onclick="saveCashbill('commit')">
                                <i class="bi bi-check-circle"></i> Commit
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="printCashbill()">
                                <i class="bi bi-printer"></i> Print
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="downloadCashbill()">
                                <i class="bi bi-download"></i> Download PDF
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Cashbill History</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Invoice #</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Amount (RM)</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="cashbillHistory">
                            <tr>
                                <td colspan="6" class="text-center">No cashbills found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Logbook Page -->
            <div class="page" id="logbook">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Logbook Management</h2>
                    <button class="btn btn-primary" id="createLogbookBtn" onclick="toggleLogbookForm()">
                        <i class="bi bi-plus-circle"></i> Create Log Entry
                    </button>
                </div>
                
                <div class="form-container" id="logbookFormContainer" style="display: none;">
                    <h4 class="mb-3">Create New Log Entry</h4>
                    <form id="logbookForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="logDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Crew Involved</label>
                                    <select class="form-select" id="logCrew" required>
                                        <option value="">Select Crew</option>
                                        <option value="Danial Danish (0001)">Danial Danish (0001)</option>
                                        <option value="Aida (0002)">Aida (0002)</option>
                                        <option value="Putri Erinna (0003)">Putri Erinna (0003)</option>
                                        <option value="Putri Farah (0004)">Putri Farah (0004)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="logDescription" rows="4" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Price (RM)</label>
                            <input type="number" class="form-control" id="logPrice" step="0.01" min="0">
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-success" onclick="saveLogEntry('draft')">
                                <i class="bi bi-save"></i> Save as Draft
                            </button>
                            <button type="button" class="btn btn-success" onclick="saveLogEntry('commit')">
                                <i class="bi bi-check-circle"></i> Commit
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Log Entries</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Crew Involved</th>
                                <th>Price (RM)</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="logbookEntries">
                            <tr>
                                <td colspan="6" class="text-center">No log entries found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Quotation Page -->
            <div class="page" id="quotation">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Quotation Management</h2>
                    <button class="btn btn-primary" id="createQuotationBtn" onclick="toggleQuotationForm()">
                        <i class="bi bi-plus-circle"></i> Create Quotation
                    </button>
                </div>
                
                <div class="form-container" id="quotationFormContainer" style="display: none;">
                    <h4 class="mb-3">Create New Quotation</h4>
                    <form id="quotationForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Quotation Number</label>
                                    <input type="text" class="form-control" id="quotationNumber" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="quotationDate" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Client Name</label>
                                    <input type="text" class="form-control" id="clientName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Client Email</label>
                                    <input type="email" class="form-control" id="clientEmail" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Client Phone</label>
                                    <input type="tel" class="form-control" id="clientPhone" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Company</label>
                                    <input type="text" class="form-control" id="clientCompany">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Services</label>
                            <div id="quotationServices">
                                <div class="row mb-2">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control service-name" placeholder="Service Name" required>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="number" class="form-control service-price" placeholder="Price (RM)" step="0.01" min="0" required>
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-danger btn-sm" onclick="removeQuotationService(this)">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary btn-sm mt-2" onclick="addQuotationService()">
                                <i class="bi bi-plus-circle"></i> Add Service
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Total Amount (RM)</label>
                            <input type="number" class="form-control" id="quotationTotal" step="0.01" min="0" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="quotationNotes" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Template</label>
                            <select class="form-select" id="quotationTemplate">
                                <option value="">Select Template</option>
                                <option value="standard">Standard Template</option>
                                <option value="premium">Premium Template</option>
                            </select>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-success" onclick="saveQuotation()">
                                <i class="bi bi-save"></i> Save
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="downloadQuotation()">
                                <i class="bi bi-download"></i> Download
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="emailQuotation()">
                                <i class="bi bi-envelope"></i> Send Email
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Quotation History</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Quotation #</th>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Amount (RM)</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="quotationHistory">
                            <tr>
                                <td colspan="6" class="text-center">No quotations found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Schedule Page -->
            <div class="page" id="schedule">
                <div class="schedule-header">
                    <h2>Schedule Timetable</h2>
                    <div class="schedule-controls">
                        <button class="btn btn-outline-primary" id="prevWeekBtn">
                            <i class="bi bi-chevron-left"></i> Previous
                        </button>
                        <span id="currentWeek">Week of Aug 18, 2025</span>
                        <button class="btn btn-outline-primary" id="nextWeekBtn">
                            Next <i class="bi bi-chevron-right"></i>
                        </button>
                        <button class="btn btn-primary" id="addScheduleBtn" style="display: none;">
                            <i class="bi bi-plus-circle"></i> Add Schedule
                        </button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="schedule-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Sunday</th>
                                <th>Monday</th>
                                <th>Tuesday</th>
                                <th>Wednesday</th>
                                <th>Thursday</th>
                                <th>Friday</th>
                                <th>Saturday</th>
                            </tr>
                        </thead>
                        <tbody id="scheduleTableBody">
                            <!-- Schedule rows will be generated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-4">
                    <h4>Daily Hours Summary</h4>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th>Total Hours</th>
                                    <th>Staff Count</th>
                                </tr>
                            </thead>
                            <tbody id="dailyHoursSummary">
                                <!-- Daily hours summary will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Online Order Page -->
            <div class="page" id="onlineOrder">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Online Order Management</h2>
                    <button class="btn btn-primary" id="createOrderBtn" onclick="toggleOrderForm()">
                        <i class="bi bi-plus-circle"></i> Create Order
                    </button>
                </div>
                
                <div class="form-container" id="orderFormContainer" style="display: none;">
                    <h4 class="mb-3">Add New Order</h4>
                    <form id="onlineOrderForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Order ID</label>
                                    <input type="text" class="form-control" id="orderId" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="orderDate" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Customer Name</label>
                                    <input type="text" class="form-control" id="orderCustomerName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Customer Email</label>
                                    <input type="email" class="form-control" id="orderCustomerEmail" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Customer Phone</label>
                                    <input type="tel" class="form-control" id="orderCustomerPhone" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Assign to Outlet</label>
                                    <select class="form-select" id="orderOutlet" required>
                                        <option value="">Select Outlet</option>
                                        <option value="HQ">HQ</option>
                                        <option value="BLM">Bandar Laguna Merbok</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Order Items</label>
                            <div id="orderItems">
                                <div class="row mb-2">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control order-item-name" placeholder="Item Name" required>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="number" class="form-control order-item-price" placeholder="Price (RM)" step="0.01" min="0" required>
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-danger btn-sm" onclick="removeOrderItem(this)">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary btn-sm mt-2" onclick="addOrderItem()">
                                <i class="bi bi-plus-circle"></i> Add Item
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Total Amount (RM)</label>
                            <input type="number" class="form-control" id="orderTotal" step="0.01" min="0" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-control" id="orderNotes" rows="3"></textarea>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-success" onclick="saveOnlineOrder()">
                                <i class="bi bi-save"></i> Save Order
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Online Orders</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Amount (RM)</th>
                                <th>Outlet</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="onlineOrders">
                            <tr>
                                <td colspan="7" class="text-center">No orders found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Crew Management Page -->
            <div class="page" id="crewManagement">
                <h2 class="mb-4">Crew Management</h2>
                
                <div class="form-container">
                    <h4 class="mb-3">Add New Crew</h4>
                    <form id="crewForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control" id="crewName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">ID</label>
                                    <input type="text" class="form-control" id="crewId" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Position</label>
                                    <input type="text" class="form-control" id="crewPosition" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Role</label>
                                    <select class="form-select" id="crewRole" required>
                                        <option value="">Select Role</option>
                                        <option value="Admin">Admin</option>
                                        <option value="Crew">Crew</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Outlet</label>
                            <select class="form-select" id="crewOutlet" required>
                                <option value="">Select Outlet</option>
                                <option value="HQ">HQ</option>
                                <option value="BLM">Bandar Laguna Merbok</option>
                            </select>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-success" onclick="saveCrew()">
                                <i class="bi bi-save"></i> Save Crew
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetCrewForm()">
                                <i class="bi bi-arrow-clockwise"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Crew List</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Role</th>
                                <th>Outlet</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="crewList">
                            <tr>
                                <td>0001</td>
                                <td>Danial Danish</td>
                                <td>Head IT</td>
                                <td>Admin</td>
                                <td>HQ</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="editCrew('0001')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCrew('0001')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>0002</td>
                                <td>Aida</td>
                                <td>Director/Business Manager</td>
                                <td>Crew</td>
                                <td>HQ</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="editCrew('0002')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCrew('0002')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>0003</td>
                                <td>Putri Erinna</td>
                                <td>Business Development Manager</td>
                                <td>Crew</td>
                                <td>HQ</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="editCrew('0003')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCrew('0003')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>0004</td>
                                <td>Putri Farah</td>
                                <td>Business Marketing Manager</td>
                                <td>Crew</td>
                                <td>HQ</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="editCrew('0004')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCrew('0004')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Stock Management Page -->
            <div class="page" id="stockManagement">
                <h2 class="mb-4">Stock Management</h2>
                
                <div class="form-container" id="stockFormContainer" style="display: none;">
                    <h4 class="mb-3">Add New Stock Item</h4>
                    <form id="stockForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Item Name</label>
                                    <input type="text" class="form-control" id="stockItemName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">SKU</label>
                                    <input type="text" class="form-control" id="stockSku" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <select class="form-select" id="stockCategory" required>
                                        <option value="">Select Category</option>
                                        <option value="Electronics">Electronics</option>
                                        <option value="Clothing">Clothing</option>
                                        <option value="Food & Beverage">Food & Beverage</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Price (RM)</label>
                                    <input type="number" class="form-control" id="stockPrice" step="0.01" min="0" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="stockQuantity" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Outlet</label>
                                    <select class="form-select" id="stockOutlet" required>
                                        <option value="">Select Outlet</option>
                                        <option value="HQ">HQ</option>
                                        <option value="BLM">Bandar Laguna Merbok</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="stockDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-success" onclick="saveStock()">
                                <i class="bi bi-save"></i> Save Stock
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetStockForm()">
                                <i class="bi bi-arrow-clockwise"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-container">
                    <h4 class="mb-3">Stock List</h4>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>SKU</th>
                                <th>Item Name</th>
                                <th>Category</th>
                                <th>Price (RM)</th>
                                <th>Quantity</th>
                                <th>Outlet</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="stockList">
                            <tr>
                                <td colspan="7" class="text-center">No stock items found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Time Tracking Page -->
            <div class="page" id="timeTracking">
                <h2 class="mb-4">Time Tracking</h2>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="time-tracking-card">
                            <div class="time-status">
                                <div class="status-indicator">
                                    <div class="status-dot" id="statusDot"></div>
                                    <span id="statusText">Not Punched In</span>
                                </div>
                                <div id="currentTime"></div>
                            </div>
                            
                            <div class="time-buttons">
                                <button class="btn btn-success" id="punchInBtn" onclick="punchIn()">
                                    <i class="bi bi-box-arrow-in-right"></i> Punch In
                                </button>
                                <button class="btn btn-warning" id="breakBtn" onclick="takeBreak()" disabled>
                                    <i class="bi bi-cup-hot"></i> Take Break
                                </button>
                                <button class="btn btn-info" id="breakEndBtn" onclick="endBreak()" disabled>
                                    <i class="bi bi-cup-straw"></i> End Break
                                </button>
                                <button class="btn btn-danger" id="punchOutBtn" onclick="punchOut()" disabled>
                                    <i class="bi bi-box-arrow-right"></i> Punch Out
                                </button>
                            </div>
                            
                            <div class="schedule-today">
                                <h5>Today's Schedule</h5>
                                <div id="todaySchedule">
                                    <p>You are not scheduled for today</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="time-tracking-card">
                            <h5>Time Summary</h5>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Today's Hours:</span>
                                    <span id="todayHours">0.00</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>This Week:</span>
                                    <span id="weekHours">0.00</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>This Month:</span>
                                    <span id="monthHours">0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="time-tracking-card mt-4">
                    <h5>Time Records</h5>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Punch In</th>
                                    <th>Punch Out</th>
                                    <th>Break Time</th>
                                    <th>Total Hours</th>
                                </tr>
                            </thead>
                            <tbody id="timeRecords">
                                <tr>
                                    <td colspan="5" class="text-center">No time records found</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Modal for Schedule -->
    <div class="modal" id="scheduleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Schedule</h5>
                <button class="modal-close" onclick="closeModal('scheduleModal')">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <div class="form-group">
                        <label class="form-label">Day</label>
                        <select class="form-select" id="scheduleDay" required>
                            <option value="0">Sunday</option>
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                            <option value="6">Saturday</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Start Time</label>
                        <input type="time" class="form-control" id="scheduleStartTime" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Time</label>
                        <input type="time" class="form-control" id="scheduleEndTime" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Crew</label>
                        <select class="form-select" id="scheduleCrew" required>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('scheduleModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveSchedule()">Save</button>
            </div>
        </div>
    </div>

    <!-- Modal for Adjustment -->
    <div class="modal" id="adjustmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Request Adjustment</h5>
                <button class="modal-close" onclick="closeModal('adjustmentModal')">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="adjustmentForm">
                    <div class="form-group">
                        <label class="form-label">Reason for Adjustment</label>
                        <textarea class="form-control" id="adjustmentReason" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Adjustment Amount (RM)</label>
                        <input type="number" class="form-control" id="adjustmentAmount" step="0.01" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('adjustmentModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitAdjustment()">Submit Request</button>
            </div>
        </div>
    </div>

    <!-- Modal for Confirmation -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationTitle">Confirmation</h5>
                <button class="modal-close" onclick="closeModal('confirmationModal')">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('confirmationModal')">Cancel</button>
                <button class="btn btn-primary" id="confirmButton">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let isLoggedIn = false;
        let cashbills = [];
        let logEntries = [];
        let quotations = [];
        let onlineOrders = [];
        let crews = [
            { id: '0001', name: 'Danial Danish', position: 'Head IT', role: 'Admin', outlet: 'HQ', password: 'admin123' },
            { id: '0002', name: 'Aida', position: 'Director/Business Manager', role: 'Crew', outlet: 'HQ', password: 'crew123' },
            { id: '0003', name: 'Putri Erinna', position: 'Business Development Manager', role: 'Crew', outlet: 'HQ', password: 'crew123' },
            { id: '0004', name: 'Putri Farah', position: 'Business Marketing Manager', role: 'Crew', outlet: 'HQ', password: 'crew123' }
        ];
        let stockItems = [
            { sku: 'SKU001', name: 'Laptop', category: 'Electronics', price: 2500, quantity: 10, outlet: 'HQ' },
            { sku: 'SKU002', name: 'Mouse', category: 'Electronics', price: 50, quantity: 25, outlet: 'HQ' },
            { sku: 'SKU003', name: 'Keyboard', category: 'Electronics', price: 100, quantity: 15, outlet: 'HQ' },
            { sku: 'SKU004', name: 'T-Shirt', category: 'Clothing', price: 30, quantity: 50, outlet: 'HQ' }
        ];
        let schedules = [];
        let timeRecords = [];
        let currentPunch = null;
        let currentWeekStart = new Date();
        currentWeekStart.setDate(currentWeekStart.getDate() - currentWeekStart.getDay()); // Set to Sunday of current week

        let currentCashbillItems = [];
        let currentQuotationServices = [];
        let currentOrderItems = [];
        let invoiceCounter = 1;
        let orderCounter = 1;
        let quotationCounter = 1;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date to all date fields
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('cashbillDate').value = today;
            document.getElementById('logDate').value = today;
            document.getElementById('quotationDate').value = today;
            document.getElementById('orderDate').value = today;

            // Generate initial numbers
            document.getElementById('invoiceNumber').value = `INV-${String(invoiceCounter).padStart(4, '0')}`;
            document.getElementById('orderId').value = `ORD-${String(orderCounter).padStart(4, '0')}`;
            document.getElementById('quotationNumber').value = `QTN-${String(quotationCounter).padStart(4, '0')}`;

            // Populate stock items dropdown
            populateStockItemsDropdown();

            // Load data from localStorage if available
            loadDataFromStorage();

            // Set up sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);

            // Set up event listeners for dynamic calculations
            document.getElementById('itemQuantity').addEventListener('input', calculateCashbillTotal);
            document.getElementById('itemPrice').addEventListener('input', calculateCashbillTotal);
            
            document.getElementById('cashbillItem').addEventListener('change', function() {
                const selectedItem = stockItems.find(item => item.name === this.value);
                if (selectedItem) {
                    document.getElementById('itemPrice').value = selectedItem.price;
                    calculateCashbillTotal();
                }
            });

            // Set up event listeners for quotation services
            document.querySelectorAll('.service-price').forEach(input => {
                input.addEventListener('input', calculateQuotationTotal);
            });

            // Set up event listeners for order items
            document.querySelectorAll('.order-item-price').forEach(input => {
                input.addEventListener('input', calculateOrderTotal);
            });

            // Set up schedule navigation
            document.getElementById('prevWeekBtn').addEventListener('click', function() {
                currentWeekStart.setDate(currentWeekStart.getDate() - 7);
                updateScheduleTable();
                updateCurrentWeekDisplay();
            });

            document.getElementById('nextWeekBtn').addEventListener('click', function() {
                currentWeekStart.setDate(currentWeekStart.getDate() + 7);
                updateScheduleTable();
                updateCurrentWeekDisplay();
            });

            // Update current week display
            updateCurrentWeekDisplay();

            // Initialize schedule table
            updateScheduleTable();

            // Update current time
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);

            // Set up login form submission
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });
        });

        // Login function
        function login() {
            const userId = document.getElementById('loginUserId').value;
            const password = document.getElementById('loginPassword').value;
            
            // Find user in crew list
            const user = crews.find(c => c.id === userId && c.password === password);
            
            if (user) {
                currentUser = {
                    id: user.id,
                    name: user.name,
                    role: user.role,
                    outlet: user.outlet
                };
                
                isLoggedIn = true;
                
                // Hide login page and show main app
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                // Check user role and show/hide admin features
                checkUserRole();
                
                // Update dashboard
                updateDashboard();
                
                // Update time tracking if on that page
                if (document.getElementById('timeTracking').classList.contains('active')) {
                    updateTimeTracking();
                }
                
                showToast(`Welcome, ${currentUser.name}!`, 'success');
            } else {
                showToast('Invalid user ID or password', 'error');
            }
        }

        // Logout function
        function logout() {
            showConfirmation('Are you sure you want to logout?', function() {
                isLoggedIn = false;
                currentUser = null;
                
                // Show login page and hide main app
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                
                // Reset login form
                document.getElementById('loginUserId').value = '';
                document.getElementById('loginPassword').value = '';
                
                showToast('Logged out successfully', 'success');
            });
        }

        // Sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        }

        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update active menu item
            document.querySelectorAll('.sidebar-menu a').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('a').classList.add('active');
            
            // Update page-specific content
            if (pageId === 'dashboard') {
                updateDashboard();
            } else if (pageId === 'cashbill') {
                updateCashbillHistory();
            } else if (pageId === 'logbook') {
                updateLogbookEntries();
            } else if (pageId === 'quotation') {
                updateQuotationHistory();
            } else if (pageId === 'onlineOrder') {
                updateOnlineOrders();
            } else if (pageId === 'crewManagement') {
                updateCrewList();
            } else if (pageId === 'stockManagement') {
                updateStockList();
            } else if (pageId === 'timeTracking') {
                updateTimeTracking();
            }
        }

        // Check user role and show/hide admin features
        function checkUserRole() {
            const userRoleElement = document.getElementById('userRole');
            const crewManagementLink = document.getElementById('crewManagementLink');
            const adminOrderSection = document.getElementById('adminOrderSection');
            const stockFormContainer = document.getElementById('stockFormContainer');
            const addScheduleBtn = document.getElementById('addScheduleBtn');
            
            if (currentUser) {
                userRoleElement.textContent = currentUser.role;
                
                if (currentUser.role === 'Admin') {
                    crewManagementLink.style.display = 'block';
                    if (adminOrderSection) adminOrderSection.style.display = 'block';
                    if (stockFormContainer) stockFormContainer.style.display = 'block';
                    if (addScheduleBtn) addScheduleBtn.style.display = 'block';
                } else {
                    crewManagementLink.style.display = 'none';
                    if (adminOrderSection) adminOrderSection.style.display = 'none';
                    if (stockFormContainer) stockFormContainer.style.display = 'none';
                    if (addScheduleBtn) addScheduleBtn.style.display = 'none';
                }
            }
        }

        // Populate stock items dropdown
        function populateStockItemsDropdown() {
            const dropdown = document.getElementById('cashbillItem');
            if (dropdown) {
                dropdown.innerHTML = '<option value="">Select Item</option>';
                
                stockItems.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.name;
                    option.textContent = `${item.name} (RM ${item.price})`;
                    dropdown.appendChild(option);
                });
            }
        }

        // Toggle cashbill form
        function toggleCashbillForm() {
            const formContainer = document.getElementById('cashbillFormContainer');
            if (formContainer.style.display === 'none') {
                formContainer.style.display = 'block';
            } else {
                formContainer.style.display = 'none';
            }
        }

        // Toggle logbook form
        function toggleLogbookForm() {
            const formContainer = document.getElementById('logbookFormContainer');
            if (formContainer.style.display === 'none') {
                formContainer.style.display = 'block';
            } else {
                formContainer.style.display = 'none';
            }
        }

        // Toggle quotation form
        function toggleQuotationForm() {
            const formContainer = document.getElementById('quotationFormContainer');
            if (formContainer.style.display === 'none') {
                formContainer.style.display = 'block';
            } else {
                formContainer.style.display = 'none';
            }
        }

        // Toggle order form
        function toggleOrderForm() {
            const formContainer = document.getElementById('orderFormContainer');
            if (formContainer.style.display === 'none') {
                formContainer.style.display = 'block';
            } else {
                formContainer.style.display = 'none';
            }
        }

        // Calculate cashbill total
        function calculateCashbillTotal() {
            const quantity = parseFloat(document.getElementById('itemQuantity').value) || 0;
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;
            const total = quantity * price;
            
            document.getElementById('totalAmount').value = total.toFixed(2);
        }

        // Add item to cashbill
        function addItemToCashbill() {
            const itemName = document.getElementById('cashbillItem').value;
            const quantity = parseInt(document.getElementById('itemQuantity').value) || 0;
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;
            
            if (!itemName || quantity <= 0 || price <= 0) {
                showToast('Please fill in all item fields correctly', 'error');
                return;
            }
            
            const total = quantity * price;
            
            currentCashbillItems.push({
                name: itemName,
                quantity: quantity,
                price: price,
                total: total
            });
            
            updateCashbillItemsTable();
            resetCashbillItemForm();
        }

        // Update cashbill items table
        function updateCashbillItemsTable() {
            const tableBody = document.getElementById('cashbillItems');
            if (!tableBody) return;
            
            if (currentCashbillItems.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center">No items added</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            let grandTotal = 0;
            
            currentCashbillItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>RM ${item.price.toFixed(2)}</td>
                    <td>RM ${item.total.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="removeCashbillItem(${index})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
                
                grandTotal += item.total;
            });
            
            // Add grand total row
            const totalRow = document.createElement('tr');
            totalRow.innerHTML = `
                <td colspan="3" class="text-end fw-bold">Grand Total</td>
                <td class="fw-bold">RM ${grandTotal.toFixed(2)}</td>
                <td></td>
            `;
            tableBody.appendChild(totalRow);
            
            // Update total amount field
            document.getElementById('totalAmount').value = grandTotal.toFixed(2);
        }

        // Remove item from cashbill
        function removeCashbillItem(index) {
            currentCashbillItems.splice(index, 1);
            updateCashbillItemsTable();
        }

        // Reset cashbill item form
        function resetCashbillItemForm() {
            document.getElementById('cashbillItem').value = '';
            document.getElementById('itemQuantity').value = '1';
            document.getElementById('itemPrice').value = '';
        }

        // Save cashbill
        function saveCashbill(status) {
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const date = document.getElementById('cashbillDate').value;
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const outlet = document.getElementById('cashbillOutlet').value;
            const notes = document.getElementById('cashbillNotes').value;
            const totalAmount = parseFloat(document.getElementById('totalAmount').value) || 0;
            
            if (!date || !customerName || !customerPhone || !outlet || currentCashbillItems.length === 0) {
                showToast('Please fill in all required fields and add at least one item', 'error');
                return;
            }
            
            const cashbill = {
                id: invoiceNumber,
                date: date,
                customerName: customerName,
                customerPhone: customerPhone,
                outlet: outlet,
                items: [...currentCashbillItems],
                totalAmount: totalAmount,
                notes: notes,
                status: status,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            cashbills.push(cashbill);
            saveDataToStorage();
            
            showToast(`Cashbill ${invoiceNumber} saved as ${status}`, 'success');
            
            // Reset form
            resetCashbillForm();
            
            // Update counters and displays
            invoiceCounter++;
            document.getElementById('invoiceNumber').value = `INV-${String(invoiceCounter).padStart(4, '0')}`;
            updateCashbillHistory();
            updateDashboard();
        }

        // Reset cashbill form
        function resetCashbillForm() {
            document.getElementById('cashbillDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('cashbillOutlet').value = '';
            document.getElementById('cashbillNotes').value = '';
            document.getElementById('totalAmount').value = '';
            
            currentCashbillItems = [];
            updateCashbillItemsTable();
            resetCashbillItemForm();
        }

        // Update cashbill history
        function updateCashbillHistory() {
            const tableBody = document.getElementById('cashbillHistory');
            if (!tableBody) return;
            
            if (cashbills.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No cashbills found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort cashbills by date (newest first)
            const sortedCashbills = [...cashbills].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedCashbills.forEach(cashbill => {
                const row = document.createElement('tr');
                
                let actionButtons = `
                    <button class="btn btn-sm btn-secondary" onclick="viewCashbill('${cashbill.id}')">
                        <i class="bi bi-eye"></i>
                    </button>
                `;
                
                if (currentUser && currentUser.role === 'Admin') {
                    actionButtons += `
                        <button class="btn btn-sm btn-warning" onclick="uncommitCashbill('${cashbill.id}')">
                            <i class="bi bi-arrow-counterclockwise"></i>
                        </button>
                    `;
                } else if (cashbill.status === 'committed') {
                    actionButtons += `
                        <button class="btn btn-sm btn-warning" onclick="requestAdjustment('${cashbill.id}')">
                            <i class="bi bi-exclamation-triangle"></i>
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td>${cashbill.id}</td>
                    <td>${cashbill.date}</td>
                    <td>${cashbill.customerName}</td>
                    <td>RM ${cashbill.totalAmount.toFixed(2)}</td>
                    <td><span class="badge badge-${cashbill.status}">${cashbill.status}</span></td>
                    <td>${actionButtons}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // View cashbill details
        function viewCashbill(id) {
            const cashbill = cashbills.find(c => c.id === id);
            if (!cashbill) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing cashbill ${id}`, 'success');
        }

        // Uncommit cashbill (admin only)
        function uncommitCashbill(id) {
            const cashbill = cashbills.find(c => c.id === id);
            if (!cashbill) return;
            
            cashbill.status = 'draft';
            saveDataToStorage();
            updateCashbillHistory();
            
            showToast(`Cashbill ${id} has been uncommitted`, 'success');
        }

        // Request adjustment for cashbill
        function requestAdjustment(id) {
            const cashbill = cashbills.find(c => c.id === id);
            if (!cashbill) return;
            
            // Show adjustment modal
            document.getElementById('adjustmentModal').classList.add('active');
            
            // Set up confirmation button
            document.getElementById('confirmButton').onclick = function() {
                const reason = document.getElementById('adjustmentReason').value;
                const amount = parseFloat(document.getElementById('adjustmentAmount').value) || 0;
                
                if (!reason || amount <= 0) {
                    showToast('Please fill in all adjustment fields', 'error');
                    return;
                }
                
                // In a real application, this would send a request to the admin
                showToast(`Adjustment request for cashbill ${id} has been submitted`, 'success');
                closeModal('adjustmentModal');
                
                // Reset form
                document.getElementById('adjustmentReason').value = '';
                document.getElementById('adjustmentAmount').value = '';
            };
        }

        // Print cashbill
        function printCashbill() {
            if (currentCashbillItems.length === 0) {
                showToast('Please add items to the cashbill before printing', 'error');
                return;
            }
            
            window.print();
        }

        // Download cashbill as PDF
        function downloadCashbill() {
            if (currentCashbillItems.length === 0) {
                showToast('Please add items to the cashbill before downloading', 'error');
                return;
            }
            
            // In a real application, this would generate and download a PDF
            showToast('Cashbill PDF download started', 'success');
        }

        // Save log entry
        function saveLogEntry(status) {
            const date = document.getElementById('logDate').value;
            const crew = document.getElementById('logCrew').value;
            const description = document.getElementById('logDescription').value;
            const price = parseFloat(document.getElementById('logPrice').value) || 0;
            
            if (!date || !crew || !description) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const logEntry = {
                id: `LOG-${Date.now()}`,
                date: date,
                crew: crew,
                description: description,
                price: price,
                status: status,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            logEntries.push(logEntry);
            saveDataToStorage();
            
            showToast(`Log entry saved as ${status}`, 'success');
            
            // Reset form
            document.getElementById('logDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('logCrew').value = '';
            document.getElementById('logDescription').value = '';
            document.getElementById('logPrice').value = '';
            
            // Update displays
            updateLogbookEntries();
            updateDashboard();
        }

        // Update logbook entries
        function updateLogbookEntries() {
            const tableBody = document.getElementById('logbookEntries');
            if (!tableBody) return;
            
            if (logEntries.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No log entries found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort log entries by date (newest first)
            const sortedLogEntries = [...logEntries].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedLogEntries.forEach(entry => {
                const row = document.createElement('tr');
                
                let actionButtons = `
                    <button class="btn btn-sm btn-secondary" onclick="viewLogEntry('${entry.id}')">
                        <i class="bi bi-eye"></i>
                    </button>
                `;
                
                if (currentUser && currentUser.role === 'Admin') {
                    actionButtons += `
                        <button class="btn btn-sm btn-warning" onclick="uncommitLogEntry('${entry.id}')">
                            <i class="bi bi-arrow-counterclockwise"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteLogEntry('${entry.id}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    `;
                } else if (entry.status === 'committed') {
                    actionButtons += `
                        <button class="btn btn-sm btn-warning" onclick="requestLogAdjustment('${entry.id}')">
                            <i class="bi bi-exclamation-triangle"></i>
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td>${entry.date}</td>
                    <td>${entry.description}</td>
                    <td>${entry.crew}</td>
                    <td>${entry.price > 0 ? `RM ${entry.price.toFixed(2)}` : '-'}</td>
                    <td><span class="badge badge-${entry.status}">${entry.status}</span></td>
                    <td>${actionButtons}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // View log entry details
        function viewLogEntry(id) {
            const entry = logEntries.find(e => e.id === id);
            if (!entry) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing log entry ${id}`, 'success');
        }

        // Uncommit log entry (admin only)
        function uncommitLogEntry(id) {
            const entry = logEntries.find(e => e.id === id);
            if (!entry) return;
            
            entry.status = 'draft';
            saveDataToStorage();
            updateLogbookEntries();
            
            showToast(`Log entry ${id} has been uncommitted`, 'success');
        }

        // Delete log entry (admin only)
        function deleteLogEntry(id) {
            showConfirmation('Are you sure you want to delete this log entry?', function() {
                logEntries = logEntries.filter(e => e.id !== id);
                saveDataToStorage();
                updateLogbookEntries();
                updateDashboard();
                
                showToast('Log entry deleted successfully', 'success');
            });
        }

        // Request adjustment for log entry
        function requestLogAdjustment(id) {
            const entry = logEntries.find(e => e.id === id);
            if (!entry) return;
            
            // Show adjustment modal
            document.getElementById('adjustmentModal').classList.add('active');
            
            // Set up confirmation button
            document.getElementById('confirmButton').onclick = function() {
                const reason = document.getElementById('adjustmentReason').value;
                const amount = parseFloat(document.getElementById('adjustmentAmount').value) || 0;
                
                if (!reason || amount <= 0) {
                    showToast('Please fill in all adjustment fields', 'error');
                    return;
                }
                
                // In a real application, this would send a request to the admin
                showToast(`Adjustment request for log entry ${id} has been submitted`, 'success');
                closeModal('adjustmentModal');
                
                // Reset form
                document.getElementById('adjustmentReason').value = '';
                document.getElementById('adjustmentAmount').value = '';
            };
        }

        // Add quotation service
        function addQuotationService() {
            const servicesContainer = document.getElementById('quotationServices');
            const serviceRow = document.createElement('div');
            serviceRow.className = 'row mb-2';
            serviceRow.innerHTML = `
                <div class="col-md-6">
                    <input type="text" class="form-control service-name" placeholder="Service Name" required>
                </div>
                <div class="col-md-4">
                    <input type="number" class="form-control service-price" placeholder="Price (RM)" step="0.01" min="0" required>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeQuotationService(this)">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;
            servicesContainer.appendChild(serviceRow);
            
            // Add event listener to the new price input
            serviceRow.querySelector('.service-price').addEventListener('input', calculateQuotationTotal);
        }

        // Remove quotation service
        function removeQuotationService(button) {
            button.closest('.row').remove();
            calculateQuotationTotal();
        }

        // Calculate quotation total
        function calculateQuotationTotal() {
            const priceInputs = document.querySelectorAll('.service-price');
            let total = 0;
            
            priceInputs.forEach(input => {
                const price = parseFloat(input.value) || 0;
                total += price;
            });
            
            document.getElementById('quotationTotal').value = total.toFixed(2);
        }

        // Save quotation
        function saveQuotation() {
            const quotationNumber = document.getElementById('quotationNumber').value;
            const date = document.getElementById('quotationDate').value;
            const clientName = document.getElementById('clientName').value;
            const clientEmail = document.getElementById('clientEmail').value;
            const clientPhone = document.getElementById('clientPhone').value;
            const clientCompany = document.getElementById('clientCompany').value;
            const notes = document.getElementById('quotationNotes').value;
            const template = document.getElementById('quotationTemplate').value;
            const totalAmount = parseFloat(document.getElementById('quotationTotal').value) || 0;
            
            if (!date || !clientName || !clientEmail || !clientPhone) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Collect services
            const services = [];
            const serviceNames = document.querySelectorAll('.service-name');
            const servicePrices = document.querySelectorAll('.service-price');
            
            for (let i = 0; i < serviceNames.length; i++) {
                const name = serviceNames[i].value.trim();
                const price = parseFloat(servicePrices[i].value) || 0;
                
                if (name && price > 0) {
                    services.push({
                        name: name,
                        price: price
                    });
                }
            }
            
            if (services.length === 0) {
                showToast('Please add at least one service', 'error');
                return;
            }
            
            const quotation = {
                id: quotationNumber,
                date: date,
                clientName: clientName,
                clientEmail: clientEmail,
                clientPhone: clientPhone,
                clientCompany: clientCompany,
                services: services,
                totalAmount: totalAmount,
                notes: notes,
                template: template,
                status: 'pending',
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            quotations.push(quotation);
            saveDataToStorage();
            
            showToast(`Quotation ${quotationNumber} saved successfully`, 'success');
            
            // Reset form
            resetQuotationForm();
            
            // Update counters and displays
            quotationCounter++;
            document.getElementById('quotationNumber').value = `QTN-${String(quotationCounter).padStart(4, '0')}`;
            updateQuotationHistory();
        }

        // Reset quotation form
        function resetQuotationForm() {
            document.getElementById('quotationDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('clientName').value = '';
            document.getElementById('clientEmail').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('clientCompany').value = '';
            document.getElementById('quotationNotes').value = '';
            document.getElementById('quotationTemplate').value = '';
            document.getElementById('quotationTotal').value = '';
            
            // Reset services
            const servicesContainer = document.getElementById('quotationServices');
            servicesContainer.innerHTML = `
                <div class="row mb-2">
                    <div class="col-md-6">
                        <input type="text" class="form-control service-name" placeholder="Service Name" required>
                    </div>
                    <div class="col-md-4">
                        <input type="number" class="form-control service-price" placeholder="Price (RM)" step="0.01" min="0" required>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeQuotationService(this)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listener to the price input
            servicesContainer.querySelector('.service-price').addEventListener('input', calculateQuotationTotal);
        }

        // Update quotation history
        function updateQuotationHistory() {
            const tableBody = document.getElementById('quotationHistory');
            if (!tableBody) return;
            
            if (quotations.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No quotations found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort quotations by date (newest first)
            const sortedQuotations = [...quotations].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedQuotations.forEach(quotation => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${quotation.id}</td>
                    <td>${quotation.date}</td>
                    <td>${quotation.clientName}</td>
                    <td>RM ${quotation.totalAmount.toFixed(2)}</td>
                    <td><span class="badge badge-${quotation.status}">${quotation.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewQuotation('${quotation.id}')">
                            <i class="bi bi-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="downloadQuotationById('${quotation.id}')">
                            <i class="bi bi-download"></i>
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="emailQuotationById('${quotation.id}')">
                            <i class="bi bi-envelope"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // View quotation details
        function viewQuotation(id) {
            const quotation = quotations.find(q => q.id === id);
            if (!quotation) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing quotation ${id}`, 'success');
        }

        // Download quotation
        function downloadQuotation() {
            // In a real application, this would generate and download a PDF
            showToast('Quotation PDF download started', 'success');
        }

        // Download quotation by ID
        function downloadQuotationById(id) {
            const quotation = quotations.find(q => q.id === id);
            if (!quotation) return;
            
            // In a real application, this would generate and download a PDF
            showToast(`Quotation ${id} PDF download started`, 'success');
        }

        // Email quotation
        function emailQuotation() {
            const clientEmail = document.getElementById('clientEmail').value;
            
            if (!clientEmail) {
                showToast('Please enter a client email address', 'error');
                return;
            }
            
            // In a real application, this would send an email
            showToast(`Quotation email sent to ${clientEmail}`, 'success');
        }

        // Email quotation by ID
        function emailQuotationById(id) {
            const quotation = quotations.find(q => q.id === id);
            if (!quotation) return;
            
            // In a real application, this would send an email
            showToast(`Quotation ${id} email sent to ${quotation.clientEmail}`, 'success');
        }

        // Add order item
        function addOrderItem() {
            const itemsContainer = document.getElementById('orderItems');
            const itemRow = document.createElement('div');
            itemRow.className = 'row mb-2';
            itemRow.innerHTML = `
                <div class="col-md-6">
                    <input type="text" class="form-control order-item-name" placeholder="Item Name" required>
                </div>
                <div class="col-md-4">
                    <input type="number" class="form-control order-item-price" placeholder="Price (RM)" step="0.01" min="0" required>
                </div>
                <div class="col-md-2">
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeOrderItem(this)">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;
            itemsContainer.appendChild(itemRow);
            
            // Add event listener to the new price input
            itemRow.querySelector('.order-item-price').addEventListener('input', calculateOrderTotal);
        }

        // Remove order item
        function removeOrderItem(button) {
            button.closest('.row').remove();
            calculateOrderTotal();
        }

        // Calculate order total
        function calculateOrderTotal() {
            const priceInputs = document.querySelectorAll('.order-item-price');
            let total = 0;
            
            priceInputs.forEach(input => {
                const price = parseFloat(input.value) || 0;
                total += price;
            });
            
            document.getElementById('orderTotal').value = total.toFixed(2);
        }

        // Save online order
        function saveOnlineOrder() {
            const orderId = document.getElementById('orderId').value;
            const date = document.getElementById('orderDate').value;
            const customerName = document.getElementById('orderCustomerName').value;
            const customerEmail = document.getElementById('orderCustomerEmail').value;
            const customerPhone = document.getElementById('orderCustomerPhone').value;
            const outlet = document.getElementById('orderOutlet').value;
            const notes = document.getElementById('orderNotes').value;
            const totalAmount = parseFloat(document.getElementById('orderTotal').value) || 0;
            
            if (!date || !customerName || !customerEmail || !customerPhone || !outlet) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Collect order items
            const items = [];
            const itemNames = document.querySelectorAll('.order-item-name');
            const itemPrices = document.querySelectorAll('.order-item-price');
            
            for (let i = 0; i < itemNames.length; i++) {
                const name = itemNames[i].value.trim();
                const price = parseFloat(itemPrices[i].value) || 0;
                
                if (name && price > 0) {
                    items.push({
                        name: name,
                        price: price
                    });
                }
            }
            
            if (items.length === 0) {
                showToast('Please add at least one item', 'error');
                return;
            }
            
            const order = {
                id: orderId,
                date: date,
                customerName: customerName,
                customerEmail: customerEmail,
                customerPhone: customerPhone,
                outlet: outlet,
                items: items,
                totalAmount: totalAmount,
                notes: notes,
                status: 'pending',
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            onlineOrders.push(order);
            saveDataToStorage();
            
            showToast(`Order ${orderId} saved successfully`, 'success');
            
            // Reset form
            resetOrderForm();
            
            // Update counters and displays
            orderCounter++;
            document.getElementById('orderId').value = `ORD-${String(orderCounter).padStart(4, '0')}`;
            updateOnlineOrders();
            updateDashboard();
        }

        // Reset order form
        function resetOrderForm() {
            document.getElementById('orderDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('orderCustomerName').value = '';
            document.getElementById('orderCustomerEmail').value = '';
            document.getElementById('orderCustomerPhone').value = '';
            document.getElementById('orderOutlet').value = '';
            document.getElementById('orderNotes').value = '';
            document.getElementById('orderTotal').value = '';
            
            // Reset order items
            const itemsContainer = document.getElementById('orderItems');
            itemsContainer.innerHTML = `
                <div class="row mb-2">
                    <div class="col-md-6">
                        <input type="text" class="form-control order-item-name" placeholder="Item Name" required>
                    </div>
                    <div class="col-md-4">
                        <input type="number" class="form-control order-item-price" placeholder="Price (RM)" step="0.01" min="0" required>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeOrderItem(this)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            // Add event listener to the price input
            itemsContainer.querySelector('.order-item-price').addEventListener('input', calculateOrderTotal);
        }

        // Update online orders
        function updateOnlineOrders() {
            const tableBody = document.getElementById('onlineOrders');
            if (!tableBody) return;
            
            if (onlineOrders.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">No orders found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort orders by date (newest first)
            const sortedOrders = [...onlineOrders].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedOrders.forEach(order => {
                const row = document.createElement('tr');
                
                let actionButtons = `
                    <button class="btn btn-sm btn-secondary" onclick="viewOrder('${order.id}')">
                        <i class="bi bi-eye"></i>
                    </button>
                `;
                
                if (currentUser && currentUser.role === 'Admin') {
                    actionButtons += `
                        <button class="btn btn-sm btn-danger" onclick="deleteOrder('${order.id}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    `;
                } else if (order.status === 'pending') {
                    actionButtons += `
                        <button class="btn btn-sm btn-success" onclick="fulfillOrder('${order.id}')">
                            <i class="bi bi-check-circle"></i>
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="createCashbillFromOrder('${order.id}')">
                            <i class="bi bi-receipt"></i>
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${order.date}</td>
                    <td>${order.customerName}</td>
                    <td>RM ${order.totalAmount.toFixed(2)}</td>
                    <td>${order.outlet}</td>
                    <td><span class="badge badge-${order.status}">${order.status}</span></td>
                    <td>${actionButtons}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // View order details
        function viewOrder(id) {
            const order = onlineOrders.find(o => o.id === id);
            if (!order) return;
            
            // In a real application, this would open a detailed view
            showToast(`Viewing order ${id}`, 'success');
        }

        // Delete order (admin only)
        function deleteOrder(id) {
            showConfirmation('Are you sure you want to delete this order?', function() {
                onlineOrders = onlineOrders.filter(o => o.id !== id);
                saveDataToStorage();
                updateOnlineOrders();
                updateDashboard();
                
                showToast('Order deleted successfully', 'success');
            });
        }

        // Fulfill order
        function fulfillOrder(id) {
            const order = onlineOrders.find(o => o.id === id);
            if (!order) return;
            
            order.status = 'fulfilled';
            saveDataToStorage();
            updateOnlineOrders();
            updateDashboard();
            
            showToast(`Order ${id} has been fulfilled`, 'success');
        }

        // Create cashbill from order
        function createCashbillFromOrder(id) {
            const order = onlineOrders.find(o => o.id === id);
            if (!order) return;
            
            // Switch to cashbill page
            showPage('cashbill');
            
            // Pre-fill cashbill form with order details
            document.getElementById('customerName').value = order.customerName;
            document.getElementById('customerPhone').value = order.customerPhone;
            document.getElementById('cashbillOutlet').value = order.outlet;
            
            // Add order items to cashbill
            currentCashbillItems = order.items.map(item => ({
                name: item.name,
                quantity: 1,
                price: item.price,
                total: item.price
            }));
            
            updateCashbillItemsTable();
            
            showToast(`Cashbill form pre-filled with order ${id} details`, 'success');
        }

        // Save crew
        function saveCrew() {
            const name = document.getElementById('crewName').value;
            const id = document.getElementById('crewId').value;
            const position = document.getElementById('crewPosition').value;
            const role = document.getElementById('crewRole').value;
            const outlet = document.getElementById('crewOutlet').value;
            
            if (!name || !id || !position || !role || !outlet) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            // Check if crew ID already exists
            const existingCrewIndex = crews.findIndex(c => c.id === id);
            
            if (existingCrewIndex !== -1) {
                // Update existing crew
                crews[existingCrewIndex] = {
                    id: id,
                    name: name,
                    position: position,
                    role: role,
                    outlet: outlet,
                    password: crews[existingCrewIndex].password // Keep existing password
                };
                
                showToast(`Crew ${name} updated successfully`, 'success');
            } else {
                // Add new crew
                crews.push({
                    id: id,
                    name: name,
                    position: position,
                    role: role,
                    outlet: outlet,
                    password: 'crew123' // Default password
                });
                
                showToast(`Crew ${name} added successfully`, 'success');
            }
            
            saveDataToStorage();
            resetCrewForm();
            updateCrewList();
            updateScheduleTable();
        }

        // Reset crew form
        function resetCrewForm() {
            document.getElementById('crewName').value = '';
            document.getElementById('crewId').value = '';
            document.getElementById('crewPosition').value = '';
            document.getElementById('crewRole').value = '';
            document.getElementById('crewOutlet').value = '';
        }

        // Update crew list
        function updateCrewList() {
            const tableBody = document.getElementById('crewList');
            if (!tableBody) return;
            
            if (crews.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center">No crew members found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort crews by ID
            const sortedCrews = [...crews].sort((a, b) => a.id.localeCompare(b.id));
            
            sortedCrews.forEach(crew => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${crew.id}</td>
                    <td>${crew.name}</td>
                    <td>${crew.position}</td>
                    <td>${crew.role}</td>
                    <td>${crew.outlet}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="editCrew('${crew.id}')">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCrew('${crew.id}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Edit crew
        function editCrew(id) {
            const crew = crews.find(c => c.id === id);
            if (!crew) return;
            
            document.getElementById('crewName').value = crew.name;
            document.getElementById('crewId').value = crew.id;
            document.getElementById('crewPosition').value = crew.position;
            document.getElementById('crewRole').value = crew.role;
            document.getElementById('crewOutlet').value = crew.outlet;
        }

        // Delete crew
        function deleteCrew(id) {
            showConfirmation('Are you sure you want to delete this crew member?', function() {
                crews = crews.filter(c => c.id !== id);
                saveDataToStorage();
                updateCrewList();
                updateScheduleTable();
                
                showToast('Crew member deleted successfully', 'success');
            });
        }

        // Save stock
        function saveStock() {
            const itemName = document.getElementById('stockItemName').value;
            const sku = document.getElementById('stockSku').value;
            const category = document.getElementById('stockCategory').value;
            const price = parseFloat(document.getElementById('stockPrice').value) || 0;
            const quantity = parseInt(document.getElementById('stockQuantity').value) || 0;
            const outlet = document.getElementById('stockOutlet').value;
            const description = document.getElementById('stockDescription').value;
            
            if (!itemName || !sku || !category || price <= 0 || quantity < 0 || !outlet) {
                showToast('Please fill in all required fields with valid values', 'error');
                return;
            }
            
            // Check if SKU already exists
            const existingStockIndex = stockItems.findIndex(s => s.sku === sku);
            
            if (existingStockIndex !== -1) {
                // Update existing stock item
                stockItems[existingStockIndex] = {
                    sku: sku,
                    name: itemName,
                    category: category,
                    price: price,
                    quantity: quantity,
                    outlet: outlet,
                    description: description
                };
                
                showToast(`Stock item ${itemName} updated successfully`, 'success');
            } else {
                // Add new stock item
                stockItems.push({
                    sku: sku,
                    name: itemName,
                    category: category,
                    price: price,
                    quantity: quantity,
                    outlet: outlet,
                    description: description
                });
                
                showToast(`Stock item ${itemName} added successfully`, 'success');
            }
            
            saveDataToStorage();
            resetStockForm();
            updateStockList();
            populateStockItemsDropdown();
        }

        // Reset stock form
        function resetStockForm() {
            document.getElementById('stockItemName').value = '';
            document.getElementById('stockSku').value = '';
            document.getElementById('stockCategory').value = '';
            document.getElementById('stockPrice').value = '';
            document.getElementById('stockQuantity').value = '';
            document.getElementById('stockOutlet').value = '';
            document.getElementById('stockDescription').value = '';
        }

        // Update stock list
        function updateStockList() {
            const tableBody = document.getElementById('stockList');
            if (!tableBody) return;
            
            if (stockItems.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center">No stock items found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort stock items by SKU
            const sortedStockItems = [...stockItems].sort((a, b) => a.sku.localeCompare(b.sku));
            
            sortedStockItems.forEach(item => {
                const row = document.createElement('tr');
                
                let actionButtons = '';
                if (currentUser && currentUser.role === 'Admin') {
                    actionButtons = `
                        <button class="btn btn-sm btn-primary" onclick="editStock('${item.sku}')">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteStock('${item.sku}')">
                            <i class="bi bi-trash"></i>
                        </button>
                    `;
                }
                
                row.innerHTML = `
                    <td>${item.sku}</td>
                    <td>${item.name}</td>
                    <td>${item.category}</td>
                    <td>RM ${item.price.toFixed(2)}</td>
                    <td>${item.quantity}</td>
                    <td>${item.outlet}</td>
                    <td>${actionButtons}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Edit stock
        function editStock(sku) {
            const stock = stockItems.find(s => s.sku === sku);
            if (!stock) return;
            
            document.getElementById('stockItemName').value = stock.name;
            document.getElementById('stockSku').value = stock.sku;
            document.getElementById('stockCategory').value = stock.category;
            document.getElementById('stockPrice').value = stock.price;
            document.getElementById('stockQuantity').value = stock.quantity;
            document.getElementById('stockOutlet').value = stock.outlet;
            document.getElementById('stockDescription').value = stock.description;
        }

        // Delete stock
        function deleteStock(sku) {
            showConfirmation('Are you sure you want to delete this stock item?', function() {
                stockItems = stockItems.filter(s => s.sku !== sku);
                saveDataToStorage();
                updateStockList();
                populateStockItemsDropdown();
                
                showToast('Stock item deleted successfully', 'success');
            });
        }

        // Update dashboard
        function updateDashboard() {
            // Update dashboard cards
            document.getElementById('totalCashbills').textContent = cashbills.length;
            
            const totalRevenue = cashbills.reduce((sum, cashbill) => sum + cashbill.totalAmount, 0);
            document.getElementById('totalRevenue').textContent = `RM ${totalRevenue.toFixed(2)}`;
            
            document.getElementById('totalLogEntries').textContent = logEntries.length;
            
            const pendingOrdersCount = onlineOrders.filter(order => order.status === 'pending').length;
            document.getElementById('pendingOrders').textContent = pendingOrdersCount;
            
            // Update recent cashbills
            const recentCashbillsTable = document.getElementById('recentCashbills');
            if (recentCashbillsTable) {
                recentCashbillsTable.innerHTML = '';
                
                if (cashbills.length === 0) {
                    recentCashbillsTable.innerHTML = '<tr><td colspan="5" class="text-center">No cashbills found</td></tr>';
                } else {
                    // Sort cashbills by date (newest first) and take the first 5
                    const recentCashbills = [...cashbills]
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 5);
                    
                    recentCashbills.forEach(cashbill => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${cashbill.id}</td>
                            <td>${cashbill.customerName}</td>
                            <td>${cashbill.date}</td>
                            <td>RM ${cashbill.totalAmount.toFixed(2)}</td>
                            <td><span class="badge badge-${cashbill.status}">${cashbill.status}</span></td>
                        `;
                        recentCashbillsTable.appendChild(row);
                    });
                }
            }
            
            // Update recent log entries
            const recentLogEntriesTable = document.getElementById('recentLogEntries');
            if (recentLogEntriesTable) {
                recentLogEntriesTable.innerHTML = '';
                
                if (logEntries.length === 0) {
                    recentLogEntriesTable.innerHTML = '<tr><td colspan="4" class="text-center">No log entries found</td></tr>';
                } else {
                    // Sort log entries by date (newest first) and take the first 5
                    const recentLogEntries = [...logEntries]
                        .sort((a, b) => new Date(b.date) - new Date(a.date))
                        .slice(0, 5);
                    
                    recentLogEntries.forEach(entry => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${entry.date}</td>
                            <td>${entry.description.length > 50 ? entry.description.substring(0, 50) + '...' : entry.description}</td>
                            <td>${entry.crew}</td>
                            <td><span class="badge badge-${entry.status}">${entry.status}</span></td>
                        `;
                        recentLogEntriesTable.appendChild(row);
                    });
                }
            }
        }

        // Update current week display
        function updateCurrentWeekDisplay() {
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            const options = { month: 'short', day: 'numeric', year: 'numeric' };
            const startDateStr = currentWeekStart.toLocaleDateString(undefined, options);
            const endDateStr = weekEnd.toLocaleDateString(undefined, options);
            
            document.getElementById('currentWeek').textContent = `Week of ${startDateStr} - ${endDateStr}`;
        }

        // Update schedule table
        function updateScheduleTable() {
            const tableBody = document.getElementById('scheduleTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            // Generate time slots (8:00 AM to 10:00 PM)
            const timeSlots = [];
            for (let hour = 8; hour <= 22; hour++) {
                timeSlots.push(`${hour}:00`);
                if (hour < 22) {
                    timeSlots.push(`${hour}:30`);
                }
            }
            
            // Create table rows for each time slot
            timeSlots.forEach(time => {
                const row = document.createElement('tr');
                
                // Time column
                const timeCell = document.createElement('td');
                timeCell.className = 'time-column';
                timeCell.textContent = time;
                row.appendChild(timeCell);
                
                // Day columns (Sunday to Saturday)
                for (let day = 0; day < 7; day++) {
                    const dayCell = document.createElement('td');
                    dayCell.className = 'schedule-cell';
                    dayCell.dataset.day = day;
                    dayCell.dataset.time = time;
                    
                    // Check if there's a schedule for this day and time
                    const daySchedules = schedules.filter(s => 
                        s.day === day && 
                        s.startTime <= time && 
                        s.endTime > time
                    );
                    
                    if (daySchedules.length > 0) {
                        dayCell.classList.add('has-shift');
                        
                        daySchedules.forEach(schedule => {
                            const shiftDiv = document.createElement('div');
                            shiftDiv.className = 'shift-details';
                            shiftDiv.innerHTML = `
                                <div class="shift-crew">${schedule.crewName}</div>
                                <div>${schedule.startTime} - ${schedule.endTime}</div>
                            `;
                            dayCell.appendChild(shiftDiv);
                        });
                    }
                    
                    // Add button for admin to add schedule
                    if (currentUser && currentUser.role === 'Admin') {
                        const addBtn = document.createElement('button');
                        addBtn.className = 'add-shift-btn';
                        addBtn.innerHTML = '<i class="bi bi-plus"></i>';
                        addBtn.onclick = function() {
                            openScheduleModal(day, time);
                        };
                        dayCell.appendChild(addBtn);
                    }
                    
                    row.appendChild(dayCell);
                });
                
                tableBody.appendChild(row);
            });
            
            // Update daily hours summary
            updateDailyHoursSummary();
        }

        // Update daily hours summary
        function updateDailyHoursSummary() {
            const summaryBody = document.getElementById('dailyHoursSummary');
            if (!summaryBody) return;
            
            summaryBody.innerHTML = '';
            
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            days.forEach((day, index) => {
                const daySchedules = schedules.filter(s => s.day === index);
                
                let totalHours = 0;
                let staffCount = new Set();
                
                daySchedules.forEach(schedule => {
                    const start = schedule.startTime.split(':');
                    const end = schedule.endTime.split(':');
                    
                    const startHour = parseInt(start[0]);
                    const startMinute = parseInt(start[1]);
                    const endHour = parseInt(end[0]);
                    const endMinute = parseInt(end[1]);
                    
                    const hours = (endHour + endMinute/60) - (startHour + startMinute/60);
                    totalHours += hours;
                    
                    staffCount.add(schedule.crewId);
                });
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${day}</td>
                    <td>${totalHours.toFixed(2)}</td>
                    <td>${staffCount.size}</td>
                `;
                summaryBody.appendChild(row);
            });
        }

        // Open schedule modal
        function openScheduleModal(day, time) {
            // Populate crew dropdown
            const crewDropdown = document.getElementById('scheduleCrew');
            crewDropdown.innerHTML = '';
            
            crews.forEach(crew => {
                const option = document.createElement('option');
                option.value = crew.id;
                option.textContent = `${crew.name} (${crew.id})`;
                crewDropdown.appendChild(option);
            });
            
            // Set default values
            document.getElementById('scheduleDay').value = day;
            document.getElementById('scheduleStartTime').value = time;
            
            // Calculate default end time (1 hour later)
            const [hour, minute] = time.split(':').map(Number);
            const endHour = hour + 1;
            document.getElementById('scheduleEndTime').value = `${endHour}:${minute.toString().padStart(2, '0')}`;
            
            // Show modal
            document.getElementById('scheduleModal').classList.add('active');
        }

        // Save schedule
        function saveSchedule() {
            const day = parseInt(document.getElementById('scheduleDay').value);
            const startTime = document.getElementById('scheduleStartTime').value;
            const endTime = document.getElementById('scheduleEndTime').value;
            const crewId = document.getElementById('scheduleCrew').value;
            
            if (!startTime || !endTime || !crewId) {
                showToast('Please fill in all fields', 'error');
                return;
            }
            
            // Find crew name
            const crew = crews.find(c => c.id === crewId);
            if (!crew) return;
            
            // Check for overlapping schedules
            const overlappingSchedule = schedules.find(s => 
                s.day === day && 
                s.crewId === crewId && 
                ((s.startTime <= startTime && s.endTime > startTime) || 
                 (s.startTime < endTime && s.endTime >= endTime))
            );
            
            if (overlappingSchedule) {
                showToast('This crew already has a schedule during this time', 'error');
                return;
            }
            
            // Add new schedule
            schedules.push({
                id: `SCH-${Date.now()}`,
                day: day,
                startTime: startTime,
                endTime: endTime,
                crewId: crewId,
                crewName: crew.name,
                createdBy: currentUser.name,
                createdAt: new Date().toISOString()
            });
            
            saveDataToStorage();
            updateScheduleTable();
            closeModal('scheduleModal');
            
            showToast('Schedule added successfully', 'success');
        }

        // Update time tracking
        function updateTimeTracking() {
            if (!currentUser) return;
            
            // Update status display
            updatePunchStatus();
            
            // Update today's schedule
            updateTodaySchedule();
            
            // Update time records
            updateTimeRecords();
            
            // Update time summary
            updateTimeSummary();
        }

        // Update punch status
        function updatePunchStatus() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            const punchInBtn = document.getElementById('punchInBtn');
            const breakBtn = document.getElementById('breakBtn');
            const breakEndBtn = document.getElementById('breakEndBtn');
            const punchOutBtn = document.getElementById('punchOutBtn');
            
            if (!currentPunch) {
                statusDot.className = 'status-dot';
                statusText.textContent = 'Not Punched In';
                punchInBtn.disabled = false;
                breakBtn.disabled = true;
                breakEndBtn.disabled = true;
                punchOutBtn.disabled = true;
            } else if (currentPunch.punchIn && !currentPunch.punchOut) {
                statusDot.className = 'status-dot active';
                statusText.textContent = `Punched In at ${currentPunch.punchIn}`;
                punchInBtn.disabled = true;
                punchOutBtn.disabled = false;
                
                if (currentPunch.breakStart && !currentPunch.breakEnd) {
                    statusDot.className = 'status-dot break';
                    statusText.textContent += ` (On Break)`;
                    breakBtn.disabled = true;
                    breakEndBtn.disabled = false;
                } else {
                    breakBtn.disabled = false;
                    breakEndBtn.disabled = true;
                }
            }
        }

        // Update today's schedule
        function updateTodaySchedule() {
            const today = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
            const todaySchedule = schedules.filter(s => s.day === today && s.crewId === currentUser.id);
            
            const scheduleContainer = document.getElementById('todaySchedule');
            
            if (todaySchedule.length === 0) {
                scheduleContainer.innerHTML = '<p>You are not scheduled for today</p>';
                return;
            }
            
            let scheduleHtml = '';
            todaySchedule.forEach(schedule => {
                scheduleHtml += `
                    <div class="today-shift">
                        <strong>${schedule.startTime} - ${schedule.endTime}</strong>
                    </div>
                `;
            });
            
            scheduleContainer.innerHTML = scheduleHtml;
        }

        // Update time records
        function updateTimeRecords() {
            const tableBody = document.getElementById('timeRecords');
            if (!tableBody) return;
            
            // Filter records for current user
            const userRecords = timeRecords.filter(r => r.crewId === currentUser.id);
            
            if (userRecords.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center">No time records found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = '';
            
            // Sort by date (newest first)
            const sortedRecords = [...userRecords].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedRecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.date}</td>
                    <td>${record.punchIn}</td>
                    <td>${record.punchOut || '-'}</td>
                    <td>${record.breakStart && record.breakEnd ? `${record.breakStart} - ${record.breakEnd}` : '-'}</td>
                    <td>${record.totalHours || '-'}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Update time summary
        function updateTimeSummary() {
            const today = new Date().toISOString().split('T')[0];
            const thisWeekStart = new Date();
            thisWeekStart.setDate(thisWeekStart.getDate() - thisWeekStart.getDay());
            const thisWeekEnd = new Date(thisWeekStart);
            thisWeekEnd.setDate(thisWeekEnd.getDate() + 6);
            
            const thisMonthStart = new Date();
            thisMonthStart.setDate(1);
            
            // Filter records for current user
            const userRecords = timeRecords.filter(r => r.crewId === currentUser.id);
            
            // Calculate today's hours
            const todayRecords = userRecords.filter(r => r.date === today);
            const todayHours = todayRecords.reduce((sum, record) => sum + (parseFloat(record.totalHours) || 0), 0);
            document.getElementById('todayHours').textContent = todayHours.toFixed(2);
            
            // Calculate this week's hours
            const weekRecords = userRecords.filter(r => {
                const recordDate = new Date(r.date);
                return recordDate >= thisWeekStart && recordDate <= thisWeekEnd;
            });
            const weekHours = weekRecords.reduce((sum, record) => sum + (parseFloat(record.totalHours) || 0), 0);
            document.getElementById('weekHours').textContent = weekHours.toFixed(2);
            
            // Calculate this month's hours
            const monthRecords = userRecords.filter(r => {
                const recordDate = new Date(r.date);
                return recordDate >= thisMonthStart;
            });
            const monthHours = monthRecords.reduce((sum, record) => sum + (parseFloat(record.totalHours) || 0), 0);
            document.getElementById('monthHours').textContent = monthHours.toFixed(2);
        }

        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            const currentTimeElement = document.getElementById('currentTime');
            if (currentTimeElement) {
                currentTimeElement.textContent = timeString;
            }
        }

        // Punch in
        function punchIn() {
            // Check if the user is scheduled today
            const today = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
            const todaySchedule = schedules.filter(s => s.day === today && s.crewId === currentUser.id);
            
            if (todaySchedule.length === 0) {
                showToast('You are not scheduled for today', 'error');
                return;
            }
            
            // Check if already punched in
            if (currentPunch && currentPunch.punchIn && !currentPunch.punchOut) {
                showToast('You are already punched in', 'warning');
                return;
            }
            
            currentPunch = {
                date: new Date().toISOString().split('T')[0],
                punchIn: new Date().toLocaleTimeString(),
                punchOut: null,
                breakStart: null,
                breakEnd: null,
                crewId: currentUser.id,
                crewName: currentUser.name
            };
            
            updatePunchStatus();
            showToast('Punched in successfully', 'success');
        }

        // Punch out
        function punchOut() {
            if (!currentPunch || !currentPunch.punchIn) {
                showToast('You need to punch in first', 'error');
                return;
            }
            
            if (currentPunch.breakStart && !currentPunch.breakEnd) {
                showToast('Please end your break first', 'warning');
                return;
            }
            
            currentPunch.punchOut = new Date().toLocaleTimeString();
            
            // Calculate total hours
            const punchInTime = new Date(`1970-01-01T${currentPunch.punchIn}`);
            const punchOutTime = new Date(`1970-01-01T${currentPunch.punchOut}`);
            let totalHours = (punchOutTime - punchInTime) / (1000 * 60 * 60); // in hours
            
            // Subtract break time if any
            if (currentPunch.breakStart && currentPunch.breakEnd) {
                const breakStartTime = new Date(`1970-01-01T${currentPunch.breakStart}`);
                const breakEndTime = new Date(`1970-01-01T${currentPunch.breakEnd}`);
                const breakHours = (breakEndTime - breakStartTime) / (1000 * 60 * 60);
                totalHours -= breakHours;
            }
            
            currentPunch.totalHours = totalHours.toFixed(2);
            
            // Save to time records
            timeRecords.push({...currentPunch});
            saveDataToStorage();
            
            // Reset current punch
            currentPunch = null;
            
            updatePunchStatus();
            updateTimeRecords();
            updateTimeSummary();
            showToast('Punched out successfully', 'success');
        }

        // Take break
        function takeBreak() {
            if (!currentPunch || !currentPunch.punchIn) {
                showToast('You need to punch in first', 'error');
                return;
            }
            
            if (currentPunch.breakStart && !currentPunch.breakEnd) {
                showToast('You are already on break', 'warning');
                return;
            }
            
            currentPunch.breakStart = new Date().toLocaleTimeString();
            updatePunchStatus();
            showToast('Break started', 'success');
        }

        // End break
        function endBreak() {
            if (!currentPunch || !currentPunch.breakStart) {
                showToast('You need to start a break first', 'error');
                return;
            }
            
            currentPunch.breakEnd = new Date().toLocaleTimeString();
            updatePunchStatus();
            showToast('Break ended', 'success');
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            
            let icon = '';
            if (type === 'success') {
                icon = '<i class="bi bi-check-circle-fill toast-icon"></i>';
            } else if (type === 'error') {
                icon = '<i class="bi bi-x-circle-fill toast-icon"></i>';
            } else if (type === 'warning') {
                icon = '<i class="bi bi-exclamation-triangle-fill toast-icon"></i>';
            }
            
            toast.innerHTML = `
                ${icon}
                <div>${message}</div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto remove toast after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // Show confirmation modal
        function showConfirmation(message, callback) {
            const modal = document.getElementById('confirmationModal');
            const messageElement = document.getElementById('confirmationMessage');
            const confirmButton = document.getElementById('confirmButton');
            
            messageElement.textContent = message;
            modal.classList.add('active');
            
            // Set up confirmation button
            confirmButton.onclick = function() {
                callback();
                closeModal('confirmationModal');
            };
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Save data to localStorage
        function saveDataToStorage() {
            localStorage.setItem('pneArenaData', JSON.stringify({
                cashbills: cashbills,
                logEntries: logEntries,
                quotations: quotations,
                onlineOrders: onlineOrders,
                crews: crews,
                stockItems: stockItems,
                schedules: schedules,
                timeRecords: timeRecords,
                invoiceCounter: invoiceCounter,
                orderCounter: orderCounter,
                quotationCounter: quotationCounter
            }));
        }

        // Load data from localStorage
        function loadDataFromStorage() {
            const savedData = localStorage.getItem('pneArenaData');
            
            if (savedData) {
                const data = JSON.parse(savedData);
                
                if (data.cashbills) cashbills = data.cashbills;
                if (data.logEntries) logEntries = data.logEntries;
                if (data.quotations) quotations = data.quotations;
                if (data.onlineOrders) onlineOrders = data.onlineOrders;
                if (data.crews) crews = data.crews;
                if (data.stockItems) stockItems = data.stockItems;
                if (data.schedules) schedules = data.schedules;
                if (data.timeRecords) timeRecords = data.timeRecords;
                if (data.invoiceCounter) invoiceCounter = data.invoiceCounter;
                if (data.orderCounter) orderCounter = data.orderCounter;
                if (data.quotationCounter) quotationCounter = data.quotationCounter;
            }
        }
    </script>
</body>
</html>
